/*! jh2d 2015-06-23 */
"use strict";!function(a,b,c){a.dashedLine=function(a,b,c,d){if(d){var e=this.delta(b,c),f=Math.sqrt(e[0]*e[0]+e[1]*e[1]),g=0,h=0;for(a.moveTo(b[0],b[1]);;){if(h+=d[g%d.length],h>=f)break;var i=e[0]/f*h,j=e[1]/f*h;g%2===0?a.lineTo(b[0]+i,b[1]+j):a.moveTo(b[0]+i,b[1]+j),g++}g%2===0?a.lineTo(c[0],c[1]):a.moveTo(c[0],c[1])}else a.lineTo(c[0],c[1])},a.dashedRect=function(b,c,d,e,f,g){g?(a.dashedLine(b,[c,d],[c+e,d],g),a.dashedLine(b,[c+e,d],[c+e,d+f],g),a.dashedLine(b,[c+e,d+f],[c,d+f],g),a.dashedLine(b,[c,d+f],[c,d],g),b.stroke()):b.strokeRect(c,d,e,f)}}(window.jh2d=window.jh2d||{}),function(a,b,c){var d=function(a,b){return[b[0]-a[0],b[1]-a[1]]},e=function(a,b){var c=d(a,b);return Math.sqrt(c[0]*c[0]+c[1]*c[1])},f=function(a,b){var c=2;a.length>=8&&(c=3);var d,e,f=0,g=a[f++],h=a[f++],i=a[f++],j=a[f++],k=a[f++],l=a[f++];3===c&&(d=a[f++],e=a[f++]);var m=[];return 3===c?(m[m.length]=Math.pow(1-b,3)*g+3*b*Math.pow(1-b,2)*i+3*Math.pow(b,2)*(1-b)*k+Math.pow(b,3)*d,m[m.length]=Math.pow(1-b,3)*h+3*b*Math.pow(1-b,2)*j+3*Math.pow(b,2)*(1-b)*l+Math.pow(b,3)*e):(m[m.length]=Math.pow(1-b,2)*g+2*b*(1-b)*i+Math.pow(b,2)*k,m[m.length]=Math.pow(1-b,2)*h+2*b*(1-b)*j+Math.pow(b,2)*l),m},g=function(a,b){for(var c=.001,d=[],g=f(a,0),h=g,i=0,j=0,k=[],l=c;1>=l;l+=c){g=f(a,l);var m=e(h,g);m<b[i]/10||(j+=m,h=g,j>=b[i]&&(i%2===0&&d.push(k),i=(i+1)%b.length,k=[],j=0),i%2===0&&k.push(g[0],g[1]))}return k.length>0&&d.push(k),d},h=function(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.length>0&&a.moveTo(d[0],d[1]);for(var e=1;e<d.length/2;e++)a.lineTo(d[2*e],d[2*e+1])}};a.bezier=f,a.dashedBezier=function(a,b,c){if(c){var d=g(b,c);h(a,d)}else{var e=2;6===b.length&&a.quadraticCurveTo(b[e++],b[e++],b[e++],b[e++]),b.length>=8&&a.bezierCurveTo(b[e++],b[e++],b[e++],b[e++],b[e++],b[e++])}}}(window.jh2d=window.jh2d||{}),function(a,b,c){var d=function(a,b,c,d){"object"==typeof a&&(b=a.y,c=a.w,d=a.h,a=a.x);var e=.5522848,f=c/2*e,g=d/2*e,h=a+c,i=b+d,j=a+c/2,k=b+d/2;return[a,k,a,k-g,j-f,b,j,b,j+f,b,h,k-g,h,k,h,k+g,j+f,i,j,i,j-f,i,a,k+g,a,k]},e=function(a,b){var c=6*b;return a.slice(c,c+8)},f=function(a,b,c){var d=c.w/2,e=c.h/2,f=a-c.x-d,g=b-c.y-e;return Math.pow(f/d,2)+Math.pow(g/e,2)<=1},g=function(b,c,d,e){var f=b.x,g=b.y,h=b.w,i=b.h,j=a.direction(f,g,h,i,c),k=Math.min(h,i),l=[],m=[],n=h/2,o=i/2,p=1;return j===a.NORTH||j===a.SOUTH?(p=h===k?4:6,l[0]=f+n-h/p,l[1]=g+o,m[0]=f+n+h/p,m[1]=g+o):(p=i===k?4:6,l[0]=f+n,l[1]=g+o-i/p,m[0]=f+n,m[1]=g+o+i/p),d.call(e||this,l,m,j)};a.inOval=f,a.doOvalEx=g,a.ovalCpts=d,a.ovalCptAt=e,a.calcOvalGap=function(b,c,f,h){var i=[],j=[],k=b.w/2,l=0;g(b,c,function(a,c,d){i=a,j=c,l=d,b.w<0&&(l===this.EAST||l===this.WEST)&&(l^=this.EAST|this.WEST),b.h<0&&(l===this.NORTH||l===this.SOUTH)&&(l^=this.NORTH|this.SOUTH)},this);var m=[(c[1]-i[1])/(c[0]-i[0]),(c[1]-j[1])/(c[0]-j[0])],n=d(b.x,b.y,b.w,b.h),o=[];switch(l){case this.EAST:o=[e(n,1),e(n,2)];break;case this.NORTH:o=[e(n,0),e(n,1)];break;case this.WEST:o=[e(n,3),e(n,0)],m=m.reverse();break;case this.SOUTH:o=[e(n,2),e(n,3)],m=m.reverse()}for(var p=0,q=Math.abs(1/k),r=[],s=0;s<o.length;s++)for(var t=o[s],u=0,v=0;1>=v;v+=q){var w=a.bezier(t,v),x=m[p]*(w[0]-c[0])+c[1],y=w[1]-x>0?1:2;if(x===w[1]||0!==u&&u!==y){if(r[r.length]=w,1===p)break;p++,u=0}else u=y}f.call(h||this,r,n,l)},a.dashedOval=function(b,c,g,h){var i=c.ex,j=!1;if(i&&!f(c.x+c.ex.dx,c.y+c.ex.dy,c)){var k=a.center(c.x,c.y,c.w,c.h),l=[c.x+c.ex.dx,c.y+c.ex.dy];a.calcOvalGap(c,l,function(d,f,h){if(j=2!==d.length,!j){var i,m,n=0;switch(h){case this.SOUTH:n=0,c.w>0?(i=d[0][0]>k[0],m=d[1][0]>k[0]):(i=d[0][0]<k[0],m=d[1][0]<k[0]);break;case this.NORTH:n=2,c.w>0?(i=d[0][0]<k[0],m=d[1][0]<k[0]):(i=d[0][0]>k[0],m=d[1][0]>k[0]);break;case this.WEST:n=1,c.h>0?(i=d[0][1]>k[1],m=d[1][1]>k[1]):(i=d[0][1]<k[1],m=d[1][1]<k[1]);break;case this.EAST:n=3,c.h>0?(i=d[0][1]<k[1],m=d[1][1]<k[1]):(i=d[0][1]>k[1],m=d[1][1]>k[1])}var o=e(f,n++);g||b.moveTo(o[0],o[1]),a.dashedBezier(b,o,g),a.dashedBezier(b,e(f,n++%4),g),i?(o=e(f,n%4),o=o.slice(0,4).concat(d[0]),a.dashedBezier(b,o,g),a.dashedLine(b,d[0],l,g),a.dashedLine(b,l,d[1],g),m||n++):(a.dashedBezier(b,e(f,n++%4),g),o=e(f,n%4),o=o.slice(0,4).concat(d[0]),a.dashedBezier(b,o,g),a.dashedLine(b,d[0],l,g),a.dashedLine(b,l,d[1],g)),m?(o=e(f,n++%4),o=d[1].concat(o.slice(4)),a.dashedBezier(b,o,g),a.dashedBezier(b,e(f,n%4),g)):(o=e(f,n%4),o=d[1].concat(o.slice(2)),a.dashedBezier(b,o,g))}})}else h=h||[1,1,1,1];if(h){var m=d(c.x,c.y,c.w,c.h);b.moveTo(m[0],m[1]);for(var n=0;n<h.length;n++){var o=e(m,n);h[n]?a.dashedBezier(b,o,g):b.moveTo(o[o.length-2],o[o.length-1])}return m}}}(window.jh2d=window.jh2d||{}),function(a,b,c){a.plugins={},a.dashes=[[4,4],[8,4,4,4],[8,4,4,4,4,4,8,4]];var d={style:"normal",weight:"normal",size:12,family:"sans-serif",align:0,color:"rgba(0,0,0,0.87)",pos:0};a.DEF_TEXT_OPT=d;var e=1,f=2,g=4,h=8;a.EAST=e,a.NORTH=f,a.WEST=g,a.SOUTH=h;var i=1,j=2,k=4,l=8,m=16,n=32,o=64,p=n|i,q=n|o,r=10;a.ACT_MOVE=i,a.ACT_RESIZE=j,a.ACT_ROTATE=k,a.ACT_EX_MOVE=l,a.ACT_SELECT=m,a.ACT_NEW_DROP=p,a.ACT_NEW_FREE=q;var s=function(a,b,c,d){return"object"==typeof a?s(a.x,a.y,a.w,a.h):[a+c/2,b+d/2]},t=function(a,b){return[b[0]-a[0],b[1]-a[1]]},u=function(a,b){var c=t(a,b);return Math.sqrt(c[0]*c[0]+c[1]*c[1])};a.center=s,a.delta=t,a.distance=u,a.direction=function(a,b,c,d,e){var f=d/c,g=this.center(a,b,c,d),h=e[0]-g[0],i=e[1]-g[1],j=0;return i>=Math.abs(h*f)&&(j=this.SOUTH),i<=-1*Math.abs(h*f)&&(j=this.NORTH),h>=Math.abs(i/f)&&(j=this.EAST),h<=-1*Math.abs(i/f)&&(j=this.WEST),j};var v=function(a){if(null!=a&&"object"==typeof a){if(ia(a)){for(var b=[],c=0;c<a.length;c++)b[b.length]=v(a[c]);return b}var d={};for(var e in a)d[e]=v(a[e]);return d}return a},w=function(a,b){for(var c=!1,d=0;d<a.length&&!(c=b===a[d]);d++);return c},x=function(b,c,d,e){if("object"==typeof c)for(var f in c){var g=ia(e)&&w(e,f);"function"==typeof e&&(g=e.call(a,f)),g||((null==b[f]||d)&&("object"==typeof c[f]&&null!=c[f]?b[f]=v(c[f]):b[f]=v(c[f])),null==b[f]&&delete b[f])}return b},y=function(a,b,c,d){var e=a[0],f=a[1],g=b[0],h=b[1],i=c[0],j=c[1],k=d[0],l=d[1],m=((g-e)*(i-k)*(j-f)-i*(g-e)*(j-l)+e*(h-f)*(i-k))/((h-f)*(i-k)-(g-e)*(j-l)),n=((h-f)*(j-l)*(i-e)-j*(h-f)*(i-k)+f*(g-e)*(j-l))/((g-e)*(j-l)-(h-f)*(i-k));return[m,n]},z=function(a){var b=a.ex[0].dx,c=a.ex[0].dy,d=a.ex[1].dx,e=a.ex[1].dy,f=0,g=0,h=0,i=0,j=c-a.h/2,k=e-a.h/2;return b!==a.w/2?(f=j/(b-a.w/2),g=Math.atan(f),b<a.w/2&&(g+=Math.PI)):g=0>j?-Math.PI/2:Math.PI/2,d!==a.w/2?(h=k/(d-a.w/2),i=Math.atan(h),d<a.w/2&&(i+=Math.PI)):i=0>k?-Math.PI/2:Math.PI/2,g>=i&&(i+=2*Math.PI),[g,i]};a.clone=v,a.extend=x,a.inArray=w,a.crossPoint=y,a.calcExArc=z;var A=3,B=function(a,b,c,d){a.strokeStyle="#000",a.beginPath(),a.arc(b,c,A,0,2*Math.PI,!1),a.closePath(),a.fillStyle=d||"#fff",a.fill(),a.stroke()},C=function(a,b,c,d,e){for(var f=[0,1,2,-1],g=c/2,h=d/2,i=-1,j=0;8>j;j++){var k=j%f.length,l=0,m=0;switch(f[k]){case 0:i*=-1,l=a+g+g*i,m=b+h;break;case 1:l=a+g+g*i,m=b+h-h*i;break;case 2:l=a+g,m=b+h-h*i;break;case-1:l=a+g-g*i,m=b+h-h*i}if(e(l,m,j))return j}return-1},D=function(a,b,c,d){return Math.pow(d-b,2)+Math.pow(c-a,2)<=Math.pow(A+2,2)},E=function(a,b,c){return C(a.x,a.y,a.w,a.h,function(d,e,f){var g=!0;if(null!=a.adjPoint){var h=Math.pow(2,f);g=(h&a.adjPoint)===h}return g&&D(d,e,b,c)})},F=function(a,b){a.save();var c=G(b),d=b.initRotate||0,e=0,f=c[e++],g=c[e++],h=c[e++],i=c[e++];0!==d&&(a.translate(h,i),a.rotate(-d),f-=h,g-=i,h=0,i=0),a.beginPath(),a.moveTo(f,g),a.lineTo(h,i+b.h/2*-1),a.stroke(),B(a,f,g,"#0f0"),a.restore()},G=function(a){var b=[a.w/2,a.h/Math.abs(a.h)*15*-1,a.w/2,a.h/2],c=a.x,d=a.y,e=0;return[c+b[e++],d+b[e++],c+b[e++],d+b[e++]]},H=function(a){return a.rc||G(a).slice(2)},I=function(b,c,d){var e=b.ctx;e.save();var f=c.rc||H(c),g=c.x+(c.dx||0),h=c.y+(c.dy||0),i=f[0],j=f[1],k=c.rotate||0;0!==k&&(e.translate(i,j),e.rotate(k),g-=i,h-=j);var l=c.style;null==l&&(l=3);var m=1===(1&l),n=2===(2&l),o=c.dashedStyle,p=parseInt(c.shadowOffset),q=c.shadowAngle,r=c.gradient||0,s=c.alpha||1;-1!==s&&(e.globalAlpha=s);var t=a.plugins[c.type];if(t){c.strokeSize&&(e.lineWidth=c.strokeSize),e.strokeStyle=c.strokeStyle||"#000";var u=a.extend({x:g,y:h},c);e.beginPath();var v=null;isNaN(parseInt(o))||(v=a.dashes[o]);var w=c.strokeBefore||!1;if(t.renderer.call(b,e,u,v),null!=q&&!isNaN(p)){e.shadowColor=c.shadowColor||"RGBA(127,127,127,1)";var x=H(c),y=a.rotate(x,[x[0]+p,x[1]],q);e.shadowOffsetX=y[0]-x[0],e.shadowOffsetY=y[1]-x[1],e.shadowBlur=null==c.shadowBlur?5:c.shadowBlur,w=!0}w&&n&&e.stroke(),m&&(e.fillStyle=c.fillStyle||"#fff",0!==r&&J(e,c,g,h),e.fill()),!w&&n&&e.stroke(),c.img&&L(e,u),null!=d&&1===(1&d)&&X(b,u),c.text&&(e.save(),P(e,u,g,h),e.restore()),t.drawAfter&&(e.beginPath(),t.drawAfter.call(b,e,u,v))}e.restore()},J=function(b,c,d,i){var j=c.gradient||0,k=c.gradientType||0,l=0>j;j=Math.abs(j);var m,n,o,p,q=d,r=d,s=i,t=i,u=0,v=0,w=null;if(0===k){j===(e|f)&&(m=c.h/c.w,n=-1/m,o=n*c.w/(n-m),p=m*o,u=o-c.w/2,v=p-c.h/2),j===(g|f)&&(m=-1*c.h/c.w,n=-1/m,o=m*c.w/(m-n),p=n*o,u=o-c.w/2,v=p-c.h/2),(j&e)===e&&(q=d+c.w-u,r=d+u),(j&f)===f&&(s=i-v,t=i+c.h+v),(j&g)===g&&(q=d-u,r=d+c.w+u),(j&h)===h&&(s=i-v,t=i+c.h+v);var x=c.rotate||0;if(0!==x&&c.gradientFixed){var y=a.rotate([0,0],[q,s],x,-1),z=a.rotate([0,0],[r,t],x,-1);q=y[0],s=y[1],r=z[0],t=z[1]}w=b.createLinearGradient(q,s,r,t)}else{var A=0,B=0;0===j||j===(e|f|g|h)?(q=d+c.w/2,s=i+c.h/2,r=q,t=s,B=Math.sqrt(c.w*c.w+c.h*c.h)/2):(q=d+c.w/2,s=i+c.h/2,(j&e)===e&&(q=d+c.w-u),(j&f)===f&&(s=i-v),(j&g)===g&&(q=d-u),(j&h)===h&&(s=i+c.h+v),r=q,t=s,B=Math.max(Math.abs(c.w),Math.abs(c.h))),w=b.createRadialGradient(q,s,A,r,t,B)}for(var C=c.gradientCnt||2,D=c.gradientColors||[c.fillStyle,"#ffffff"],E=1/(C-1),F=0;C>F;F++){var G=F===C-1?1:F*E,H=F%D.length;l&&(H=D.length-H-1);var I=D[H];w.addColorStop(G,I)}b.fillStyle=w};a.resource_cache={};var K=a.resource_cache,L=function(a,b){var c="string"==typeof b.img?b.img:b.img.url;null!=c&&K[c]&&O(a,b,K[c])},M=function(a){for(var b=!0,c=0;c<a.length;c++){var d=a[c];if(d.img){var e="string"==typeof d.img?d.img:d.img.url;if(b=!!K[e],!b)break}}return b},N=function(a,b,c){var d=new Image;d.onload=function(e){K[e.target.src]=d,M(a)&&b.call(c||a)};for(var e=0;e<a.length;e++){var f=a[e];if(f.img){var g="string"==typeof f.img?f.img:f.img.url;null==K[g]&&(d.src=g)}}},O=function(a,b,c){a.clip();var d=0,e=0,f=0,g=0,h=b.x,i=b.y,j=b.w,k=b.h,l=1;"object"==typeof b.img&&(d=b.img.x||d,e=b.img.y||e,f=b.img.w||c.width,g=b.img.h||c.height,0>d&&(l=b.w/f,h-=d*l,f+=d,j=f*l),0>e&&(l=b.h/g,i-=e*l,g+=e,k=g*l),d=Math.max(d,0),e=Math.max(e,0),f=Math.min(f,c.width),g=Math.min(g,c.height)),a.drawImage(c,d,e,f,g,h,i,j,k)},P=function(a,b,c,i){c=c||b.x,i=i||b.y;var j=0,k=c,l=i,m=x(b.textOpt||{},d,!1),n=" ",o=m.size;"number"==typeof parseInt(o)&&(o+="px");var p=m.style+n+m.weight+n+o+n+m.family;a.font=p,a.fillStyle=m.color;var q=b.text.split(/\n|<br[\/]{0,1}\>/);j=a.measureText(q[0]);for(var r=1;r<q.length;r++){var s=a.measureText(q[r]);s.width>j.width&&(j=s)}var t=Q(m.family,o);k=c+b.w/2,l=i+b.h/2,a.textAlign="center",a.textBaseline="middle";var u=m.align;(u&e)===e&&(k=c+b.w,a.textAlign="right"),(u&g)===g&&(k=c,a.textAlign="left"),(u&h)===h&&(l=i+b.h,a.textBaseline="bottom"),(u&f)===f&&(l=i,a.textBaseline="top");var v=m.pos;for((v&e)===e&&(k+=b.w),(v&g)===g&&(k-=b.w),(v&h)===h&&(l+=b.h),(v&f)===f&&(l-=b.h),b.textOpt=m,b.textOpt.x=k,b.textOpt.y=l,b.textOpt.w=j,b.textOpt.h=t,r=0;r<q.length;r++){var w=l+r*t.height;a.fillText(q[r],k,w),m.decoration&&R(a,m.decoration,b)}},Q=function(a,b){var c=document.createElement("span");c.innerHTML="Hg",c.style.fontFamily=a,c.style.fontSize=b,c.style.padding="0px",c.style.margin="0px";var d=document.createElement("div");d.style.display="inline-block",d.style.width="1px",d.style.height="0px";var e=document.createElement("div");e.style.padding="0px",e.style.margin="0px",e.style.border="1px solid",e.appendChild(c),e.appendChild(d),document.body.appendChild(e);var f={};try{d.style.verticalAlign="baseline",f.ascent=S(d).top-S(c).top,d.style.verticalAlign="bottom",f.height=S(d).top-S(c).top,f.descent=f.height-f.ascent}finally{document.body.removeChild(e)}return f},R=function(a,b,c){var d=c.textOpt,i=d.h,j=d.w,k=i.height-i.descent/3,l=j.width,m=d.align,n=c.x+c.w/2,o=c.y+c.h/2,p=[n-l/2,o],q=[n+l/2,o],r=0;switch(b.toLowerCase()){case"line-through":r=0;break;case"underline":r=1;break;case"overline":r=-1}a.beginPath(),a.lineWidth=parseInt(d.size/12),a.strokeStyle=d.color||"#000",(m&e)===e&&(p[0]=c.x+c.w-l,q[0]=c.x+c.w),(m&g)===g&&(p[0]=c.x,q[0]=c.x+l),(m&h)===h&&(o+=(c.h-k)/2),(m&f)===f&&(o-=(c.h-k)/2),p[1]=o+r*k/2,q[1]=o+r*k/2;var s=d.pos;(s&e)===e&&(p[0]+=c.w,q[0]+=c.w),(s&g)===g&&(p[0]-=c.w,q[0]-=c.w),(s&h)===h&&(p[1]+=c.h,q[1]+=c.h),(s&f)===f&&(p[1]-=c.h,q[1]-=c.h),a.moveTo(p[0],p[1]),a.lineTo(q[0],q[1]),a.stroke()},S=function(a){for(var b=0,c=0;a&&!isNaN(a.offsetLeft)&&!isNaN(a.offsetTop);)b+=a.offsetLeft-a.scrollLeft,c+=a.offsetTop-a.scrollTop,a=a.offsetParent;return{top:c,left:b}},T=function(a,b,c,d,e){var f=a.ctx;f.save(),f.scale(c,c);var g=0;if(ia(b))if(e)for(g=0;g<e.length;g++){var h=e[g];I(a,b[h],d!==h||b[h].conn?0:1)}else for(g=0;g<b.length;g++)I(a,b[g],d!==g||b[g].conn?0:1);else I(a,b);f.restore()},U=function(a,b,c,d){a.save(),a.beginPath();for(var e=r*(d||1),f=b/e,g=0;f>g;g++)a.moveTo(g*e,0),a.lineTo(g*e,c);for(f=c/e,g=0;f>g;g++)a.moveTo(0,g*e),a.lineTo(b,g*e);a.strokeStyle="rgba(187,187,187,0.26)",a.stroke(),a.restore()},V=function(b,c,d,e){var f=b.ctx;f.save(),f.scale(d,d);var g=H(c),h=c.x,i=c.y,j=g[0],k=g[1],l=c.rotate||0;0!==l&&(f.translate(j,k),f.rotate(l),h-=j,i-=k);var m=a.extend({x:h,y:i},c),n=c.conn?"#0f0":null;C(h,i,c.w,c.h,function(a,b,d){var g=!0;if(null!=c.adjPoint){var h=Math.pow(2,d);g=(h&c.adjPoint)===h}if(g){var i=n;if(ia(e))for(var j=0;j<e.length;j++){var k=e[j];if(k[1]===d){i="#f00";break}}B(f,a,b,i)}}),(null==c.adjPoint||256===(256&c.adjPoint))&&F(f,m),(null==c.adjPoint||512===(512&c.adjPoint))&&da(b,m),f.restore()},W=function(a,b,c,d,e){a.beginPath(),a.moveTo(b,c),a.lineTo(b+d,c+e),a.moveTo(b+d,c),a.lineTo(b,c+e),a.stroke()},X=function(a,b){var c=a.ctx;c.save(),c.strokeStyle="#00f";for(var d=Y(b,a),e=5,f=0;f<d.length;f++)W(c,d[f][0]-e/2,d[f][1]-e/2,e,e);c.restore()},Y=function(b,c){var d=a.plugins[b.type];return d&&d.getConnectPts?d.getConnectPts.call(c||d,b):Z(b)},Z=function(a){var b=a.x+a.w/2,c=a.y+a.h/2;return[[b,a.y],[a.x+a.w,c],[b,a.y+a.h],[a.x,c]]},$=function(a,b,c){var d=Y(a,c);return ba(a,d[aa(d,ba(a,b,-1))])},_=function(a,b,c){var d=Y(a,c);return aa(d,ba(a,b,-1))},aa=function(a,b){for(var c=0,d=0,e=0;e<a.length;e++){var f=u(b,a[e]);0===e?c=f:c>f&&(c=f,d=e)}return d},ba=function(b,c,d){var e=b.rotate||0;if(0!==e){var f=a.rotate(H(b),c,e,d||1);c[0]=f[0],c[1]=f[1]}return c},ca=function(a,b){var c=Y(a)[b[3]];return ba(a,c)};a.defConnectPts=Z;var da=function(b,c){if(c.ex){var d=b.ctx,e=function(e){var f=a.plugins[c.type];if(f&&f.drawExPoint)f.drawExPoint.call(b,d,c,e);else{var g=e.dx,h=e.dy;B(d,c.x+g,c.y+h,"#ffff00")}},f=c.ex;if(ia(f))for(var g=0;g<f.length;g++){var h=f[g];e(h)}else e(f)}};a.reg=function(b){a.extend(a.plugins,b)};var ea=function(a,b,c,d){return d=d||1,[(b[0]-a[0])*Math.cos(c)-d*(b[1]-a[1])*Math.sin(c)+a[0],d*(b[0]-a[0])*Math.sin(c)+(b[1]-a[1])*Math.cos(c)+a[1]]},fa=function(a,b,c,d){var e=(b[1]-a[1])/(b[0]-a[0]),f=(b[1]-c[1])/(b[0]-c[0]),g=(a[1]-c[1])/(a[0]-c[0]),h=(e*(d[0]-b[0])-(d[1]-b[1]))*(e*(c[0]-b[0])-(c[1]-b[1])),i=(f*(d[0]-b[0])-(d[1]-b[1]))*(f*(a[0]-b[0])-(a[1]-b[1])),j=(g*(d[0]-a[0])-(d[1]-a[1]))*(g*(b[0]-a[0])-(b[1]-a[1]));return h>0&&i>0&&j>0},ga=function(a,b,c,d,e){var f=[a,b],g=[a+c,b],h=[a,b+d],i=[a+c,b+d];return fa(f,g,h,e)||fa(g,h,i,e)},ha=function(a){for(var b=a.offsetLeft,c=a.offsetTop,d=a.offsetParent;null!==d;)b=parseInt(b)+parseInt(d.offsetLeft),c=parseInt(c)+parseInt(d.offsetTop),d=d.offsetParent;return new Array(b,c)};a.inTriangle=fa,a.inRect=ga;var ia=function(a){return"[object Array]"===Object.prototype.toString.call(a)};a.rotate=ea,a.isArray=ia;var ja=["e-resize","ne-resize","n-resize","nw-resize","w-resize","sw-resize","s-resize","se-resize"],ka=[1,3,2,6,4,12,8,9],la=function(a,b,c,d){ma(a,function(a,e){if(d>=0){if(e===d)return a.dx=b,a.dy=c,!0}else a.dx=b,a.dy=c})},ma=function(a,b){var c=a.ex;if(null!=c)if(ia(c))for(var d=0;d<c.length;d++){var e=c[d],f=b.call(a,e,d);if("boolean"==typeof f&&f)break}else b.call(a,c,0)},na=function(a,b,c){ma(a,function(a){a[b]*=1+c})},oa=function(a,b,c){ma(a,function(a){"number"==typeof b?(a.dx+=b,a.dy+=c):a[b]+=c})},pa=function(a,b,c){if(a.ex){var d=function(d){var e,f;return e=a.x+d.dx,f=a.y+d.dy,D(e,f,b,c)};if(ia(a.ex))for(var e=0;e<a.ex.length;e++){var f=a.ex[e];if(d(f))return e}else if(d(a.ex))return 0}return-1},qa=function(a,b,c,d,e,f){1===(1&ka[c])&&(a.w=b.w+b.w*e,d||na(a,"dx",e)),2===(2&ka[c])&&(a.y=b.y+b.h*f,a.h=b.h-b.h*f,d?oa(a,"dy",-1*b.h*f):na(a,"dy",-1*f)),4===(4&ka[c])&&(a.x=b.x+b.w*e,a.w=b.w-b.w*e,d?oa(a,"dx",-1*b.w*e):na(a,"dx",-1*e)),8===(8&ka[c])&&(a.h=b.h+b.h*f,d||na(a,"dy",f))},ra=function(a,b){for(var c=[],d=0;d<b.length;d++){var e=b[d];if(-1===ua(c,e)){var f=ta(a,e);-1!==f?c[c.length]=a.splice(f,1)[0]:c[c.length]=e}}return c.length>0&&(a[a.length]=c),a},sa=function(a,b){for(var c=a[b],d=[b,1],e=0,f=0;f<c.length;f++){var g=c[f];ia(g)&&(d[d.length]=g,e++)}return Array.prototype.splice.apply(a,d),e},ta=function(a,b){for(var c=0;c<a.length;c++){var d=a[c];if(-1!==ua(d,b))return c}return-1},ua=function(a,b){for(var c=0;c<a.length;c++){var d=a[c];if(ia(d)){if(-1!==ua(d,b))return c}else if(d===b)return c}return-1},va=function(a,b){var c=null,d=0;c=ia(b[d])?va(a,b[d]):a[b[d]],d=1;for(var e=wa(c),f=0;d<b.length;d++){c=ia(b[d])?va(a,b[d]):a[b[d]];var g=wa(c);e[f]=Math.min(e[f],g[f++]),e[f]=Math.min(e[f],g[f++]),e[f]=Math.max(e[f],g[f++]),e[f]=Math.max(e[f],g[f++])}f=0;var h=e[f++],i=e[f++],j=e[f++],k=e[f++];return{x:h,y:i,w:j-h,h:k-i}},wa=function(a){var b=a.x,c=a.x+a.w,d=a.y,e=a.y+a.h,f=Math.min(b,c),g=Math.min(d,e),h=f+Math.abs(a.w),i=g+Math.abs(a.h);return[f,g,h,i]},xa=function(a){for(var b=[],c=0;c<a.length;c++){var d=a[c];ia(d)?b=b.concat(xa(d)):b[b.length]=d}return b},ya=function(a,b){for(var c=[],d=a.concat(b),e=0;e<d.length;e++){var f=d[e];-1===Aa(c,f)&&(c[c.length]=f)}return c},za=function(a){var b=xa(a);return b.join("_")},Aa=function(a,b){for(var c=0;c<a.length;c++){var d=a[c];if(d===b)return c}return-1},Ba=[{re:/#?([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})/,format:"hex",parse:function(a){return[parseInt(a[1],16),parseInt(a[2],16),parseInt(a[3],16),1]}},{re:/#?([a-fA-F0-9])([a-fA-F0-9])([a-fA-F0-9])/,format:"hex",parse:function(a){return[parseInt(a[1]+a[1],16),parseInt(a[2]+a[2],16),parseInt(a[3]+a[3],16),1]}}],Ca=function(a){for(var b=0;b<Ba.length;b++){var c=Ba[b],d=c.re.exec(a),e=d&&c.parse.apply(this,[d]);if(e)return e}return!1},Da=function(a,b){var c=b||.8,d=Ca(a);if(d){var e=0;return Ea([d[e++]*c,d[e++]*c,d[e++]*c,1])}return a},Ea=function(a){var b=0;return"#"+(1<<24|a[b++]<<16|a[b++]<<8|a[b++]).toString(16).substr(1)};a.darkColor=Da;var Fa={allScale:1,selectedIndexs:[],groups:[],groupSprites:{},curIndex:-1,connectingSprites:[]},Ga=function(a,b){var c=this;this.data=[],this.ctx=a.getContext("2d"),this.w=a.getAttribute("width"),this.h=a.getAttribute("height");var d=ha(a);return this.offsetLeft=d[0],this.offsetTop=d[1],this.options=x(b||{},Fa),this.connModeFlag=!1,this.action=0,this.newSprite=null,this.downX=0,this.downY=0,this.moveX=0,this.moveY=0,this.upX=0,this.upY=0,this.mDownFlag=!1,this.downRotate=0,this.moveRotate=0,this.overInd=-1,this.scalex=0,this.scaley=0,this.exIndex=-1,this.exFreezed=!1,this.resizeInd=-1,this.assistSprites=[],this.cursor="default",this.multiSelect=!1,this.quickMode=!0,this.lastMouseUp=(new Date).getTime(),a.addEventListener("mousedown",function(a){c._onMousedown(a)}),a.addEventListener("mousemove",function(a){c._onMousemove(a)}),a.addEventListener("mouseup",function(a){var b=(new Date).getTime()-c.lastMouseUp;280>b?(clearTimeout(c._setTimeout),c._onDblclick(a)):(c.lastMouseUp=(new Date).getTime(),c.quickMode?c._onMouseup(a):c._setTimeout=setTimeout(function(){c._onMouseup(a)},280))}),this.listeners={},c};Ga.prototype={startRefresh:function(){var a=this;null!=this.interval&&clearInterval(this.interval),this.interval=setInterval(function(){a.update()},1e3/60)},stopRefresh:function(){clearInterval(this.interval),this.interval=null},newMode:function(a,b){b===p?a=x(a,{w:100,h:100}):(b&o)===o&&(a.ex=[{dx:0,dy:0},{dx:2,dy:2}]),this.newSprite=a,this._init(this.newSprite),this.action=b||n,this.startRefresh()},connectMode:function(){this.connModeFlag=!0,this.startRefresh()},_init:function(b){var c=a.plugins[b.type];null!=c&&c.init&&null!=b.w&&null!=b.h&&c.init.call(this,b)},add:function(a){if(ia(a)){for(var b=0;b<a.length;b++)this._init(a[b]);a.length>0&&(this.data=this.data.concat(a))}else this._init(a),this.data[this.data.length]=a;return"function"==typeof this.listeners.add&&this.listeners.add(a),this},addListener:function(a,b){this.listeners[a]=b},setAddListener:function(a){this.addListener("add",a)},setSelectListener:function(a){this.addListener("select",a)},setData:function(a,b){this.reset(),this.options=x(b||{},Fa),this.data=a},remove:function(a){return this.splice(a,1),this},splice:function(){return this.data.splice(arguments)},reset:function(){this.action=0,this.resizeInd=-1,this.mDownFlag=!1,this.moveRotate=0,this.downRotate=0,this.exIndex=-1,this.scalex=0,this.scaley=0,this.exFreezed=!1,this.connModeFlag=!1,this.stopRefresh()},show:function(){var a=this.ctx;return this.options.background&&U(a,this.w,this.h),this.update(),N(this.data,function(){T(this,this.data,1,-1,this.getOrderIndexs())},this),this},getSprite:function(a){return this.data[a]},getCurIndex:function(){return this.options.curIndex},indexOf:function(b,c){for(var d=this.getOrderIndexs(),e=d.length-1;e>=0;e--){var f=d[e],g=this.data[f],h=b,i=c,j=g.rotate||0;if(0!==j){var k=a.rotate(a.center(g.x,g.y,g.w,g.h),[h,i],j,-1);h=k[0],i=k[1]}var l=a.plugins[g.type];if(l&&l.isOver){if(l.isOver.call(this,h,i,g))return f}else if(ga(g.x,g.y,g.w,g.h,[h,i]))return f}return-1},indexsOf:function(a,b,c,d){for(var e=[],f=Math.min(a,c),g=Math.max(a,c),h=Math.min(b,d),i=Math.max(b,d),j=0;j<this.data.length;j++){var k=this.data[j];k.x>=f&&k.x<=g&&k.y>=h&&k.y<=i&&k.x+k.w>=f&&k.x+k.w<=g&&k.y+k.h>=h&&k.y+k.h<=i&&(e[e.length]=j)}return e},getOrderIndexs:function(){var a=[],b=0;if(this.orderIndexs){if(this.orderIndexs.length!==this.data.length){for(b=0;b<this.data.length;b++){for(var c=b,d=0;d<this.orderIndexs.length;d++)b===this.orderIndexs[d]&&(c=this.orderIndexs[d]);a[b]=c}this.orderIndexs=a}}else{for(a=[],b=0;b<this.data.length;b++)a[b]=b;this.orderIndexs=a}return this.orderIndexs},getSelectedCount:function(){for(var a=this.options.selectedIndexs,b=this.options.groups,c=[],d=0,e=0;e<a.length;e++){var f=ua(b,a[e]);-1!==f?-1===c.join().indexOf(f+"")&&(c[c.length]=f,d++):d++}return d},getSelecteds:function(){for(var a=this.options.selectedIndexs,b=[],c=0;c<a.length;c++)b[b.length]=this.data[a[c]];return b},indexOfSeleted:function(a){for(var b=this.options.selectedIndexs,c=-1,d=0;d<b.length;d++)if(a===b[d]){c=d;break}return c},removeSelected:function(){for(var a=this.options.selectedIndexs,b=[],c=[],d=0;d<this.data.length;d++)w(a,d)?b[b.length]=this.data[d]:c[c.length]=this.data[d];return b.length>0?this.reset():b=null,this.data=c,this.options.selectedIndexs=[],b},select:function(a){var b=this.options.selectedIndexs,c=function(a){var c=!1;return w(b,a)||(b[b.length]=a,c=!0),c},d=!1;if(ia(a))for(var e=0;e<a.length;e++)c(a[e])&&!d&&(d=!0);else d=c(a);return"function"==typeof this.listeners.select&&d&&this.listeners.select(this.options.curIndex,b,this.data),this},selectAll:function(){for(var a=0;a<this.data.length;a++)this.options.selectedIndexs[a]=a;return"function"==typeof this.listeners.select&&this.listeners.select(this.options.curIndex,this.options.selectedIndexs,this.data),this},setMultiSelect:function(a){return this.multiSelect=a,this},_doMouseOver:function(b){var c=this,d=c.action,e=b.rotate||0,f=c.moveX,g=c.moveY,h=f,i=g,m=0;if(0!==e){var n=a.rotate(H(b),[h,i],e,-1);h=n[0],i=n[1],m=-1*Math.round(4*e/Math.PI)}if(c.exIndex=pa(b,h,i),-1!==c.exIndex)c.cursor="crosshair",d=l;else{var o=E(b,h,i);if(-1!==o){c.resizeInd=o,o+=m;var p=o%ja.length;0>p&&(p+=ja.length),c.cursor=ja[p],d=j}else{var q=null;if(null==b.adjPoint||256===(256&b.adjPoint)){q=G(b);var r=b.initRotate||0;0!==r&&(q=a.rotate(H(b),q,r))}null!=q&&D(q[0],q[1],h,i)&&(d=k,c.cursor="crosshair")}}c.action=d},_connSelectedCount:function(a){for(var b=0,c=0;c<a.length;c++)-1!==this.indexOfSeleted(a[c][2])&&b++;return b},_findConns:function(a){for(var b=this.options.connectingSprites,c=[],d=0;d<b.length;d++){var e=b[d];e[2]===a&&(c[c.length]=e)}return c},_doConns:function(a,b){for(var c=this._findConns(a),d=0;d<c.length;d++){var e=c[d];b.call(this,e,a)}},_findConnGrp:function(a){for(var b=this.options.connectingSprites,c=[],d=0;d<b.length;d++){var e=ia(a)?a[0]:a;b[d][0]===e&&(c[c.length]=b[d])}return c},_clearConns:function(a,b){var c=this.options.connectingSprites;b=null==b?-1:b;for(var d=[],e=0;e<c.length;e++){var f=c[e],g=!1;g=-1!==b?f[0]===a&&f[1]===b:f[0]===a,g||(d[d.length]=f)}this.options.connectingSprites=d},_updateConn:function(a,b,c,d){var e,f,g=ca(a,c),h=this._findConnGrp(c),i=d||this.data[c[0]];3===c[1]?(e=g[0]-i.x,f=g[1]-i.y,b.x=i.x+e,b.y=i.y+f,ma(b,function(a){a.dx-=e,a.dy-=f}),h.length>1&&(b.w=i.w-e,b.h=i.h-f)):7===c[1]&&(e=g[0]-(i.x+i.w),f=g[1]-(i.y+i.h),1===h.length?(b.x=i.x+e,b.y=i.y+f):(b.w=i.w+e,b.h=i.h+f))},_dragEx:function(b,c,d){if(d.ex&&-1!==this.exIndex){var e,f,g=d.ex;ia(g)&&(g=d.ex[this.exIndex]);var h=b,i=c,j=d.rotate||0;if(0!==j){var k=a.rotate(H(d),[h,i],j,-1);h=k[0],i=k[1]}e=h-d.x,f=i-d.y,la(d,e,f,this.exIndex)}},moveBottom:function(a){var b=this.getOrderIndexs(),c=b[0];b[0]=a;for(var d=1;c!==a&&d<b.length;d++){var e=b[d];b[d]=c,c=e}return this},moveTop:function(a){var b=this.getOrderIndexs(),c=b.length,d=b[c-1];b[c-1]=a;for(var e=c-2;d!==a&&e>=0;e--){var f=b[e];b[e]=d,d=f}return this},moveDown:function(a){for(var b=this.getOrderIndexs(),c=b[0],d=1;c!==a&&d<b.length;d++){var e=b[d];e===a&&(b[d]=c,b[d-1]=a),c=e}return this},moveUp:function(a){var b=this.getOrderIndexs(),c=b.length,d=b[c-1];b[c-1]=a;for(var e=c-2;d!==a&&e>=0;e--){var f=b[e];f===a&&(b[e]=d,b[e+1]=a),d=f}return this},group:function(){var a=this.options.selectedIndexs,b=this.options.groups,c=this.options.groupSprites;if(a.length>1){console.log(a),ra(b,a);for(var d=0;d<b.length;d++){var e=b[d],f=za(e),g=c[f];null==g&&(c[f]=va(this.data,e))}}return console.log(b),this},ungroup:function(){for(var a=this.options.selectedIndexs,b=this.options.groups,c=this.options.groupSprites,d=[],e=-1,f=0;f<a.length;f++)e=ua(b,a[f]),-1!==e&&-1===d.join().indexOf(e+"")&&(d[d.length]=e);d=d.sort();var g=0;for(f=0;f<d.length;f++){e=d[f]+g;var h=b[e],i=za(h);delete c[i];var j=sa(b,e);0===j?g+=-1:j>1&&(g+=j-1)}return console.log(b),this},_doAlign:function(a,b,c){switch(b){case e:c.x=a.x+a.w-c.w;break;case f:c.y=a.y;break;case g:c.x=a.x;break;case h:c.y=a.y+a.h-c.h;break;case e|g:c.x=a.x+a.w/2-c.w/2;break;case f|h:c.y=a.y+a.h/2-c.h/2}return this},_doGrpAlign:function(a,b,c){var d=this.options.groups,e=this.options.groupSprites,f=d[c],g=za(f),h=e[g],i=v(h);this._doAlign(a,b,h);for(var j=xa(f),k=0;k<j.length;k++){var l=j[k],m=this.data[l];m.x+=h.x-i.x,m.y+=h.y-i.y}},align:function(a){var b=this.options.selectedIndexs,c=this.options.groups,d=this.options.groupSprites,e=this.options.curIndex,f=null,g=ua(c,e);if(-1===g)f=this.data[e];else{var h=c[g],i=za(h);f=d[i]}for(var j=[],k=0;k<b.length;k++){var l=b[k],m=ua(c,l);if(-1!==g&&g!==m)if(-1===m){var n=this.data[l];this._doAlign(f,a,n)}else-1===j.join().indexOf(m+"")&&(this._doGrpAlign(f,a,m),j[j.length]=m)}},zoom:function(a){return this.options.allScale=a,this.update(),this},getScale:function(){return this.options.allScale||1},_updateSprite:function(b,c,d,m){var n=this,o=n.options.allScale,p=n.options.selectedIndexs,q=n.options.groups,r=n.options.groupSprites,s=n.options.curIndex,t=n.downX,u=n.downY,v=n.moveX,w=n.moveY,x=n.scalex,y=n.scaley,z=n.assistSprites,A=null;if(0!==d){var B=this.indexOfSeleted(c);A=z[B],null==A&&(A=a.extend({style:2,dashedStyle:0,strokeSize:1},b),z[z.length]=A)}if(b.conn&&p.length>1){var C=n._findConnGrp(c);if(1===n._connSelectedCount(C))return}(d&i)===i&&(A.x=b.x+v-t,A.y=b.y+w-u,n.exFreezed&&s===c&&oa(A,t-v,u-w),T(n,A,o));var D=-1,E=-1,F=null,G=null;if((d&k)===k&&(A.rotate=((b.rotate||0)+n.moveRotate)%(2*Math.PI),D=ta(q,c),-1!==D?(G=q[D],E=za(G),F=r[E],A.rc=H(F)):A.rc=H(b),T(n,A,o)),(d&j)===j){if(n.data[s].conn&&s!==c)return;if(D=ta(q,c),-1!==D){G=q[D],E=za(G),F=r[E];var I=a.extend({},F);qa(I,F,m,n.exFreezed&&s===c,x,y),(ka[m]&e)===e&&(A.w=b.w*(1+x),A.x=(b.x-F.x)*(1+x)+F.x),(ka[m]&g)===g&&(A.w=b.w*(1-x),A.x=(b.x-F.x)*(1-x)+I.x),(ka[m]&f)===f&&(A.h=b.h*(1-y),A.y=(b.y-F.y)*(1-y)+I.y),(ka[m]&h)===h&&(A.h=b.h*(1+y),A.y=(b.y-F.y)*(1+y)+F.y)}else qa(A,b,m,n.exFreezed,x,y);if(A.rc=H(b),b.conn){var J=n.indexOf(v,w);if(s===c&&-1!==J&&J!==s&&-1!==c){var K=$(n.data[J],[v,w],n);3===m?(A.w-=K[0]-A.x,A.h-=K[1]-A.y,A.x=K[0],A.y=K[1]):7===m&&(A.w=K[0]-A.x,A.h=K[1]-A.y)}}T(n,A,o)}b.conn||null==A||n._doConns(c,function(b){var c=n._findConnGrp(b[0]);if(2!==n._connSelectedCount(c)){var d=n.data[b[0]],e=[];ma(d,function(a){a.main&&(e[e.length]=a)}),"line"===d.type&&(d.ex=e);var f=a.extend({style:2,dashedStyle:0,strokeSize:1},d),g=this.indexOfSeleted(b[0]);-1!==g&&(z[g]=f),n._updateConn(A,f,b),f.rc=H(d),T(n,f,o)}}),(d&l)===l&&-1!==n.exIndex&&s===c&&(n._dragEx(v,w,A),T(n,A,o))},_onMousedown:function(b){var c=this,d=c.options.disabled;if(!d){var e=c.options.allScale,f=c.options.selectedIndexs,g=c.options.groups,h=c.options.curIndex,j=c.action,l=c.newSprite,o=c.downX,p=c.downY,q=c.moveX,r=c.moveY;if(o=b.offsetX||b.layerX,p=b.offsetY||b.layerY,o/=e,p/=e,c.mDownFlag=!0,h=c.overInd,-1!==h){var s=c.data[h];-1===c.indexOfSeleted(h)&&(c.multiSelect?f[f.length]=h:(f=[],f[0]=h));var t=ta(g,h);if(-1!==t&&(f=ya(f,xa(g[t]))),(j&k)===k){var u=H(s),v=o-u[0],w=p-u[1];c.downRotate=Math.atan2(w,v)}for(var x={curIndex:h,exInd:c.exIndex,data:c.data,selectedIndexs:f,resizeInd:c.resizeInd},y=null,z=0;z<f.length;z++){var A=f[z],B=c.data[A];y=a.plugins[B.type],y&&y.onActionStart&&(y.onActionStart.call(this,j,B,x),c.exIndex=x.exInd)}if(y=a.plugins[s.type],y&&y.exFreeze){var C=q,D=r,E=s.rotate||0;if(0!==E){var F=a.rotate(a.center(s.x,s.y,s.w,s.h),[C,D],E,-1);C=F[0],D=F[1]}c.exFreezed=y.exFreeze.call(this,C,D,s,j)}}else f=[],0!==j&&l&&((j&n)===n&&(null==l.x||null==l.y)&&(l.x=o,l.y=p),(j&i)!==i&&(l.w=1,l.h=1)),0===j&&(j=m);c.options.curIndex=h,this.select(f),c.action=j,c.downX=o,c.downY=p,null==c.interval&&c.startRefresh()}},_onMousemove:function(b){var c=this,d=c.options.disabled;if(!d){var e=b.target||b.srcElement,f=c.options.allScale,g=c.options.selectedIndexs,h=c.options.groups,m=c.options.groupSprites,p=c.options.curIndex,q=c.action,r=c.newSprite,s=c.downX,t=c.downY,u=c.moveX,v=c.moveY,w=-1,x=null,y=null,z=-1;if(u=b.offsetX||b.layerX,v=b.offsetY||b.layerY,u/=f,v/=f,(q&n)!==n?c.mDownFlag||(c.overInd=c.indexOf(u,v)):c.overInd=-1,c.mDownFlag)if(-1===p){if((q&n)===n&&r)if((q&i)===i)r.x=u,r.y=v;else if((q&o)===o){var A=r.ex[r.ex.length-1];A.dx=u-r.x,A.dy=v-r.y}else r.w=u-s,r.h=v-t}else if(w=ta(h,p),x=null,-1===w?x=c.data[p]:(y=h[w],z=za(y),x=m[z]),(q&k)===k){var B=H(x),C=u-B[0],D=v-B[1];c.moveRotate=Math.atan2(D,C)-c.downRotate}else if((q&j)===j){var E=u,F=v,G=s,I=t;if(x.rotate){var J=a.rotate(H(x),[E,F],x.rotate,-1),K=a.rotate(H(x),[G,I],x.rotate,-1);E=J[0],F=J[1],G=K[0],I=K[1]}0!==x.w&&(c.scalex=(E-G)/x.w),0!==x.h&&(c.scaley=(F-I)/x.h),c.connModeFlag=null!=x.conn?!!x.conn:!1}else(q&l)===l||(q&n)===n||(c.action=i);else{if(c.cursor="default",-1!==c.overInd&&(c.cursor="move"),(q&n)===n){if(r)if((q&i)===i)r.x=u-r.w/2,r.y=v-r.h/2,c.cursor="move";else if((q&o)===o){var L=r.ex[r.ex.length-1];L.dx=u-r.x,L.dy=v-r.y,c.cursor="crosshair"}else c.cursor="crosshair"}else{c.action=0;for(var M=0;null!=g&&M<g.length;M++){var N=g[M];if(x=null,w=ta(h,N),-1!==w&&(y=h[w],z=za(y),x=m[z]),
null==x&&(x=c.data[N]),c._doMouseOver(x),0!==c.action){c.overInd=N;break}}}e.style.cursor=c.cursor}c.moveX=u,c.moveY=v}},_onMouseup:function(b){var c=this,d=c.options.disabled;if(!d){var e=c.options.allScale,f=c.options.selectedIndexs,g=c.options.groups,h=c.options.groupSprites,l=c.options.curIndex,p=c.action,q=c.newSprite,r=c.scalex,s=c.scaley,t=c.resizeInd,u=c.downX,w=c.downY,y=c.upX,z=c.upY,A=c.assistSprites;y=b.offsetX||b.layerX,z=b.offsetY||b.layerY,y/=e,z/=e,c.stopRefresh();var B=0,C=-1,E=null;if(-1!==l){var F=null,G=[];for(B=0;c.mDownFlag&&B<f.length;B++){var H=f[B];if(F=c.data[H],C=ta(g,H),-1!==C&&-1===G.join().indexOf(C+"")&&(G[G.length]=C),A.length>B&&a.extend(F,A[B],!0,["fillStyle","style","dashedStyle","strokeSize"]),F.rotate){var I=a.center(F);if(F.rc){var J=ea(F.rc,I,F.rotate),K=J[0]-I[0],L=J[1]-I[1];F.x=F.x+K,F.y=F.y+L}}F.rc&&delete F.rc,F.conn||c._doConns(H,this._onSpConn)}for(B=0;B<G.length;B++){C=G[B];var M=g[C],N=za(M),O=h[N];if(null!=O)if((p&i)===i)O.x=O.x+y-u,O.y=O.y+z-w;else if((p&k)===k)O.rotate=((O.rotate||0)+c.moveRotate)%(2*Math.PI);else if((p&j)===j){var P={};qa(P,O,c.resizeInd,!1,r,s),x(O,P,!0)}}for(B=0;c.mDownFlag&&B<f.length;B++)if(F=c.data[f[B]],F.conn){var Q=c._findConnGrp(f[B]),R=c._connSelectedCount(Q);if(2===R)for(var S=0;S<Q.length;S++)E=Q[S],c._updateConn(c.data[E[2]],F,E,v(F));else 0===R&&(p&i)===i&&c._clearConns(f[B])}F=c.data[l];var T=a.plugins[F.type];if(T&&T.onActionDone){var U={exInd:c.exIndex,data:c.data,selectedIndexs:f,resizeInd:t};T.onActionDone.call(this,p,F,U)}if(F.conn&&-1!==t){var V=c.indexOf(y,z);if(-1!==V){var W=-1,X=_(c.data[V],[y,z],c),Y=c.options.connectingSprites;for(B=0;B<Y.length;B++)if(E=Y[B],E[0]===l&&E[1]===t){W=B;break}-1===W?Y[Y.length]=[l,t,V,X]:(Y[W][2]=V,Y[W][3]=X)}else c._clearConns(l,t)}}else(p&m)===m&&(f=c.indexsOf(u,w,y,z));if((p&n)===n&&q){var Z=!0;if((p&o)===o){Z=!1;var $=q.ex[0],aa=q.ex[q.ex.length-1],ba=q.x,ca=q.y;if(!D(ba+$.dx,ca+$.dy,ba+aa.dx,ca+aa.dy))return q.ex[q.ex.length]=v(aa),void c.startRefresh();q.closePath=!0,q.style=3,q.ex.splice(q.ex.length-1,1),Z=!0,c._updateMaxRect(q)}Z&&(l=c.data.length,c.add(q),f=[],this.select(l))}c.options.selectedIndexs=f,c.options.curIndex=l,c.upX=y,c.upY=z,c.reset(),c.update()}},_onDblclick:function(){var a=this,b=a.action,c=a.newSprite;if((b&o)===o){c.ex.splice(c.ex.length-1,1),a._updateMaxRect(c);var d=a.data.length;a.add(c),a.options.selectedIndexs=[],a.options.curIndex=d,this.select(d),a.reset(),a.update()}},_updateMaxRect:function(a){var b=a.ex,c=0,d=b[c],e=d.dx,f=d.dy,g=d.dx,h=d.dy;for(c=1;c<b.length;c++){var i=b[c];e=Math.min(i.dx,e),f=Math.min(i.dy,f),g=Math.max(i.dx,g),h=Math.max(i.dy,h)}for(c=0;c<b.length;c++){var j=b[c];j.dx-=e,j.dy-=f}return a.x+=e,a.y+=f,a.w=g-e,a.h=h-f,a},_onSpConn:function(a,b){var c=this.data[b],d=this.data[a[0]];-1===this.indexOfSeleted(a[0])&&this._updateConn(c,d,a)},update:function(){var b=this,c=b.options.allScale,d=b.options.selectedIndexs,e=b.options.groups,f=b.options.groupSprites,g=b.action,h=b.newSprite,i=b.downX,l=b.downY,o=b.moveX,p=b.moveY,q=b.assistSprites;b.ctx.clearRect(0,0,b.w,b.h),this.options.background&&U(b.ctx,b.w,b.h,c);var r=-1;b.connModeFlag&&(r=b.indexOf(o,p)),T(b,b.data,c,r,b.getOrderIndexs()),q.length=0;for(var s=[],t=-1,u=0;u<d.length;u++){var v=d[u];t=ta(e,v);var w=b.data[v],x=[];if(w.conn&&(x=b._findConnGrp(v)),-1!==t?-1===s.join().indexOf(t+"")&&(s[s.length]=t):V(b,w,c,x),!w.conn||g!==j&&g!==k||2!==b._connSelectedCount(x))(g&n)!==n&&b._updateSprite(w,v,g,b.resizeInd);else{var y=a.extend({style:2,dashedStyle:0,strokeSize:1},w);q[q.length]=y}}for(u=0;u<s.length;u++){t=s[u];var z=e[t],A=za(z),B=f[A];null!=B&&V(b,B,c)}(g&m)===m&&(o-i!==0||p-l!==0)&&a.dashedRect(b.ctx,i,l,o-i,p-l,a.dashes[0]),(g&n)===n&&h&&null!=h.x&&null!=h.y&&(this._init(h),T(b,h,c))}},a.instance=function(a,b){return new Ga(a,b)}}(window.jh2d=window.jh2d||{}),function(a,b,c){var d=a.plugins,e=function(a,b,c){var d=c.w/2,e=c.h/2,f=a-c.x-d,g=b-c.y-e;return Math.pow(f/d,2)+Math.pow(g/e,2)<1},f=a.darkColor,g=function(b,c,d){var e=c.ex.dx,g=c.ex.dy,h=[c.x+e,c.y+g],i=[c.x+c.w,c.y],j=[c.x+c.w-e,c.y],k=[c.x,c.y+g],l=[c.x+e,c.y+c.h],m=[c.x,c.y+c.h],n=[c.x+c.w,c.y+c.h-g];b.moveTo(i[0],i[1]),a.dashedLine(b,i,n,d),a.dashedLine(b,n,l,d),a.dashedLine(b,l,h,d),b.closePath();var o=c.style;if(null==o&&(o=3),1===(1&o)){var p=c.fillStyle||"#fff";b.fillStyle=f(p),b.fill()}2===(2&o)&&b.stroke(),b.beginPath(),b.moveTo(h[0],h[1]),a.dashedLine(b,h,i,d),a.dashedLine(b,i,j,d),a.dashedLine(b,j,k,d),a.dashedLine(b,k,h,d),a.dashedLine(b,h,l,d),a.dashedLine(b,l,m,d),a.dashedLine(b,m,k,d)},h=function(b,c,d){var e=c.ex.dy,f=[c.x,c.y+e/2],g=[c.x+c.w,c.y+e/2],h=[c.x+c.w,c.y+c.h-e/2],i=[c.x,c.y+c.h-e/2];b.moveTo(g[0],g[1]),a.dashedLine(b,g,h,d);var j=a.ovalCpts(c.x,c.y+c.h-e,c.w,e),k=a.ovalCptAt(j,3),l=a.ovalCptAt(j,2);a.dashedBezier(b,l,d),a.dashedBezier(b,k,d),a.dashedLine(b,i,f,d),a.dashedOval(b,{x:c.x,y:c.y,w:c.w,h:e},d)},i=function(b,c,d){var e,f,g=[c.x,c.y],h=[-1,0,1,0],i=[0,-1,0,1],j=c.w<0?-1:1,k=c.h<0?-1:1,l=-1,m=null;c.ex&&(m=[c.x+c.ex.dx,c.y+c.ex.dy],u(c,m,function(b,d,g){e=b,f=d,l=g,(l&(a.NORTH|a.SOUTH))===l&&c.h<0&&(l=(a.NORTH|a.SOUTH)^g),l===a.SOUTH&&(e=d,f=b),(l&(a.EAST|a.WEST))===l&&c.w<0&&(l=(a.WEST|a.EAST)^g),l===a.WEST&&(e=d,f=b)}));for(var n=[a.NORTH,a.EAST,a.SOUTH,a.WEST],o=0;4>o;o++){var p,q,r=[g[0]-c.w*h[o],g[1]-c.h*i[o]];if(c.corner){var s=[];s=[g[0]+c.corner*i[o]*j,g[1]-c.corner*h[o]*k],s=s.concat(g),p=[g[0]-c.corner*h[o]*j,g[1]-c.corner*i[o]*k],s=s.concat(p),0===o&&b.moveTo(s[0],s[1]),a.dashedBezier(b,s,d),q=[r[0]+c.corner*h[o]*j,r[1]+c.corner*i[o]*k]}else p=g,q=r;l===n[o]?(a.dashedLine(b,p,e,d),a.dashedLine(b,e,m,d),a.dashedLine(b,m,f,d),a.dashedLine(b,f,q,d)):a.dashedLine(b,p,q,d),g=r}b.closePath()},j=function(b,c,d){var e=[c.x+c.w/2,c.y],f=[c.x+c.w,c.y+c.h/2],g=[c.x+c.w/2,c.y+c.h],h=[c.x,c.y+c.h/2];b.moveTo(e[0],e[1]),a.dashedLine(b,e,f,d),a.dashedLine(b,f,g,d),a.dashedLine(b,g,h,d),a.dashedLine(b,h,e,d)},k=function(b,c,d){var e=[d.x+d.w/2,d.y],f=[d.x+d.w,d.y+d.h/2],g=[d.x+d.w/2,d.y+d.h],h=[d.x,d.y+d.h/2];return a.inTriangle(e,f,g,[b,c])||a.inTriangle(e,h,g,[b,c])},l=function(b,c,d){var e=[c.x+c.ex.dx,c.y],f=[c.x+c.w,c.y],g=[c.x+c.w-c.ex.dx,c.y+c.h],h=[c.x,c.y+c.h];b.moveTo(e[0],e[1]),a.dashedLine(b,e,f,d),a.dashedLine(b,f,g,d),a.dashedLine(b,g,h,d),a.dashedLine(b,h,e,d)},m=function(b,c,d){var e=[d.x+d.ex.dx,d.y],f=[d.x+d.w,d.y],g=[d.x+d.w-d.ex.dx,d.y+d.h],h=[d.x,d.y+d.h];return a.inTriangle(e,f,g,[b,c])||a.inTriangle(e,h,g,[b,c])},n=function(b,c,d){var e=[c.x,c.y],f=[c.x+c.w,c.y],g=[c.x+c.w-c.ex.dx,c.y+c.h],h=[c.x+c.ex.dx,c.y+c.h];b.moveTo(e[0],e[1]),a.dashedLine(b,e,f,d),a.dashedLine(b,f,g,d),a.dashedLine(b,g,h,d),a.dashedLine(b,h,e,d)},o=function(b,c,d){var e=[d.x,d.y],f=[d.x+d.w,d.y],g=[d.x+d.w-d.ex.dx,d.y+d.h],h=[d.x+d.ex.dx,d.y+d.h];return a.inTriangle(e,f,g,[b,c])||a.inTriangle(e,h,g,[b,c])},p=function(b,c,d){var e=c.ex.dx<c.w/2?c.w:0,f=0===e?c.w:0,g=[c.x+e,c.y],h=[c.x+f,c.y],i=[c.x+f,c.y+c.ex.dy],j=[c.x+f,c.y+c.h-c.ex.dy],k=[c.x+f,c.y+c.h],l=[c.x+e,c.y+c.h];b.moveTo(g[0],g[1]),a.dashedBezier(b,g.concat(h).concat(i),d),a.dashedLine(b,i,j,d),a.dashedBezier(b,j.concat(k).concat(l),d)},q=function(b,c,d){for(var e=[c.ex.dx,c.w-c.ex.dx],f=0;2>f;f++){var g=0===f?0:c.w,h=[c.x+e[f],c.y],i=[c.x+g,c.y],j=[c.x+g,c.y+c.ex.dy],k=[c.x+g,c.y+c.h-c.ex.dy],l=[c.x+g,c.y+c.h],m=[c.x+e[f],c.y+c.h];b.moveTo(h[0],h[1]),a.dashedBezier(b,h.concat(i).concat(j),d),a.dashedLine(b,j,k,d),a.dashedBezier(b,k.concat(l).concat(m),d)}},r=function(b,c,d){var e=c.ex[0].dx<=c.w/2?c.w:0,f=c.ex,g=Math.min(f[0].dy,c.w/2),h=0===e?c.w:0,i=[c.x+e,c.y],j=[c.x+c.w/2,c.y],k=[c.x+c.w/2,c.y+g],l=c.y+f[1].dy;l<c.y+2*g&&(l=c.y+2*g),l>c.y+c.h-2*g&&(l=c.y+c.h-2*g);var m=[c.x+c.w/2,l-g],n=[c.x+c.w/2,l],o=[c.x+h,l],p=[c.x+c.w/2,l],q=[c.x+c.w/2,l+g],r=[c.x+c.w/2,c.y+c.h-g],s=[c.x+c.w/2,c.y+c.h],t=[c.x+e,c.y+c.h];b.moveTo(i[0],i[1]),a.dashedBezier(b,i.concat(j).concat(k),d),a.dashedLine(b,k,m,d),a.dashedBezier(b,m.concat(n).concat(o),d),a.dashedBezier(b,o.concat(p).concat(q),d),a.dashedLine(b,q,r,d),a.dashedBezier(b,r.concat(s).concat(t),d)},s=function(b,c,d){for(var e=c.ex,f=[e[0].dx,c.w-e[0].dx],g=Math.min(e[0].dy,e[0].dx/2),h=0;2>h;h++){var i=0===h?0:c.w,j=0===h?f[0]/2:c.w-f[0]/2,k=[c.x+f[h],c.y],l=[c.x+j,c.y],m=[c.x+j,c.y+g],n=c.y+e[1].dy;n<c.y+2*g&&(n=c.y+2*g),n>c.y+c.h-2*g&&(n=c.y+c.h-2*g);var o=[c.x+j,n-g],p=[c.x+j,n],q=[c.x+i,n],r=[c.x+j,n],s=[c.x+j,n+g],t=[c.x+j,c.y+c.h-g],u=[c.x+j,c.y+c.h],v=[c.x+f[h],c.y+c.h];b.moveTo(k[0],k[1]),a.dashedBezier(b,k.concat(l).concat(m),d),a.dashedLine(b,m,o,d),a.dashedBezier(b,o.concat(p).concat(q),d),a.dashedBezier(b,q.concat(r).concat(s),d),a.dashedLine(b,s,t,d),a.dashedBezier(b,t.concat(u).concat(v),d)}},t=function(b,c,d){var e=[c.x,c.y+c.h],f=[c.x+c.w,c.y+c.h],g=[c.x+c.ex.dx,c.y+c.ex.dy];b.moveTo(e[0],e[1]),a.dashedLine(b,e,f,d),a.dashedLine(b,f,g,d),a.dashedLine(b,g,e,d)},u=function(b,c,d,e){var f=a.direction(b.x,b.y,b.w,b.h,c),g=[0,0],h=[0,0],i=function(a){var b=a/6,c=b+a/4,d=5*a/12;return[b,c,d]},j=null,k=f;switch(f===a.EAST||f===a.WEST?(j=i(b.h),g[1]=b.y+j[0],h[1]=b.y+j[1],(b.h>0&&c[1]>b.y+b.h/2||b.h<0&&c[1]<b.y+b.h/2)&&(g[1]+=j[2],h[1]+=j[2]),b.w<0&&(k=(a.WEST|a.EAST)^f)):(j=i(b.w),g[0]=b.x+j[0],h[0]=b.x+j[1],(b.w>0&&c[0]>b.x+b.w/2||b.w<0&&c[0]<b.x+b.w/2)&&(g[0]+=j[2],h[0]+=j[2]),b.h<0&&(k=(a.NORTH|a.SOUTH)^f)),k){case a.EAST:g[0]=b.x+b.w,h[0]=b.x+b.w;break;case a.NORTH:g[1]=b.y,h[1]=b.y;break;case a.WEST:g[0]=b.x,h[0]=b.x;break;case a.SOUTH:g[1]=b.y+b.h,h[1]=b.y+b.h}return d.call(e||this,g,h,f)},v=.6,w=.8,x=function(b,c,d,e,f,g){var h=[c,d],i=[c+e,d],j=[c+e,d+f*v],k=[c,d+f*w],l=y(c,d,e,f);b.moveTo(k[0],k[1]),a.dashedBezier(b,k.concat(l).concat(j),g),a.dashedLine(b,j,i,g),a.dashedLine(b,i,h,g),a.dashedLine(b,h,k,g)},y=function(a,b,c,d){return[a+c/4,b+d*(2-w),a+c/2,b+d*v]},z=function(b,c,d,e,f){var g=a.inRect(b,c,d,e,f),h=f[0],i=f[1];if(g&&i>c+e*v){var j=(h-b)/d,k=y(b,c,d,e),l=[b,c+e*w],m=[b+d,c+e*v],n=a.bezier(l.concat(k).concat(m),j);g=e>=0?i<=n[1]:i>=n[1]}return g},A=function(b,c,d,e,f,g){for(var h=.8*e,i=.8*f,j=d+f*w,k=c,l=0;3>l;l++){var m=c+l*e*.1,n=d+f*(.2-.1*l);b.moveTo(m,j),a.dashedLine(b,[m,j],[m,n],g),a.dashedLine(b,[m,n],[m+h,n],g),a.dashedLine(b,[m+h,n],[m+h,n+i*v],g);var o=[m+h,n+i*v],p=[k,n+i*v];if(0===l){var q=y(m,n,h,i);b.moveTo(k,j),a.dashedBezier(b,[k,j].concat(q).concat(o),g)}else a.dashedLine(b,o,p,g);j=n,k=m+h}},B=function(b,c,d,e,f){var g=a.inRect(b,c,d,e,f);if(g)for(var h=.8*d,i=.8*e,j=0;3>j;j++){var k=b+j*d*.1,l=c+e*(.2-.1*j);if(g=0===j?z(k,l,h,i,f):a.inRect(k,l,h,i*v,f))break}return g},C=function(b,c,d){var e=[c.x+c.w/6,c.y+c.h,c.x,c.y+c.h,c.x,c.y+c.h/2,c.x+c.w/6,c.y+c.h/2];b.moveTo(e[0],e[1]),a.dashedBezier(b,e,d);var f=[c.x+c.w/6,c.y+c.h/3,c.x+c.w/4,c.y+2*c.h/9],g=[c.x+c.w/3,c.y+c.h/4,c.x+c.w/3,c.y-c.h/7,c.x+3*c.w/4,c.y-c.h/7],h=[c.x+c.w-c.w/5,c.y+c.h/3,c.x+c.w,c.y+c.h/3,c.x+c.w,c.y+c.h,c.x+c.w-c.w/5,c.y+c.h];a.dashedBezier(b,e.slice(e.length-2).concat(f).concat(g.slice(0,2)),d),a.dashedBezier(b,g.concat(h.slice(0,2)),d),a.dashedBezier(b,h,d),a.dashedLine(b,h.slice(h.length-2),e.slice(0,2),d)},D=function(b,c,d){var e=[c.x,c.y+c.h/4,c.x,c.y,c.x+c.w/2,c.y+c.h/6];b.moveTo(e[0],e[1]),a.dashedBezier(b,e,d);var f=[c.x+c.w,c.y,c.x+c.w,c.y+c.h/4];a.dashedBezier(b,e.slice(e.length-2).concat(f),d);var g=[c.x+c.w,c.y+c.h/2,c.x+c.w/2,c.y+c.h];a.dashedBezier(b,f.slice(f.length-2).concat(g),d),a.dashedBezier(b,g.slice(f.length-2).concat([c.x,c.y+c.h/2]).concat(e.slice(0,2)),d)},E=function(b,c,d){var e=2*Math.PI/5,f=2*e-Math.PI/2,g=c.x+c.w/2,h=c.y+c.h/2,i=c.w/2/Math.tan(f)+g,j=c.y+c.h;b.moveTo(i,j);var k=[i,j],l=[2*g-i,c.y+c.h];a.dashedLine(b,k,l,d);var m=-1*c.h/2*Math.tan(Math.PI/2*3-e)+h,n=[c.x,m],o=[c.x+c.w/2,c.y];a.dashedLine(b,l,n,d),a.dashedLine(b,n,o,d);var p=[c.x+c.w,m];a.dashedLine(b,o,p,d),a.dashedLine(b,p,k,d)},F=function(b,c,d){var e=c.x+c.w/2,f=c.y+c.h/2,g=c.ex,h=[e+c.w/2-c.ex.dx,c.y];b.moveTo(h[0],h[1]);var i=[c.x+c.w,f],j=[h[0],2*f-h[1]],k=[c.x+g.dx,2*f-h[1]],l=[c.x,c.y+c.h/2],m=[c.x+g.dx,c.y];a.dashedLine(b,h,i,d),a.dashedLine(b,i,j,d),a.dashedLine(b,j,k,d),a.dashedLine(b,k,l,d),a.dashedLine(b,l,m,d),a.dashedLine(b,m,h,d)},G=function(b,c,d){var e=c.x+c.w/2,f=c.y+c.h/2,g=c.ex,h=[c.x+g.dx,c.y];b.moveTo(h[0],h[1]);var i=[2*e-h[0],h[1]],j=[c.x+c.w,c.y+c.h*g.dx/c.w],k=[j[0],2*f-j[1]],l=[i[0],c.y+c.h],m=[h[0],c.y+c.h],n=[c.x,k[1]],o=[c.x,j[1]];a.dashedLine(b,h,i,d),a.dashedLine(b,i,j,d),a.dashedLine(b,j,k,d),a.dashedLine(b,k,l,d),a.dashedLine(b,l,m,d),a.dashedLine(b,m,n,d),a.dashedLine(b,n,o,d),a.dashedLine(b,o,h,d)},H=function(b,c,d){var e=c.ex.dx,f=[c.x+e,c.y+c.h],g=[c.x+e+(c.w-e)/4,c.y+c.h*(e/c.w)],h=[c.x+c.w,g[1]],i=[c.x,c.y+c.h],j=[c.x,c.y],k=[c.x+c.w,c.y];b.moveTo(f[0],f[1]),a.dashedLine(b,f,i,d),a.dashedLine(b,i,j,d),a.dashedLine(b,j,k,d),a.dashedLine(b,k,h,d)},I=function(b,c,d){var e=c.ex.dx,g=[c.x+e,c.y+c.h],h=[c.x+e+(c.w-e)/4,c.y+c.h*(e/c.w)],i=[c.x+e+(c.w-e)/2,c.y+c.h*(e/c.w)+c.h*(1-e/c.w)/4],j=[c.x+c.w,h[1]];b.moveTo(g[0],g[1]),a.dashedLine(b,g,h,d),a.dashedBezier(b,h.concat(i).concat(j),d),a.dashedLine(b,j,g,d);var k=c.fillStyle||"#fff",l=c.style;null==l&&(l=3),1===(1&l)&&(b.fillStyle=f(k),b.fill()),2===(2&l)&&b.stroke()},J=function(b,c,d){var e=c.ex.dx,f=c.ex.dy,g=c.x+c.w/2,h=c.y+c.h/2,i=[c.x+e,c.y+f],j=[c.x+e,c.y],k=[2*g-i[0],c.y],l=[2*g-i[0],c.y+f],m=[c.x+c.w,c.y+f],n=[c.x+c.w,2*h-m[1]],o=[2*g-i[0],2*h-l[1]],p=[2*g-i[0],c.y+c.h],q=[c.x+e,c.y+c.h],r=[c.x+e,2*h-i[1]],s=[c.x,2*h-i[1]],t=[c.x,c.y+f];b.moveTo(i[0],i[1]),a.dashedLine(b,i,j,d),a.dashedLine(b,j,k,d),a.dashedLine(b,k,l,d),a.dashedLine(b,l,m,d),a.dashedLine(b,m,n,d),a.dashedLine(b,n,o,d),a.dashedLine(b,o,p,d),a.dashedLine(b,p,q,d),a.dashedLine(b,q,r,d),a.dashedLine(b,r,s,d),a.dashedLine(b,s,t,d),a.dashedLine(b,t,i,d)},K=function(b,c,d){var e=c.ex.dx,f=c.ex.dy,g=c.x+c.w/2,h=c.y+c.h/2,i=[c.x,c.y+f],j=[c.x+e,c.y+f],k=[c.x+e,c.y],l=[2*g-k[0],c.y],m=[2*g-j[0],c.y+f],n=[c.x+c.w,c.y+f],o=[c.x+c.w,2*h-n[1]],p=[m[0],2*h-m[1]],q=[l[0],c.y+c.h],r=[c.x+e,c.y+c.h],s=[c.x+e,2*h-j[1]],t=[c.x,2*h-i[1]];b.moveTo(i[0],i[1]),a.dashedBezier(b,i.concat(j).concat(k),d),a.dashedLine(b,k,l,d),a.dashedBezier(b,l.concat(m).concat(n),d),a.dashedLine(b,n,o,d),a.dashedBezier(b,o.concat(p).concat(q),d),a.dashedLine(b,q,r,d),a.dashedBezier(b,r.concat(s).concat(t),d),a.dashedLine(b,t,i,d)},L=function(b,c,d){var e=c.ex.dx,f=c.ex.dy,g={x:c.x+e,y:c.y+f,w:c.w-2*e,h:c.h-2*f};a.dashedOval(b,{x:c.x,y:c.y,w:c.w,h:c.h},d),a.dashedOval(b,g,d)},M=function(b,c,d){var e=c.ex.dx,f=c.ex.dy,g={x:c.x+e,y:c.y+f,w:c.w-2*e,h:c.h-2*f};a.dashedOval(b,g,d),b.clip(),b.clearRect(g.x,g.y,g.w,g.h)},N=function(b,c,d){var e=c.ex.dx,f=c.ex.dy,g=c.x+c.w/2,h=c.y+c.h/2,i=[c.x+e,c.y+f];if(g-i[0]!==0){var j=i[0]>g?c.w-e:e,k=i[1]>h?c.h-f:f;k=Math.min(k,c.h*j/c.w);var l=(i[1]-h)/(i[0]-g),m=Math.atan(l),n=[i[0]-k*Math.cos(m),i[1]-k*Math.sin(m)],o=-1,p=null,q=null,r=null,s=null,t=null,u=null;if(b.moveTo(i[0],i[1]),0>l){p=[c.x,h],q=[g,c.y],u=[c.x,c.y],i[1]<h&&(p[0]=2*g-p[0],q[1]=2*h-q[1],u=[2*g-u[0],2*h-u[1]],o=1,n=[i[0]+j*Math.cos(m),i[1]+k*Math.sin(m)]),Math.abs(n[0]-g)>c.w/2&&(n[0]=p[0],n[1]=l*(p[0]-g)+h),Math.abs(n[1]-h)>c.h/2&&(n[1]=p[1],n[0]=(p[1]-h)/l+g),t=[p[0],n[1]];var v=[2*g-u[0],u[1]];r=[2*g-p[0],p[1]];var w=[2*g-t[0],t[1]];s=[2*g-n[0],n[1]];var x=[2*g-i[0],i[1]],y=[r[0]+o*c.w*k/c.h,x[1]],z=[y[0],r[1]],A=[g,q[1]-o*k],B=[z[0],A[1]],C=[2*g-z[0],z[1]];a.dashedLine(b,i,n,d),a.dashedBezier(b,n.concat(t).concat(p),d),a.dashedBezier(b,p.concat(u).concat(q),d),a.dashedBezier(b,q.concat(v).concat(r),d),a.dashedBezier(b,r.concat(w).concat(s),d),a.dashedLine(b,s,x,d),a.dashedBezier(b,x.concat(y).concat(z),d),a.dashedBezier(b,z.concat(B).concat(A),d),a.dashedBezier(b,A.concat(2*g-B[0],B[1]).concat(C),d),a.dashedBezier(b,C.concat(2*g-y[0],y[1]).concat(i),d)}else p=[g,c.y],i[1]>h&&(p[1]=2*h-p[1],n=[i[0]+k*Math.cos(m),i[1]+k*Math.sin(m)],o=1),q=[2*g-n[0],n[1]],t=[n[0],p[1]],r=[2*g-i[0],i[1]],s=[g,p[1]-o*k],u=[r[0],s[1]],a.dashedLine(b,i,n,d),a.dashedBezier(b,n.concat(t).concat(p),d),a.dashedBezier(b,p.concat([2*g-t[0],t[1]]).concat(q),d),a.dashedLine(b,q,r,d),a.dashedBezier(b,r.concat(u).concat(s),d),a.dashedBezier(b,s.concat([2*g-u[0],u[1]]).concat(i),d)}},O=function(b,c,d){var e=c.x+c.w/2,f=c.y+c.h/2,g=[e,f],h=a.calcExArc(c),i=h[0],j=h[1],k=V(b,c,i,j,d);a.dashedLine(b,k[1],g,d),a.dashedLine(b,g,k[0],d)},P=function(b,c,d){var e=a.calcExArc(c),f=e[0],g=e[1],h=V(b,c,f,g,d);a.dashedLine(b,h[1],h[0],d)},Q=function(b,c,d){var e=c.ex,f=[c.x+e.dx,c.y+e.dy],g=V(b,c,0,3*Math.PI/2,d),h=[c.x+c.w,c.y];a.dashedBezier(b,g[1].concat(h).concat(f),d),a.dashedBezier(b,f.concat(h).concat(g[0]),d)},R=function(a,b,c){var d=b.ex,e=d.dx;V(a,{x:b.x,y:b.y,w:2*b.w,h:b.h},Math.PI/2,3*Math.PI/2,c),V(a,{x:b.x+e,y:b.y,w:2*b.w-2*e,h:b.h},Math.PI/2,3*Math.PI/2,c,!0)},S=function(b,c,d){var e=c.x+c.w/2,f=c.y+c.h/2,g=c.ex,h={x:c.x+g.dx,y:c.y+c.h*g.dx/c.w,w:c.w-2*g.dx,h:c.h-2*(c.h*g.dx/c.w)};V(b,h,0,2*Math.PI,d);var i=c.w/8,j=1;i!==c.w/2&&(j=(g.dx-i)/(c.w/2-i));for(var k=g.dx-i*j,l=c.h*k/c.w,m=c.h/c.w,n=Math.atan(m*g.dx/(c.w/2-g.dx))*(1-j),o=0;8>o;o++){var p=[c.w/2*Math.cos(Math.PI/4*o)+e,c.h/2*Math.sin(Math.PI/4*o)+f],q=[(c.w-2*k)/2*Math.cos(n+Math.PI/4*o)+e,(c.h-2*l)/2*Math.sin(n+Math.PI/4*o)+f],r=[(c.w-2*k)/2*Math.cos(Math.PI/4*o-n)+e,(c.h-2*l)/2*Math.sin(Math.PI/4*o-n)+f];b.moveTo(p[0],p[1]),a.dashedLine(b,p,q),a.dashedLine(b,q,r),a.dashedLine(b,r,p)}},T=function(b,c,d){var e=c.w/5,f=c.w/10,g=c.h/20,h=[c.x+2*c.w/5,c.y],i=[h[0]+e,c.y+c.h/4],j=[i[0]-f,i[1]+g],k=[i[0]+e,c.y+c.h/2+g],l=[k[0]-f,k[1]+g],m=[c.x+c.w,c.y+c.h],n=[h[0],m[1]-c.h/3],o=[j[0],n[1]-g],p=[c.x+c.w/4,c.y+c.h/2-g],q=[h[0],p[1]-g],r=[c.x,c.y+c.h/6];b.moveTo(h[0],h[1]),a.dashedLine(b,h,i,d),a.dashedLine(b,i,j,d),a.dashedLine(b,j,k,d),a.dashedLine(b,k,l,d),a.dashedLine(b,l,m,d),a.dashedLine(b,m,n,d),a.dashedLine(b,n,o,d),a.dashedLine(b,o,p,d),a.dashedLine(b,p,q,d),a.dashedLine(b,q,r,d),a.dashedLine(b,r,h,d)},U=function(b,c,d){var e=c.x+c.w/2,f=c.ex,g=f.dx,h=f.dy;V(b,c,0,2*Math.PI,d);var i=c.w/6,j=c.h/6,k={x:c.x+c.w/3-i/2,y:c.y+c.h/3-j/2,w:i,h:j};V(b,k,0,2*Math.PI,d),k.x=2*e-c.x-c.w/3-i/2,V(b,k,0,2*Math.PI,d);var l=[c.x+c.w/5,c.y+2*c.h/3],m=[2*e-l[0],l[1]];b.moveTo(l[0],l[1]),a.dashedBezier(b,l.concat([c.x+g,c.y+h]).concat(m),d)},V=function(b,c,d,e,f,g){for(var h=c.x+c.w/2,i=c.y+c.h/2,j=[0,0],k=[],l=0,m=0,n=g?e:d,o=g?-1:1;g?n>d:e>n;){var p=[c.w/2*Math.cos(n)+h,c.h/2*Math.sin(n)+i];if(n===d)b.moveTo(p[0],p[1]),k[0]=p;else if(null==f)b.lineTo(p[0],p[1]);else{l+=a.distance(p,j);var q=f[m%f.length];l>q?(l=0,m++):m%2===0?b.lineTo(p[0],p[1]):b.moveTo(p[0],p[1])}n+=.02*o,j=p}return n=g?d:e,j=[c.w/2*Math.cos(n)+h,c.h/2*Math.sin(n)+i],m%2===0?b.lineTo(j[0],j[1]):b.moveTo(j[0],j[1]),k[1]=j,k};a.reg({oval:{renderer:function(b,c,d){a.dashedOval(b,c,d)},isOver:e},ovalx:{init:function(a){a.ex={dx:.1*a.w,dy:a.h+.3*a.h}},renderer:a.dashedOval,isOver:function(a,b,c){return e(a,b,c)||d.ovalx.isExOver(a,b,c)},isExOver:function(b,c,d){var e=[d.x+d.ex.dx,d.y+d.ex.dy];return a.doOvalEx(d,e,function(d,f){return a.inTriangle(d,f,e,[b,c])})},exFreeze:function(a,b,c){return!d.ovalx.isExOver(a,b,c)}},rect:{renderer:i},rectx:{init:function(a){a.ex={dx:.1*a.w,dy:a.h+.3*a.h}},renderer:i,isOver:function(b,c,e){return a.inRect(e.x,e.y,e.w,e.h,[b,c])||d.rectx.isExOver(b,c,e)},isExOver:function(b,c,d){var e=[d.x+d.ex.dx,d.y+d.ex.dy];return u(d,e,function(d,f){return a.inTriangle(d,f,e,[b,c])})},exFreeze:function(a,b,c){return!d.rectx.isExOver(a,b,c)}},doc:{renderer:function(a,b,c){x(a,b.x,b.y,b.w,b.h,c)},isOver:function(a,b,c){return z(c.x,c.y,c.w,c.h,[a,b])}},docs:{renderer:function(a,b,c){A(a,b.x,b.y,b.w,b.h,c)},isOver:function(a,b,c){return B(c.x,c.y,c.w,c.h,[a,b])}},triangle:{init:function(a){a.ex={dx:a.w/2,dy:0}},renderer:t,isOver:function(b,c,d){var e=[d.x,d.y+d.h],f=[d.x+d.w,d.y+d.h],g=[d.x+d.ex.dx,d.y+d.ex.dy];return a.inTriangle(e,f,g,[b,c])}},cube:{init:function(a){a.ex={dx:3*a.w/4,dy:1*a.h/4}},renderer:g},stick:{init:function(a){a.ex={dx:a.w/2,dy:a.h/2}},renderer:h},diamond:{renderer:j,isOver:k},parallelogram:{init:function(a){a.ex={dx:a.w/4,dy:-10}},renderer:l,isOver:m},ladder:{init:function(a){a.ex={dx:a.w/4,dy:a.h+10}},renderer:n,isOver:o},lbracket:{init:function(a){a.ex={dx:-10,dy:a.h/6},a.style=2},renderer:p},rbracket:{init:function(a){a.ex={dx:a.w+10,dy:a.h/6},a.style=2},renderer:p},brackets:{init:function(a){a.ex={dx:a.w/4,dy:a.h/6},a.style=2},renderer:q},lbrace:{init:function(a){a.ex=[{dx:a.w/2,dy:a.w/4},{dx:-10,dy:a.h/2}],a.style=2},renderer:r},rbrace:{init:function(a){a.ex=[{dx:a.w/2+1,dy:a.w/4},{dx:a.w+10,dy:a.h/2}],a.style=2},renderer:r},braces:{init:function(a){a.ex=[{dx:a.w/4,dy:a.w/4},{dx:-10,dy:a.h/2}],a.style=2},renderer:s},cloud:{renderer:C},heart:{renderer:D},pollygon5:{renderer:E},pollygon6:{init:function(a){a.ex={dx:a.w/4,dy:-10}},renderer:F},pollygon8:{init:function(a){a.ex={dx:a.w/4,dy:-10}},renderer:G},foldingRect:{init:function(a){a.ex={dx:3*a.w/4,dy:a.h+10}},renderer:H,drawAfter:I},cross:{init:function(a){a.ex={dx:a.w/4,dy:a.h/4}},renderer:J},missingCorner:{init:function(a){a.ex={dx:a.w/4,dy:a.h/4}},renderer:K},emptyOval:{init:function(a){a.ex={dx:a.w/4,dy:a.h/4}},renderer:L,drawAfter:M},arcRing:{init:function(a){a.ex={dx:a.w/4,dy:a.h/2}},renderer:N},pie:{init:function(a){a.ex=[{dx:a.w,dy:a.h/2},{dx:a.w/2,dy:0}]},renderer:O},chord:{init:function(a){a.ex=[{dx:a.w,dy:a.h/2},{dx:a.w/2,dy:0}]},renderer:P},teardrop:{init:function(a){a.ex={dx:a.w,dy:0}},renderer:Q},moon:{init:function(a){a.ex={dx:a.w/2,dy:a.h/2}},renderer:R},smileyface:{init:function(a){a.ex={dx:a.w/2,dy:a.h}},renderer:U},sun:{init:function(a){a.ex={dx:a.w/8,dy:a.h/2}},renderer:S},lightning:{renderer:T}})}(window.jh2d=window.jh2d||{}),function(a,b,c){var d=a.darkColor,e=function(b,c,d){var e=c.ex.dx,f=c.y+c.h/2,g=[c.x,c.y],h=[c.x+e,c.y],i=[c.x+c.w,f],j=[c.x+e,c.y+c.h],k=[c.x,c.y+c.h];b.moveTo(g[0],g[1]),a.dashedLine(b,g,h,d),a.dashedLine(b,h,i,d),a.dashedLine(b,i,j,d),a.dashedLine(b,j,k,d),a.dashedLine(b,k,g,d)},f=function(b,c,d){var e=c.ex.dx,f=c.y+c.h/2,g=[c.x,c.y],h=[c.x+e,c.y],i=[c.x+c.w,f],j=[c.x+e,c.y+c.h],k=[c.x,c.y+c.h],l=[c.x+c.w-e,f];b.moveTo(g[0],g[1]),a.dashedLine(b,g,h,d),a.dashedLine(b,h,i,d),a.dashedLine(b,i,j,d),a.dashedLine(b,j,k,d),a.dashedLine(b,k,l,d),a.dashedLine(b,l,g,d)},g=function(b,c,d,e,f,g,h,i){var j=c+e/2,k=d+f/2,l=h[0],m=h[1],n=null;return g=g||1,1===(1&g)||2===(2&g)?(a.dashedLine(b,[l,m],[l,d],i),a.dashedLine(b,[l,d],[c,k],i),a.dashedLine(b,[c,k],[l,d+f],i),n=[l,2*k-m],a.dashedLine(b,[l,d+f],n,i),n):4===(4&g)||8===(8&g)?(a.dashedLine(b,[l,m],[c,m],i),a.dashedLine(b,[c,m],[j,d],i),a.dashedLine(b,[j,d],[c+e,m],i),n=[2*j-l,m],a.dashedLine(b,[c+e,m],n,i),n):void 0},h=function(b,c,d,e,f,h,i,j){var k=c+e/2,l=d+f/2,m=c+i[0],n=d+i[1];h=h||1;var o=null,p=null;1===(1&h)||4===(4&h)?(o=[m,n],p=g(b,c,d,e,f,h,[m,n],j)):2===(2&h)?(o=[c,n],p=[c,2*l-n],a.dashedLine(b,o,p,j)):8===(8&h)&&(o=[m,d],p=[2*k-m,d],a.dashedLine(b,o,p,j)),2===(2&h)||8===(8&h)?(a.dashedLine(b,p,[2*k-m,2*l-n],j),b.save(),b.translate(k,l),b.rotate(-Math.PI),p=g(b,c-k,d-l,e,f,h,[m-k,n-l],j),a.dashedLine(b,p,[k-o[0],l-o[1]],j),b.restore()):1===(1&h)?(a.dashedLine(b,p,[c+e,2*l-n],j),a.dashedLine(b,[c+e,2*l-n],[c+e,n],j),a.dashedLine(b,[c+e,n],[m,n],j)):4===(4&h)&&(a.dashedLine(b,p,[2*k-m,d+f],j),a.dashedLine(b,[2*k-m,d+f],[m,d+f],j),a.dashedLine(b,[m,d+f],[m,n],j))},i=function(b,c,d){var e=c.ex.dx,f=c.ex.dy,g=c.y+c.h/2;h(b,c.x,c.y,c.w,c.h,2,[c.w-e,f],d);var i=[c.x,c.y+f],j=[c.x+(c.w-e)*(1-2*f/c.h),g];a.dashedLine(b,i,j,d),a.dashedLine(b,j,[c.x,2*g-i[1]],d)},j=function(b,c,d,e,f,g,h){var i=b+d/2,j=c+e/2,k=b+g[0],l=c+g[1],m=!1,n=!1,o=null,p=null;return 1===(1&f)&&(m=a.inTriangle([k,c],[b,j],[k,c+e],h),o=[k,l],p=[b+d,2*j-l]),4===(4&f)&&(m=a.inTriangle([b,l],[i,c],[b+d,l],h),o=[k,l],p=[2*i-k,c+e]),2===(2&f)&&(n=a.inTriangle([2*i-k,c],[2*i-b,j],[2*i-k,c+e],h),p=[2*i-k,2*j-l],null==o&&(o=[b,l])),8===(8&f)&&(n=a.inTriangle([b,2*j-l],[i,c+e],[b+d,2*j-l],h),p=[2*i-k,2*j-l],null==o&&(o=[k,c])),m||n||a.inRect(o[0],o[1],p[0]-o[0],p[1]-o[1],h)},k=function(a,b,c,d,e,f){var g=a+c/2,h=b+d/2,i=a+f[0],j=b+f[1],k=[];return 1===(1&e)&&(k[k.length]=[i,b],k[k.length]=[i,b+d]),4===(4&e)&&(k[k.length]=[a+c,j],k[k.length]=[a,j]),2===(2&e)&&(k[k.length]=[2*g-i,b],k[k.length]=[2*g-i,b+d]),8===(8&e)&&(k[k.length]=[a,2*h-j],k[k.length]=[a+c,2*h-j]),(1===(1&e)||2===(2&e))&&(k[k.length]=[g,j],k[k.length]=[g,2*h-j],k[k.length]=[a,h],k[k.length]=[2*g-a,h]),(4===(4&e)||8===(8&e))&&(k[k.length]=[i,h],k[k.length]=[2*g-i,h],k[k.length]=[g,b],k[k.length]=[g,b+d]),k},l=function(b,c,e,f){var g=.5522848,h=5*c.w/6,i=2*c.w/3,j=h/2*g,k=c.ex[0],l=c.ex[1],m=c.ex[2],n=c.h*(f?1:0),o=c.h*(f?0:1),p=[c.x+2*(k.dx-h)-m.dx+i,c.y+n],q=[c.x+k.dx,c.y+n],r=[p[0]+(q[0]-p[0])/2,c.y+o],s=[c.x,c.y+n],t=[c.x+2*h-k.dx+m.dx-i,c.y+n],u=[s[0]+(t[0]-s[0])/2,c.y+o];b.moveTo(p[0],p[1]),a.dashedBezier(b,p.concat([r[0]-j,c.y+o]).concat(r),e),a.dashedLine(b,r,u,e),a.dashedBezier(b,u.concat([u[0]-j,c.y+o]).concat(s),e);var v=c.fillStyle||"#fff";b.fillStyle=d(v),b.closePath(),b.fill();var w=c.style;null==w&&(w=3),2===(2&w)&&b.stroke(),b.beginPath(),b.moveTo(r[0],r[1]);var x=r.concat([r[0]+j,c.y+o]).concat(q),y=a.bezier(x,Math.abs((o-l.dy)/c.h)),z=r.concat([r[0]+(y[0]-r[0])/2,c.y+o]).concat(y);a.dashedBezier(b,z,e);var A=t.concat([u[0]+j,c.y+o]).concat(u),B=a.bezier(A,Math.abs((n-l.dy)/c.h)),C=B.concat([u[0]+(B[0]-u[0])/2,c.y+o]).concat(u),D=c.w-k.dx,E=t[0]+(q[0]-t[0])/2,F=[y[0]+D,y[1]],G=[E,c.y+n],H=[B[0]-D,B[1]];a.dashedLine(b,z.slice(z.length-2),F,e),a.dashedLine(b,F,G,e),a.dashedLine(b,G,H,e),a.dashedLine(b,H,C.slice(0,2),e),a.dashedBezier(b,C,e)},m=function(b,c,e,f){var g=.5522848,h=5*c.h/6,i=2*c.h/3,j=h/2*g,k=c.ex[0],l=c.ex[1],m=c.ex[2],n=c.w*(f?1:0),o=c.w*(f?0:1),p=[c.x+n,c.y+2*(k.dy-h)-m.dy+i],q=[c.x+n,c.y+k.dy],r=[c.x+o,p[1]+(q[1]-p[1])/2],s=[c.x+n,c.y],t=[c.x+n,c.y+2*h-k.dy+m.dy-i],u=[c.x+o,s[1]+(t[1]-s[1])/2];b.moveTo(p[0],p[1]),a.dashedBezier(b,p.concat([c.x+o,r[1]-j]).concat(r),e),a.dashedLine(b,r,u,e),a.dashedBezier(b,u.concat([c.x+o,u[1]-j]).concat(s),e);var v=c.fillStyle||"#fff";b.fillStyle=d(v),b.closePath(),b.fill();var w=c.style;null==w&&(w=3),2===(2&w)&&b.stroke(),b.beginPath(),b.moveTo(r[0],r[1]);var x=r.concat([c.x+o,r[1]+j]).concat(q),y=a.bezier(x,Math.abs((o-l.dx)/c.w)),z=r.concat([c.x+o,r[1]+(y[1]-r[1])/2]).concat(y);a.dashedBezier(b,z,e);var A=t.concat([c.x+o,u[1]+j]).concat(u),B=a.bezier(A,Math.abs((n-l.dx)/c.w)),C=B.concat([c.x+o,u[1]+(B[1]-u[1])/2]).concat(u),D=c.h-k.dy,E=t[1]+(q[1]-t[1])/2,F=[y[0],y[1]+D],G=[c.x+n,E],H=[B[0],B[1]-D];a.dashedLine(b,z.slice(z.length-2),F,e),a.dashedLine(b,F,G,e),a.dashedLine(b,G,H,e),a.dashedLine(b,H,C.slice(0,2),e),a.dashedBezier(b,C,e)},n=function(b,c,d,e){var f=c.ex[0].dx,g=c.ex[0].dy,h=c.ex[1].dx,i=c.x+c.w/2,j=c.y+c.h/2;3===e&&(j+=h/c.w*c.h);var k=[c.x+f,j-c.h*(i-(c.x+f))/c.w],l=[c.x+f,c.y+g],m=[c.x+h,l[1]],n=[i,c.y],o=[2*i-m[0],m[1]],p=[2*i-l[0],l[1]],q=[2*i-k[0],k[1]],r=[c.x+c.w-g/c.h*c.w,k[1]],s=[r[0],j-(c.w/2-h)/c.w*c.h],t=[c.x+c.w,j],u=[s[0],2*j-s[1]],v=[r[0],2*j-r[1]],w=[q[0],2*j-q[1]],x=[p[0],2*j-p[1]],y=[o[0],2*j-o[1]],z=[n[0],2*j-n[1]],A=[m[0],2*j-m[1]],B=[l[0],2*j-l[1]],C=[k[0],2*j-k[1]],D=[2*i-v[0],v[1]],E=[2*i-u[0],u[1]],F=[2*i-t[0],t[1]],G=[2*i-s[0],s[1]],H=[2*i-r[0],r[1]];b.moveTo(k[0],k[1]),a.dashedLine(b,k,l,d),a.dashedLine(b,l,m,d),a.dashedLine(b,m,n,d),a.dashedLine(b,n,o,d),a.dashedLine(b,o,p,d),a.dashedLine(b,p,q,d),(null===e||3===e)&&(a.dashedLine(b,q,r,d),a.dashedLine(b,r,s,d),a.dashedLine(b,s,t,d),a.dashedLine(b,t,u,d),a.dashedLine(b,u,v,d),a.dashedLine(b,v,w,d)),3===e?(a.dashedLine(b,w,C,d),a.dashedLine(b,w,C,d)):(a.dashedLine(b,w,x,d),a.dashedLine(b,x,y,d),a.dashedLine(b,y,z,d),a.dashedLine(b,z,A,d),a.dashedLine(b,A,B,d),a.dashedLine(b,B,C,d)),a.dashedLine(b,C,D,d),a.dashedLine(b,D,E,d),a.dashedLine(b,E,F,d),a.dashedLine(b,F,G,d),a.dashedLine(b,G,H,d),a.dashedLine(b,H,k,d)},o=function(a,b,c){n(a,b,c,3)},p=function(b,c,d,e){var f=c.ex[0].dx,g=c.ex[0].dy,h=c.ex[1].dx,i=c.x+(c.w-h)/2+h,j=[c.x+f,c.y+g],k=[c.x+h,j[1]],l=[i,c.y],m=[2*i-k[0],k[1]],n=[2*i-j[0],j[1]],o=h/c.w*c.h,p=c.y+o+(c.h-o)/2,q=g/c.h*c.w,r=f/c.w*c.h,s=[c.x+q,c.y+r],t=[s[0],c.y+o],u=[c.x,p],v=[t[0],2*p-t[1]],w=[s[0],2*p-s[1]],x=[n[0],1===e?c.y+c.h:w[1]],y=[j[0],1===e?s[1]+(x[1]-w[1]):s[1]];1===e&&(w=[c.x,x[1]],s=[c.x,y[1]]),b.moveTo(j[0],j[1]),a.dashedLine(b,j,k,d),a.dashedLine(b,k,l,d),a.dashedLine(b,l,m,d),a.dashedLine(b,m,n,d),a.dashedLine(b,n,x,d),a.dashedLine(b,x,w,d),1===e?a.dashedLine(b,w,s,d):(a.dashedLine(b,w,v,d),a.dashedLine(b,v,u,d),a.dashedLine(b,u,t,d),a.dashedLine(b,t,s,d)),a.dashedLine(b,s,y,d),a.dashedLine(b,y,j,d)},q=function(a,b,c){p(a,b,c,1)},r=function(b,c,d){var e=c.ex.dx,f=c.ex.dy,g=c.y+c.h/2,h=[c.x+e,c.y+f],i=[h[0],c.y],j=[c.x+c.w,c.y+c.h/3],k=[i[0],2*j[1]-i[1]],l=[h[0],2*j[1]-h[1]],m=l[1]-h[1],n=[c.x+m,k[1]],o=[n[0],l[1]],p=[n[0],c.y+c.h],q=[c.x,p[1]],r=[c.x,g],s=[c.x,h[1]];b.moveTo(h[0],h[1]),a.dashedLine(b,h,i,d),a.dashedLine(b,i,j,d),a.dashedLine(b,j,k,d),a.dashedLine(b,k,l,d),a.dashedBezier(b,l.concat(o).concat(n),d),a.dashedLine(b,n,p,d),a.dashedLine(b,p,q,d),a.dashedLine(b,q,r,d),a.dashedBezier(b,r.concat(s).concat(h),d)},s=function(b,c,d){var e=[c.x+3*c.w/4,c.y+2*c.h/3],f=[c.x+c.w,c.y+3*c.h/8],g=[c.x+7*c.w/8,f[1]],h=[c.x+(g[0]-c.x)/2,c.y],i=[g[0],c.y],j=[c.x,c.y],k=[c.x,g[1]],l=[c.x,c.y+c.h],m=[2*e[0]-f[0],f[1]],n=[2*e[0]-g[0],g[1]],o=[h[0],c.y+c.h/4],p=[2*o[0]-n[0],n[1]],q=[p[0],l[1]],r=[p[0],o[1]],s=[n[0],o[1]];b.moveTo(e[0],e[1]),a.dashedLine(b,e,f,d),a.dashedLine(b,f,g,d),a.dashedBezier(b,g.concat(i).concat(h),d),a.dashedBezier(b,h.concat(j).concat(k),d),a.dashedLine(b,k,l,d),a.dashedLine(b,l,q,d),a.dashedLine(b,q,p,d),a.dashedBezier(b,p.concat(r).concat(o),d),a.dashedBezier(b,o.concat(s).concat(n),d),a.dashedLine(b,n,m,d),a.dashedLine(b,m,e,d)},t=function(b,c,d){var e=c.ex[0].dx,f=c.ex[1].dx,g=c.ex[1].dy,h=c.ex[2].dy,i=[c.x+e,c.y],j=[i[0],c.y+g],k=[c.x+f,c.y+g],l=[k[0],c.y+h],m=[c.x+c.w,c.y+c.h/2],n=[l[0],2*m[1]-l[1]],o=[k[0],2*m[1]-k[1]],p=[j[0],2*m[1]-j[1]],q=[p[0],c.y+c.h],r=[c.x,c.y+c.h],s=[c.x,c.y];b.moveTo(i[0],i[1]),a.dashedLine(b,i,j,d),a.dashedLine(b,j,k,d),a.dashedLine(b,k,l,d),a.dashedLine(b,l,m,d),a.dashedLine(b,m,n,d),a.dashedLine(b,n,o,d),a.dashedLine(b,o,p,d),a.dashedLine(b,p,q,d),a.dashedLine(b,q,r,d),a.dashedLine(b,r,s,d),a.dashedLine(b,s,i,d)},u=function(b,c){for(var d=c.ex[1].dx,e=c.ex[1].dy,f=c.x+c.w/2,g=c.y+c.h/2,h=a.calcExArc(c),i=h[0],j=h[1],k=0,l=0,m=i;j>=m;)k=c.w/2*Math.cos(m)+f,l=c.h/2*Math.sin(m)+g,m===i?b.moveTo(k,l):b.lineTo(k,l),m+=.02;var n=Math.abs(d-c.w/2),o=Math.abs(e-c.h/2);for(m=j;m>=i;){var p=n*Math.cos(m)+f,q=c.h*n/c.w*Math.sin(m)+g;if(o>n&&(p=c.w*o/c.h*Math.cos(m)+f,q=o*Math.sin(m)+g),m===j){var r=p+(k-p)/2,s=q+(l-q)/2;k=c.w/2*Math.cos(m+Math.PI/6)+f,l=c.h/2*Math.sin(m+Math.PI/6)+g;var t=5*c.w/8*Math.cos(m)+f,u=5*c.h/8*Math.sin(m)+g;b.lineTo(t,u),b.lineTo(k,l),b.lineTo(2*r-t,2*s-u)}b.lineTo(p,q),m-=.02}b.closePath()};a.reg({downArcArrow:{init:function(a){a.ex=[{dx:11*a.w/12,dy:-10},{dx:a.w+10,dy:a.h/5},{dx:2*a.w/3,dy:-10}]},renderer:l},upArcArrow:{init:function(a){a.ex=[{dx:11*a.w/12,dy:a.h+10},{dx:a.w+10,dy:4*a.h/5},{dx:2*a.w/3,dy:a.h+10}]},renderer:function(a,b,c){l(a,b,c,!0)}},rightArcArrow:{init:function(a){a.ex=[{dy:11*a.h/12,dx:-10},{dy:a.h+10,dx:a.w/5},{dy:2*a.h/3,dx:-10}]},renderer:m},leftArcArrow:{init:function(a){a.ex=[{dy:11*a.h/12,dx:a.w+10},{dy:a.h+10,dx:4*a.w/5},{dy:2*a.h/3,dx:a.w+10}]},renderer:function(a,b,c){m(a,b,c,!0)}},arrow:{init:function(a){a.ex={dx:a.w/5,dy:a.h/5},a.arrow=a.arrow||3},renderer:function(a,b,c){h(a,b.x,b.y,b.w,b.h,b.arrow,[b.ex.dx,b.ex.dy],c),a.closePath()},isOver:function(a,b,c){return j(c.x,c.y,c.w,c.h,c.arrow,[c.ex.dx,c.ex.dy],[a,b])},getConnectPts:function(a){return k(a.x,a.y,a.w,a.h,a.arrow,[a.ex.dx,a.ex.dy])}},larrow:{init:function(a){a.ex={dx:a.w/5,dy:a.h/5}},renderer:function(a,b,c){var d=0,e=0;d=b.ex.dx,e=b.ex.dy,h(a,b.x,b.y,b.w,b.h,1,[d,e],c),a.closePath()},isOver:function(a,b,c){return j(c.x,c.y,c.w,c.h,1,[c.ex.dx,c.ex.dy],[a,b])},getConnectPts:function(a){return k(a.x,a.y,a.w,a.h,1,[a.ex.dx,a.ex.dy])}},rarrow:{init:function(a){a.ex={dx:a.w-a.w/5,dy:a.h/5
}},renderer:function(a,b,c){h(a,b.x,b.y,b.w,b.h,2,[b.w-b.ex.dx,b.ex.dy],c),a.closePath()},isOver:function(a,b,c){return j(c.x,c.y,c.w,c.h,2,[c.w-c.ex.dx,c.ex.dy],[a,b])},getConnectPts:function(a){return k(a.x,a.y,a.w,a.h,2,[a.w-a.ex.dx,a.ex.dy])}},lrarrow:{init:function(a){a.ex={dx:a.w/5,dy:a.h/5}},renderer:function(a,b,c){h(a,b.x,b.y,b.w,b.h,3,[b.ex.dx,b.ex.dy],c),a.closePath()},isOver:function(a,b,c){return j(c.x,c.y,c.w,c.h,3,[c.ex.dx,c.ex.dy],[a,b])},getConnectPts:function(a){return k(a.x,a.y,a.w,a.h,3,[a.ex.dx,a.ex.dy])}},uarrow:{init:function(a){a.ex={dx:a.w/5,dy:a.h/5}},renderer:function(a,b,c){h(a,b.x,b.y,b.w,b.h,4,[b.ex.dx,b.ex.dy],c),a.closePath()},isOver:function(a,b,c){return j(c.x,c.y,c.w,c.h,4,[c.ex.dx,c.ex.dy],[a,b])},getConnectPts:function(a){return k(a.x,a.y,a.w,a.h,4,[a.ex.dx,a.ex.dy])}},darrow:{init:function(a){a.ex={dx:a.w/5,dy:a.h-a.h/5}},renderer:function(a,b,c){h(a,b.x,b.y,b.w,b.h,8,[b.ex.dx,b.h-b.ex.dy],c),a.closePath()},isOver:function(a,b,c){return j(c.x,c.y,c.w,c.h,8,[c.ex.dx,c.h-c.ex.dy],[a,b])},getConnectPts:function(a){return k(a.x,a.y,a.w,a.h,8,[a.ex.dx,a.h-a.ex.dy])}},udarrow:{init:function(a){a.ex={dx:a.w/5,dy:a.h/5}},renderer:function(a,b,c){h(a,b.x,b.y,b.w,b.h,12,[b.ex.dx,b.ex.dy],c),a.closePath()},isOver:function(a,b,c){return j(c.x,c.y,c.w,c.h,12,[c.ex.dx,c.ex.dy],[a,b])},getConnectPts:function(a){return k(a.x,a.y,a.w,a.h,12,[a.ex.dx,a.ex.dy])}},rightPollygon5:{init:function(a){a.ex={dx:3*a.w/4,dy:-10}},renderer:e},forkedtail:{init:function(a){a.ex={dx:3*a.w/4,dy:-10}},renderer:f},forkedtailArrow:{init:function(a){a.ex={dx:a.w-a.w/5,dy:a.h/5}},renderer:i},crossArrow:{init:function(a){a.ex=[{dx:3*a.w/8,dy:a.h/8},{dx:1*a.w/4,dy:-10}]},renderer:n},tStyleArrow:{init:function(a){a.ex=[{dx:3*a.w/8,dy:a.h/8},{dx:1*a.w/4,dy:-10}]},renderer:o},rightAngledArrow:{init:function(a){a.ex=[{dx:a.w/2,dy:a.h/4},{dx:3*a.w/8,dy:-10}]},renderer:p},rightAngledUpArrow:{init:function(a){a.ex=[{dx:a.w/2,dy:a.h/4},{dx:3*a.w/8,dy:-10}]},renderer:q},roundCornerArrow:{init:function(a){a.ex={dx:2*a.w/3,dy:a.h/5}},renderer:r},walkingStickArrow:{renderer:s},rightCommentArrow:{init:function(a){a.ex=[{dx:2*a.w/3,dy:-10},{dx:5*a.w/6,dy:3*a.h/8},{dx:a.w+10,dy:a.h/4}]},renderer:t},cycleArrow:{init:function(a){a.ex=[{dx:0,dy:a.h/2},{dx:3*a.w/4,dy:a.h/2}]},renderer:u}})}(window.jh2d=window.jh2d||{}),function(a,b,c){var d=function(b,c,d){var e=[c.x,c.y],f=[c.x+c.w,c.y],g=[c.x+c.w,c.y+c.h],h=[c.x,c.y+c.h];b.moveTo(e[0],e[1]),a.dashedLine(b,e,f,d),a.dashedLine(b,f,g,d),a.dashedLine(b,g,h,d),a.dashedLine(b,h,e,d)},e=function(b,c,d){var e=c.ex,f=[c.x+e[0].dx,c.y+e[0].dy],g=[c.x+e[1].dx,c.y+e[1].dy];if(b.moveTo(f[0],f[1]),a.dashedLine(b,f,g,d),c.accent){var h=[f[0],c.y],i=[f[0],c.y+c.h];b.moveTo(h[0],h[1]),a.dashedLine(b,h,i,d)}b.stroke()},f=function(b,c,d){var e=c.ex,f=[c.x+e[0].dx,c.y+e[0].dy],g=[c.x+e[1].dx,c.y+e[1].dy],h=[c.x+e[2].dx,c.y+e[2].dy];if(b.moveTo(f[0],f[1]),a.dashedLine(b,f,g,d),a.dashedLine(b,g,h,d),c.accent){var i=[f[0],c.y],j=[f[0],c.y+c.h];b.moveTo(i[0],i[1]),a.dashedLine(b,i,j,d)}b.stroke()},g=function(b,c,d){var e=c.ex,f=[c.x+e[0].dx,c.y+e[0].dy],g=[c.x+e[1].dx,c.y+e[1].dy],h=[c.x+e[2].dx,c.y+e[2].dy],i=[c.x+e[3].dx,c.y+e[3].dy];if(b.moveTo(f[0],f[1]),a.dashedLine(b,f,g,d),a.dashedLine(b,g,h,d),a.dashedLine(b,h,i,d),c.accent){var j=[f[0],c.y],k=[f[0],c.y+c.h];b.moveTo(j[0],j[1]),a.dashedLine(b,j,k,d)}b.stroke()};a.reg({callout1:{init:function(a){a.ex=[{dx:-a.w/10,dy:a.h/5},{dx:-a.w/3,dy:a.h+a.h/10}]},renderer:d,drawAfter:e},callout2:{init:function(a){a.ex=[{dx:-a.w/10,dy:a.h/5},{dx:-a.w/4,dy:a.h/5},{dx:-a.w/3,dy:a.h+a.h/10}]},renderer:d,drawAfter:f},callout3:{init:function(a){a.ex=[{dx:-a.w/10,dy:a.h/5},{dx:-a.w/4,dy:a.h/5},{dx:-a.w/3,dy:a.h},{dx:-a.w/10,dy:a.h+a.h/10}]},renderer:d,drawAfter:g}})}(window.jh2d=window.jh2d||{}),function(a,b,c){var d=function(b,c,d,e,f,g,h,i){for(var j=0,k=64,l=1/Math.sqrt(Math.pow(g-c,2)+Math.pow(f-b,2));1>=j;){var m=a.bezier([b,c,d,e,f,g],j);if(Math.pow(i-m[1],2)+Math.pow(h-m[0],2)<k)return!0;j+=l}return!1},e=function(b,c,d,e,f,g,h,i,j,k){for(var l=0,m=64,n=1/Math.sqrt(Math.pow(i-c,2)+Math.pow(h-b,2));1>=l;){var o=a.bezier([b,c,d,e,f,g,h,i],l);if(Math.pow(k-o[1],2)+Math.pow(j-o[0],2)<m)return!0;l+=n}return!1},f=function(b,c,d){var e=[c.x,c.y],f=[c.x+c.w,c.y+c.h];if(d||b.moveTo(e[0],e[1]),c.ex){var g=e;if(a.isArray(c.ex))for(var h=0;h<c.ex.length;h++){var i=[c.ex[h].dx+c.x,c.ex[h].dy+c.y];a.dashedLine(b,g,i,d),g=i}else g=[c.ex.dx+c.x,c.ex.dy+c.y],a.dashedLine(b,e,g,d);a.dashedLine(b,g,f,d)}else a.dashedLine(b,e,f,d)},g=function(b,c,d,e,f){var g=d[0]-c[0],h=d[1]-c[1],i=0,j=0,k=-1;0!==g?0!==h?(i=h/g,j=Math.atan(i)):j=(0>g?1:2)*Math.PI:j=Math.PI/2,0>i&&(k=1),d[1]<c[1]&&(k*=-1);var l=d[0],m=d[1];if(b.moveTo(l,m),5===f)b.arc(l,m,e/2,0,2*Math.PI,!1);else{var n=[k*e*Math.cos(j-Math.PI/6)+l,k*e*Math.sin(j-Math.PI/6)+m],o=[k*e*Math.cos(j+Math.PI/6)+l,k*e*Math.sin(j+Math.PI/6)+m],p=[n[0]+(o[0]-n[0])/2,n[1]+(o[1]-n[1])/2];switch(b.lineTo(n[0],n[1]),f){case 2:p=[l+(p[0]-l)/2,m+(p[1]-m)/2],b.lineTo(p[0],p[1]);break;case 3:p=[l+(p[0]-l)/2,m+(p[1]-m)/2],a.dashedBezier(b,n.concat(p).concat(o),null);break;case 4:p=[p[0]+(p[0]-l),p[1]+(p[1]-m)],b.lineTo(p[0],p[1])}b.lineTo(o[0],o[1])}b.closePath()},h=function(b,c){if(c.header){var d=c.hz||8,e=[c.x,c.y],f=[c.x+c.w,c.y+c.h],h=null,i=0,j=0;if(null==c.header||isNaN(c.header)||(i=15&c.header,j=(240&c.header)>>4),c.ex){var k=e;if(a.isArray(c.ex)){if(c.ex.length>0){var l=0;i&&(l=c.ex.length-1,h=c.ex[l],k=[h.dx+c.x,h.dy+c.y],g(b,k,f,d,i)),j&&(l=0,h=c.ex[l],k=[h.dx+c.x,h.dy+c.y],g(b,k,e,d,j))}}else k=[c.ex.dx+c.x,c.ex.dy+c.y],i&&g(b,k,f,d,i),j&&g(b,k,e,d,j)}else i&&g(b,e,f,d,i),j&&g(b,f,e,d,j);b.fillStyle=b.strokeStyle||"#000",b.fill(),b.beginPath()}},i=function(a,b,c){var d=c[1]-b[1],e=c[0]-b[0],f=Math.sqrt(Math.pow(d,2)+Math.pow(e,2));d=a[1]-b[1],e=a[0]-b[0];var g=Math.pow(d,2)+Math.pow(e,2);d=c[1]-a[1],e=c[0]-a[0];var h=Math.pow(d,2)+Math.pow(e,2),i=Math.sqrt(g)+Math.sqrt(h);return f>=i-2},j=function(b,c){var d=[c.x,c.y],e=[c.x+c.w,c.y+c.h],f=!1;if(c.ex){var g=d;if(a.isArray(c.ex))for(var h=0;h<c.ex.length;h++){var j=[c.ex[h].dx+c.x,c.ex[h].dy+c.y];if(f=0===h?i(b,d,j):i(b,g,j),g=j,f)return f}else if(g=[c.ex.dx+c.x,c.ex.dy+c.y],f=i(b,d,g))return f;f=i(b,g,e)}else f=i(b,d,e);return f},k=function(b,c,d){var e=c.ex,f=[c.x+e[0].dx,c.y+e[0].dy],g=[c.x+e[1].dx,c.y+e[1].dy];b.moveTo(f[0],f[1]);var h=e.length;if(h>2)for(var i=0;h>i;i++){var j=[c.x+e[i].dx,c.y+e[i].dy],k=[c.x+e[(i+1)%h].dx,c.y+e[(i+1)%h].dy];if(!c.closePath&&i===h-1)break;a.dashedLine(b,j,k,d)}else a.dashedLine(b,f,g,d)},l=function(b,c,d){var e=c.ex,f=[c.x+e[0].dx,c.y+e[0].dy],g=[c.x+e[1].dx,c.y+e[1].dy];b.moveTo(f[0],f[1]);var h=e.length;if(h>2){for(var i=null,j=null,k=0;h>k;k++){var l=[c.x+e[k].dx,c.y+e[k].dy],n=[c.x+e[(k+1)%h].dx,c.y+e[(k+1)%h].dy],o=[c.x+e[(k+2)%h].dx,c.y+e[(k+2)%h].dy],p=m(l,n,o);if(0===k?(c.closePath?b.moveTo(n[0],n[1]):a.dashedBezier(b,l.concat(p[0]).concat(n),d),i=p):a.dashedBezier(b,l.concat(j[1]).concat(p[0]).concat(n),d),j=p,!c.closePath&&k===h-3){a.dashedBezier(b,n.concat(p[1]).concat(o),d);break}}c.closePath&&a.dashedBezier(b,f.concat(j[1]).concat(i[0]).concat(g),d)}else a.dashedLine(b,f,g,d)},m=function(b,c,d){var e=0,f=0,g=Math.PI/2,h=Math.PI/2;c[0]-b[0]!==0?(e=(c[1]-b[1])/(c[0]-b[0]),g=Math.atan(e),b[0]-c[0]>0?0>e&&(g+=2*Math.PI):g+=Math.PI):b[1]<c[1]&&(g+=Math.PI),c[0]-d[0]!==0?(f=(d[1]-c[1])/(d[0]-c[0]),h=Math.atan(f),d[0]-c[0]>0?0>f&&(h+=2*Math.PI):h+=Math.PI):d[1]<c[1]&&(h+=Math.PI);var i=h+(g-h)/2,j=a.rotate([c[0],c[1]],b,Math.PI/2-i),k=a.rotate([c[0],c[1]],d,Math.PI/2-i),l=[j[0]-(j[0]-c[0])/2,c[1]],m=[k[0]-(k[0]-c[0])/2,c[1]];return[a.rotate([c[0],c[1]],l,Math.PI/2-i,-1),a.rotate([c[0],c[1]],m,Math.PI/2-i,-1)]};a.reg({line:{init:function(a){a.ex=[{dx:a.w/2,dy:a.h/2}],a.adjPoint=648,a.style=2},renderer:function(a,b,c){h(a,b),f(a,b,c)},isOver:function(a,b,c){return j([a,b],c)},drawExPoint:function(a,b,c){a.save();var d=7,e=b.x+c.dx,f=b.y+c.dy;a.fillStyle="#000",a.strokeStyle="#fff",a.beginPath(),a.lineWidth=2,c.main?(a.fillRect(e-d/2,f-d/2,d,d),a.strokeRect(e-d/2,f-d/2,d,d)):(d=3,a.arc(e,f,d,0,2*Math.PI,!1)),a.closePath(),a.fill(),a.stroke(),a.restore()},exFreeze:function(b,c,d,e){return e===a.ACT_RESIZE},onActionStart:function(b,c,d){var e=[];if(b===a.ACT_EX_MOVE&&d.exInd>=0){var f=c.ex[d.exInd],g=d.exInd-1,h=d.exInd+1;null!=f&&f.main&&(g>0&&(e=e.concat(c.ex.slice(0,g))),e.push(f),h+1<c.ex.length&&(e=e.concat(c.ex.slice(h+1,c.ex.length))),f.main=!1,c.ex=e,d.exInd=g)}else{for(var i=0;null!=c.ex&&i<c.ex.length;i++)c.ex[i].main&&(e[e.length]=c.ex[i]);c.ex=e}},onActionDone:function(b,c,d){var e=[];if(b===a.ACT_EX_MOVE&&d.exInd>=0){var f=c.ex[d.exInd];if(null==f)return;var g=d.exInd-1,h=d.exInd+1,i=null,j=null;if(f.main)return g=d.exInd-2,h=d.exInd+2,i=0>g?[0,0]:[c.ex[g].dx,c.ex[g].dy],j=h>=c.ex.length?[c.w,c.h]:[c.ex[h].dx,c.ex[h].dy],c.ex[g+1]={dx:f.dx-(f.dx-i[0])/2,dy:f.dy-(f.dy-i[1])/2},void(c.ex[h-1]={dx:f.dx+(j[0]-f.dx)/2,dy:f.dy+(j[1]-f.dy)/2});f.main=!0,0>g?i=[0,0]:(i=[c.ex[g].dx,c.ex[g].dy],e=e.concat(c.ex.slice(0,d.exInd))),e.push({dx:f.dx-(f.dx-i[0])/2,dy:f.dy-(f.dy-i[1])/2}),e.push(f),h>=c.ex.length?(j=[c.w,c.h],e.push({dx:f.dx+(j[0]-f.dx)/2,dy:f.dy+(j[1]-f.dy)/2})):(j=[c.ex[h].dx,c.ex[h].dy],e.push({dx:f.dx+(j[0]-f.dx)/2,dy:f.dy+(j[1]-f.dy)/2}),e=e.concat(c.ex.slice(h,c.ex.length))),c.ex=e}else{var k={dx:0,dy:0},l=0,m=0;if(a.isArray(c.ex))for(var n=0;n<c.ex.length;n++)c.ex[n].main&&(l=(c.ex[n].dx-k.dx)/2,m=(c.ex[n].dy-k.dy)/2,e[e.length]={dx:c.ex[n].dx-l,dy:c.ex[n].dy-m},e[e.length]=c.ex[n],k=c.ex[n]);l=(c.w-k.dx)/2,m=(c.h-k.dy)/2,e[e.length]={dx:c.w-l,dy:c.h-m},c.ex=e}}},linex:{init:function(a){a.ex={dx:3*a.w/4,dy:a.h/4},a.style=2},renderer:function(b,c,d){h(b,c),c.ex?(b.moveTo(c.x,c.y),a.dashedBezier(b,[c.x,c.y,c.x+c.ex.dx,c.y+c.ex.dy,c.x+c.w,c.y+c.h],d)):a.dashedLine(b,[c.x,c.y],[c.x+c.w,c.y+c.h],d)},isOver:function(a,b,c){return d(c.x,c.y,c.x+c.ex.dx,c.y+c.ex.dy,c.x+c.w,c.y+c.h,a,b)}},linexx:{init:function(a){a.ex=[{dx:a.w,dy:0},{dx:0,dy:a.h}],a.style=2},renderer:function(b,c,d){h(b,c),c.ex?(b.moveTo(c.x,c.y),a.dashedBezier(b,[c.x,c.y,c.x+c.ex[0].dx,c.y+c.ex[0].dy,c.x+c.ex[1].dx,c.y+c.ex[1].dy,c.x+c.w,c.y+c.h],d)):a.dashedLine(b,[c.x,c.y],[c.x+c.w,c.y+c.h],d)},isOver:function(a,b,c){return e(c.x,c.y,c.x+c.ex[0].dx,c.y+c.ex[0].dy,c.x+c.ex[1].dx,c.y+c.ex[1].dy,c.x+c.w,c.y+c.h,a,b)}},freeBezier:{renderer:l},freeLine:{renderer:k}})}(window.jh2d=window.jh2d||{}),function(a,b,c){var d=a.darkColor,e=a.crossPoint,f=function(b,c,d){var e=[[c.x,c.y+c.h/12],[c.x+1*c.w/3,c.y+c.h/4],[c.x+4*c.w/10,c.y+c.h/10],[c.x+c.w/2,c.y+c.h/4],[c.x+2*c.w/3,c.y],[c.x+2*c.w/3,c.y+c.h/4],[c.x+5*c.w/6,c.y+c.h/5],[c.x+3*c.w/4,c.y+c.h/3],[c.x+c.w,c.y+3*c.h/8],[c.x+5*c.w/6,c.y+c.h/2],[c.x+c.w,c.y+5*c.h/8],[c.x+3*c.w/4,c.y+5*c.h/8],[c.x+5*c.w/6,c.y+5*c.h/6],[c.x+5*c.w/8,c.y+3*c.h/4],[c.x+6*c.w/10,c.y+9*c.h/10],[c.x+c.w/2,c.y+3*c.h/4],[c.x+3*c.w/8,c.y+c.h],[c.x+c.w/3,c.y+9*c.h/12],[c.x+c.w/5,c.y+10*c.h/12],[c.x+c.w/4,c.y+8*c.h/12],[c.x,c.y+8*c.h/12],[c.x+c.w/5,c.y+6*c.h/12],[c.x,c.y+5*c.h/12],[c.x+c.w/4,c.y+4*c.h/12]];b.moveTo(e[0][0],e[0][1]);for(var f=0;f<e.length-1;f++)a.dashedLine(b,e[f],e[f+1],d);a.dashedLine(b,e[e.length-1],e[0],d)},g=function(b,c,d,e){for(var f=c.ex.dx,g=c.ex.dy,h=e||8,i=2*Math.PI/h,j=c.x+c.w/2,k=c.y+c.h/2,l=0,m=0,n=0;h>n;n++){var o=n*i,p=0,q=0;p=c.w/2*Math.cos(o)+j,q=c.h/2*Math.sin(o)+k,n>0?a.dashedLine(b,[l,m],[p,q],d):b.moveTo(p,q);var r=o+i/2,s=(c.w-2*f)/2,t=(c.h-2*g)/2;l=s*Math.cos(r)+j,m=t*Math.sin(r)+k,a.dashedLine(b,[p,q],[l,m],d)}b.closePath()},h=function(b,c,d){var e=c.ex.dx,f=c.ex.dy,g=c.x+c.w/2,h=c.y+c.h/2,i=[c.x,h],j=[c.x+e,c.y+f],k=[g,c.y],l=[2*g-j[0],j[1]],m=[c.x+c.w,c.y+c.h/2],n=[l[0],2*h-l[1]],o=[g,c.y+c.h],p=[j[0],n[1]];b.moveTo(i[0],i[1]),a.dashedLine(b,i,j,d),a.dashedLine(b,j,k,d),a.dashedLine(b,k,l,d),a.dashedLine(b,l,m,d),a.dashedLine(b,m,n,d),a.dashedLine(b,n,o,d),a.dashedLine(b,o,p,d),a.dashedLine(b,p,i,d)},i=function(b,c,d){var f=2*Math.PI/5,g=2*f-Math.PI/2,h=c.x+c.w/2,i=c.y+c.h/2,j=c.w/2/Math.tan(g)+h,k=c.y+c.h;b.moveTo(j,k);var l=[j,k],m=[2*h-j,c.y+c.h],n=-1*c.h/2*Math.tan(Math.PI/2*3-f)+i,o=[c.x,n],p=[c.x+c.w/2,c.y],q=[c.x+c.w,n],r=e(l,o,m,q),s=e(l,o,m,p),t=e(m,p,o,q),u=e(l,p,o,q),v=e(l,p,m,q);a.dashedLine(b,l,r,d),a.dashedLine(b,r,m,d),a.dashedLine(b,m,s,d),a.dashedLine(b,s,o,d),a.dashedLine(b,o,t,d),a.dashedLine(b,t,p,d),a.dashedLine(b,p,u,d),a.dashedLine(b,u,q,d),a.dashedLine(b,q,v,d),a.dashedLine(b,v,l,d)},j=function(b,c,d){var e=c.ex[0].dx,f=c.ex[1].dy,g=c.y+c.h/2,h=e-c.w/2,i=2*Math.abs(h),j=c.w-i,k=[0>h?c.x+i:c.x,c.y+f],l=[k[0]+j/2,c.y],m=[l[0],2*k[1]-l[1]],n=[k[0]+j,k[1]],o=[0>h?c.x+c.w-i:c.x+c.w,2*g-k[1]],p=[o[0]-j/2,c.y+c.h],q=[p[0],2*g-m[1]],r=[o[0]-j,2*g-k[1]];b.moveTo(k[0],k[1]),a.dashedBezier(b,k.concat(l).concat(m).concat(n),d),a.dashedLine(b,n,o,d),a.dashedBezier(b,o.concat(p).concat(q).concat(r),d),a.dashedLine(b,r,k,d)},k=function(b,c,d){var e=c.ex[0].dx,f=c.ex[1].dy,g=c.y+c.h/2,h=e-c.w/2,i=2*Math.abs(h),j=c.w-i,k=[0>h?c.x+i:c.x,c.y+f],l=[k[0]+j/4,c.y],m=[l[0],2*k[1]-l[1]],n=[k[0]+j/2,k[1]],o=[k[0]+3*j/4,c.y],p=[o[0],2*k[1]-l[1]],q=[k[0]+j,k[1]],r=[0>h?c.x+c.w-i:c.x+c.w,2*g-k[1]],s=[r[0]-j/4,c.y+c.h],t=[s[0],2*g-p[1]],u=[r[0]-j/2,r[1]],v=[r[0]-3*j/4,c.y+c.h],w=[v[0],2*g-m[1]],x=[r[0]-j,2*g-k[1]];b.moveTo(k[0],k[1]),a.dashedBezier(b,k.concat(l).concat(m).concat(n),d),a.dashedBezier(b,n.concat(o).concat(p).concat(q),d),a.dashedLine(b,q,r,d),a.dashedBezier(b,r.concat(s).concat(t).concat(u),d),a.dashedBezier(b,u.concat(v).concat(w).concat(x),d),a.dashedLine(b,x,k,d)},l=function(b,c,d){var e=c.ex.dy,f=[c.x+2*e,c.y+e/2],g=[c.x+3*e/2,f[1]],h=[g[0]-e/4,g[1]],i=[h[0],g[1]+e/2],j=[g[0],i[1]],k=[f[0],j[1]],l=[f[0],c.y],m=[g[0],c.y],n=[c.x+e,c.y],o=[n[0],c.y+e/2],p=[n[0],c.y+c.h-e/2],q=[p[0],c.y+c.h],r=[c.x,c.y+c.h-e],s=[c.x+e/2,r[1]],t=[c.x+3*e/4,s[1]],u=[t[0],p[1]],v=[s[0],u[1]],w=[c.x+e/2,c.y+c.h],x=[c.x+c.w-3*e/2,c.y+c.h],y=[c.x+c.w-e,c.y+c.h],z=[y[0],c.y+c.h-e/2],A=[z[0],j[1]],B=[A[0]+e/2,A[1]],C=[c.x+c.w,B[1]],D=[c.x+c.w,c.y],E=[c.x+c.w-e/2,c.y];b.moveTo(m[0],m[1]),a.dashedBezier(b,m.concat(n).concat(o),d),a.dashedLine(b,o,p,d),a.dashedBezier(b,p.concat(q).concat(w),d),a.dashedLine(b,w,x,d),a.dashedBezier(b,x.concat(y).concat(z),d),a.dashedLine(b,z,A,d),a.dashedLine(b,A,B,d),a.dashedBezier(b,B.concat(C).concat(D).concat(E),d),a.dashedLine(b,E,m,d),a.dashedBezier(b,m.concat(l).concat(f),d),a.dashedBezier(b,f.concat(k).concat(j),d),a.dashedLine(b,j,A,d),b.moveTo(p[0],p[1]),a.dashedLine(b,p,v,d),a.dashedBezier(b,v.concat(u).concat(t).concat(s),d),a.dashedLine(b,s,[p[0],s[1]],d)},m=function(b,c,e){var f=c.ex.dy,g=[c.x+2*f,c.y+f/2],h=[c.x+3*f/2,g[1]],i=[h[0]-f/4,h[1]],j=[i[0],h[1]+f/2],k=[h[0],j[1]],l=[g[0],k[1]],m=[c.x+f,c.y+c.h-f/2],n=[m[0],c.y+c.h],o=[c.x,c.y+c.h-f],p=[c.x+f/2,o[1]],q=[c.x+3*f/4,p[1]],r=[q[0],m[1]],s=[p[0],r[1]],t=[c.x+f/2,c.y+c.h];b.moveTo(m[0],m[1]),a.dashedBezier(b,m.concat(n).concat(t),e),a.dashedBezier(b,t.concat([o[0],t[1]]).concat(o).concat(p),e),a.dashedBezier(b,p.concat(q).concat(r).concat(s),e),a.dashedLine(b,s,m,e),b.moveTo(g[0],g[1]),a.dashedLine(b,g,h,e),a.dashedBezier(b,h.concat(i).concat(j).concat(k),e),a.dashedBezier(b,k.concat(l).concat(g),e);var u=c.fillStyle||"#fff";b.fillStyle=d(u),b.fill();var v=c.style;null==v&&(v=3),2===(2&v)&&b.stroke()},n=function(b,c,d){p(b,c,d);var e=c.ex[0].dx,f=c.ex[1].dy,g=c.x+c.w/2,h=(c.h-f)/4,i=[c.x+e+c.w/8,c.y+f+3*h],j=[2*g-i[0],i[1]],k=[i[0],c.y+c.h],l=[i[0]-h,k[1]],m=[c.x,k[1]],n=[c.x+c.w/8,c.y+c.h-f/2],o=[c.x,c.y+c.h-f],q=[c.x+e,o[1]],r=[q[0],c.y+h],s=[q[0],c.y],t=[q[0]+h,c.y],u=[2*g-t[0],c.y],v=[2*g-s[0],c.y],w=[2*g-r[0],r[1]],x=[2*g-q[0],q[1]],y=[2*g-o[0],o[1]],z=[2*g-n[0],n[1]],A=[2*g-m[0],m[1]],B=[2*g-l[0],l[1]],C=[2*g-k[0],k[1]],D=[c.x+e,c.y+f+h],E=[2*g-D[0],D[1]],F=[j[0],c.y+f],G=[2*g-j[0],c.y+f];b.moveTo(i[0],i[1]),a.dashedBezier(b,i.concat(k).concat(l),d),a.dashedLine(b,l,m,d),a.dashedLine(b,m,n,d),a.dashedLine(b,n,o,d),a.dashedLine(b,o,q,d),a.dashedLine(b,q,r,d),a.dashedBezier(b,r.concat(s).concat(t),d),a.dashedLine(b,t,u,d),a.dashedBezier(b,u.concat(v).concat(w),d),a.dashedLine(b,w,x,d),a.dashedLine(b,x,y,d),a.dashedLine(b,y,z,d),a.dashedLine(b,z,A,d),a.dashedLine(b,A,B,d),a.dashedBezier(b,B.concat(C).concat(j),d),a.dashedLine(b,j,F,d),a.dashedLine(b,F,G,d),b.moveTo(D[0],D[1]),a.dashedLine(b,D,r,d),b.moveTo(E[0],E[1]),a.dashedLine(b,E,w,d)},o=function(a,b,c){p(a,b,c);var e=b.fillStyle||"#fff";a.fillStyle=d(e),a.fill();var f=b.style;null==f&&(f=3),2===(2&f)&&a.stroke()},p=function(b,c,d){var e=c.ex[0].dx,f=c.ex[1].dy,g=c.x+c.w/2,h=[c.x+e+c.w/8,c.y+f],i=(c.h-f)/4,j=[c.x+e+i,h[1]],k=[c.x+e,h[1]],l=[c.x+e,h[1]+i],m=[c.x+e,h[1]+2*i],n=[c.x+e+i,h[1]+2*i],o=[h[0]-i,n[1]],p=[h[0],n[1]],q=[h[0],n[1]+i],r=[2*g-h[0],h[1]],s=[2*g-j[0],j[1]],t=[2*g-k[0],k[1]],u=[2*g-l[0],l[1]],v=[2*g-m[0],m[1]],w=[2*g-n[0],n[1]],x=[2*g-o[0],o[1]],y=[2*g-p[0],p[1]],z=[2*g-q[0],q[1]];b.moveTo(h[0],h[1]),a.dashedLine(b,h,j,d),a.dashedBezier(b,j.concat(k).concat(l),d),a.dashedBezier(b,l.concat(m).concat(n),d),a.dashedLine(b,n,o,d),a.dashedBezier(b,o.concat(p).concat(q),d),a.dashedLine(b,q,h,d),a.dashedLine(b,h,r,d),a.dashedLine(b,r,s,d),a.dashedBezier(b,s.concat(t).concat(u),d),a.dashedBezier(b,u.concat(v).concat(w),d),a.dashedLine(b,w,x,d),a.dashedBezier(b,x.concat(y).concat(z),d),a.dashedLine(b,z,r,d)};a.reg({bomb:{renderer:f},wave:{init:function(a){a.ex=[{dx:a.w/2,dy:a.h+10},{dx:-10,dy:a.h/4}]},renderer:j},wave2:{init:function(a){a.ex=[{dx:a.w/2,dy:a.h+10},{dx:-10,dy:a.h/4}]},renderer:k},star5:{renderer:i},star4:{init:function(a){a.ex={dx:a.w/3,dy:a.h/3}},renderer:h},star8:{init:function(a){a.ex={dx:a.w/6,dy:a.h/6}},renderer:g},star16:{init:function(a){a.ex={dx:a.w/6,dy:a.h/6}},renderer:function(a,b,c){g(a,b,c,16)}},star24:{init:function(a){a.ex={dx:a.w/6,dy:a.h/6}},renderer:function(a,b,c){g(a,b,c,24)}},star32:{init:function(a){a.ex={dx:a.w/6,dy:a.h/6}},renderer:function(a,b,c){g(a,b,c,32)}},vscroll:{init:function(a){a.ex={dx:-10,dy:a.h/4}},renderer:l,drawAfter:m},raisedBelt:{init:function(a){a.ex=[{dx:a.w/4,dy:-10},{dx:a.w/2,dy:3*a.h/4}]},renderer:n,drawAfter:o},depressedBelt:{init:function(a){a.ex=[{dx:a.w/4,dy:-10},{dx:a.w/2,dy:3*a.h/4}],a.initRotate=Math.PI,a.rotate=a.initRotate},renderer:n,drawAfter:o}})}(window.jh2d=window.jh2d||{}),function(a,b,c){var d=255;a.reg({wf_proc:{init:function(a){a.adjPoint=d},renderer:a.plugins.rect.renderer},wf_optproc:{init:function(a){a.corner=10,a.adjPoint=d},renderer:a.plugins.rect.renderer},wf_end:{init:function(a){a.adjPoint=d},renderer:function(b,c,d){c.corner=c.h/2,a.plugins.rect.renderer(b,c,d)}},wf_if:{init:function(a){a.adjPoint=d},renderer:a.plugins.diamond.renderer},wf_data:{init:function(b){a.plugins.parallelogram.init(b),b.adjPoint=d},renderer:a.plugins.parallelogram.renderer}})}(window.jh2d=window.jh2d||{});