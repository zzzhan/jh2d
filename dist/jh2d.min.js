/*! jh2d 2015-05-15 */
"use strict";!function(a,b,c){a.plugins={},a.dashes=[[4,4],[8,4,4,4],[8,4,4,4,4,4,8,4]];var d={style:"normal",weight:"normal",size:12,family:"sans-serif",align:0,color:"rgba(0,0,0,0.87)",pos:0};a.DEF_TEXT_OPT=d;var e=1,f=2,g=4,h=8;a.EAST=e,a.NORTH=f,a.WEST=g,a.SOUTH=h;var i=1,j=2,k=4,l=8,m=16,n=32,o=n|i,p=10;a.ACT_MOVE=i,a.ACT_RESIZE=j,a.ACT_ROTATE=k,a.ACT_EX_MOVE=l,a.ACT_SELECT=m,a.ACT_NEW_DROP=o;var q=function(a,b,c,d){return"object"==typeof a?q(a.x,a.y,a.w,a.h):[a+c/2,b+d/2]},r=function(a,b){return[b[0]-a[0],b[1]-a[1]]},s=function(a,b){var c=r(a,b);return Math.sqrt(c[0]*c[0]+c[1]*c[1])};a.center=q,a.delta=r,a.direction=function(a,b,c,d,e){var f=d/c,g=this.center(a,b,c,d),h=e[0]-g[0],i=e[1]-g[1],j=0;return i>=Math.abs(h*f)&&(j=this.SOUTH),i<=-1*Math.abs(h*f)&&(j=this.NORTH),h>=Math.abs(i/f)&&(j=this.EAST),h<=-1*Math.abs(i/f)&&(j=this.WEST),j};var t=function(a){if(null!=a&&"object"==typeof a){if(da(a)){for(var b=[],c=0;c<a.length;c++)b[b.length]=t(a[c]);return b}var d={};for(var e in a)d[e]=t(a[e]);return d}return a},u=function(a,b){for(var c=!1,d=0;d<a.length&&!(c=b===a[d]);d++);return c},v=function(b,c,d,e){if("object"==typeof c)for(var f in c){var g=da(e)&&u(e,f);"function"==typeof e&&(g=e.call(a,f)),g||((null==b[f]||d)&&("object"==typeof c[f]&&null!=c[f]?b[f]=t(c[f]):b[f]=t(c[f])),null==b[f]&&delete b[f])}return b};a.clone=t,a.extend=v,a.inArray=u;var w=3,x=function(a,b,c,d){a.strokeStyle="#000",a.beginPath(),a.arc(b,c,w,0,2*Math.PI,!1),a.closePath(),a.fillStyle=d||"#fff",a.fill(),a.stroke()},y=function(a,b,c,d,e){for(var f=[0,1,2,-1],g=c/2,h=d/2,i=-1,j=0;8>j;j++){var k=j%f.length,l=0,m=0;switch(f[k]){case 0:i*=-1,l=a+g+g*i,m=b+h;break;case 1:l=a+g+g*i,m=b+h-h*i;break;case 2:l=a+g,m=b+h-h*i;break;case-1:l=a+g-g*i,m=b+h-h*i}if(e(l,m,j))return j}return-1},z=function(a,b,c,d){return Math.pow(d-b,2)+Math.pow(c-a,2)<=Math.pow(w+2,2)},A=function(a,b,c){return y(a.x,a.y,a.w,a.h,function(d,e,f){var g=!0;if(null!=a.adjPoint){var h=Math.pow(2,f);g=(h&a.adjPoint)===h}return g&&z(d,e,b,c)})},B=function(a,b){var c=C(b),d=0;a.beginPath(),a.moveTo(c[d++],c[d++]),a.lineTo(c[d++],c[d++]+b.h/2*-1),a.stroke(),d=0,x(a,c[d++],c[d++],"#0f0")},C=function(a){var b=[a.w/2,a.h/Math.abs(a.h)*15*-1,a.w/2,a.h/2],c=a.x,d=a.y,e=0;return[c+b[e++],d+b[e++],c+b[e++],d+b[e++]]},D=function(a){return a.rc||C(a).slice(2)},E=function(b,c,d){b.save();var e=c.rc||D(c),f=c.x+(c.dx||0),g=c.y+(c.dy||0),h=e[0],i=e[1],j=c.rotate||0;0!==j&&(b.translate(h,i),b.rotate(j),f-=h,g-=i);var k=c.style;null==k&&(k=3);var l=1===(1&k),m=2===(2&k),n=c.dashedStyle,o=parseInt(c.shadowOffset),p=c.shadowAngle,q=c.gradient||0,r=c.alpha||1;-1!==r&&(b.globalAlpha=r);var s=a.plugins[c.type];if(s){c.strokeSize&&(b.lineWidth=c.strokeSize),b.strokeStyle=c.strokeStyle||"rgba(0,0,0,0.54)";var t=a.extend({x:f,y:g},c);b.beginPath();var u=null;isNaN(parseInt(n))||(u=a.dashes[n]);var v=c.strokeBefore||!1;if(s.renderer.call(s,b,t,u),null!=p&&!isNaN(o)){b.shadowColor=c.shadowColor||"RGBA(127,127,127,1)";var w=D(c),x=a.rotate(w,[w[0]+o,w[1]],p);b.shadowOffsetX=x[0]-w[0],b.shadowOffsetY=x[1]-w[1],b.shadowBlur=null==c.shadowBlur?5:c.shadowBlur,v=!0}v&&m&&b.stroke(),l&&(b.fillStyle=c.fillStyle||"#fff",0!==q&&F(b,c,f,g),b.fill()),!v&&m&&b.stroke(),c.img&&H(b,t),null!=d&&1===(1&d)&&S(b,t),c.text&&(b.save(),L(b,c,f,g),b.restore())}b.restore()},F=function(b,c,d,i){var j=c.gradient||0,k=c.gradientType||0,l=0>j;j=Math.abs(j);var m,n,o,p,q=d,r=d,s=i,t=i,u=0,v=0,w=null;if(0===k){j===(e|f)&&(m=c.h/c.w,n=-1/m,o=n*c.w/(n-m),p=m*o,u=o-c.w/2,v=p-c.h/2),j===(g|f)&&(m=-1*c.h/c.w,n=-1/m,o=m*c.w/(m-n),p=n*o,u=o-c.w/2,v=p-c.h/2),(j&e)===e&&(q=d+c.w-u,r=d+u),(j&f)===f&&(s=i-v,t=i+c.h+v),(j&g)===g&&(q=d-u,r=d+c.w+u),(j&h)===h&&(s=i-v,t=i+c.h+v);var x=c.rotate||0;if(0!==x&&c.gradientFixed){var y=a.rotate([0,0],[q,s],x,-1),z=a.rotate([0,0],[r,t],x,-1);q=y[0],s=y[1],r=z[0],t=z[1]}w=b.createLinearGradient(q,s,r,t)}else{var A=0,B=0;0===j||j===(e|f|g|h)?(q=d+c.w/2,s=i+c.h/2,r=q,t=s,B=Math.sqrt(c.w*c.w+c.h*c.h)/2):(q=d+c.w/2,s=i+c.h/2,(j&e)===e&&(q=d+c.w-u),(j&f)===f&&(s=i-v),(j&g)===g&&(q=d-u),(j&h)===h&&(s=i+c.h+v),r=q,t=s,B=Math.max(Math.abs(c.w),Math.abs(c.h))),w=b.createRadialGradient(q,s,A,r,t,B)}for(var C=c.gradientCnt||2,D=c.gradientColors||[c.fillStyle,"#ffffff"],E=1/(C-1),F=0;C>F;F++){var G=F===C-1?1:F*E,H=F%D.length;l&&(H=D.length-H-1);var I=D[H];w.addColorStop(G,I)}b.fillStyle=w};a.resource_cache={};var G=a.resource_cache,H=function(a,b){var c="string"==typeof b.img?b.img:b.img.url;null!=c&&G[c]&&K(a,b,G[c])},I=function(a){for(var b=!0,c=0;c<a.length;c++){var d=a[c];if(d.img){var e="string"==typeof d.img?d.img:d.img.url;if(b=!!G[e],!b)break}}return b},J=function(a,b,c){var d=new Image;d.onload=function(e){G[e.target.src]=d,I(a)&&b.call(c||a)};for(var e=0;e<a.length;e++){var f=a[e];if(f.img){var g="string"==typeof f.img?f.img:f.img.url;null==G[g]&&(d.src=g)}}},K=function(a,b,c){a.clip();var d=0,e=0,f=0,g=0,h=b.x,i=b.y,j=b.w,k=b.h,l=1;"object"==typeof b.img&&(d=b.img.x||d,e=b.img.y||e,f=b.img.w||c.width,g=b.img.h||c.height,0>d&&(l=b.w/f,h-=d*l,f+=d,j=f*l),0>e&&(l=b.h/g,i-=e*l,g+=e,k=g*l),d=Math.max(d,0),e=Math.max(e,0),f=Math.min(f,c.width),g=Math.min(g,c.height)),a.drawImage(c,d,e,f,g,h,i,j,k)},L=function(a,b,c,i){c=c||b.x,i=i||b.y;var j=0,k=c,l=i,m=v(b.textOpt||{},d,!1),n=" ",o=m.size;"number"==typeof parseInt(o)&&(o+="px");var p=m.style+n+m.weight+n+o+n+m.family;a.font=p,a.fillStyle=m.color;var q=b.text.split(/\n|<br[\/]{0,1}\>/);j=a.measureText(q[0]);for(var r=1;r<q.length;r++){var s=a.measureText(q[r]);s.width>j.width&&(j=s)}var t=M(m.family,o);k=c+b.w/2,l=i+b.h/2,a.textAlign="center",a.textBaseline="middle";var u=m.align;(u&e)===e&&(k=c+b.w,a.textAlign="right"),(u&g)===g&&(k=c,a.textAlign="left"),(u&h)===h&&(l=i+b.h,a.textBaseline="bottom"),(u&f)===f&&(l=i,a.textBaseline="top");var w=m.pos;for((w&e)===e&&(k+=b.w),(w&g)===g&&(k-=b.w),(w&h)===h&&(l+=b.h),(w&f)===f&&(l-=b.h),b.textOpt=m,b.textOpt.x=k,b.textOpt.y=l,b.textOpt.w=j,b.textOpt.h=t,r=0;r<q.length;r++){var x=l+r*t.height;a.fillText(q[r],k,x),m.decoration&&N(a,m.decoration,b)}},M=function(a,b){var c=document.createElement("span");c.innerHTML="Hg",c.style.fontFamily=a,c.style.fontSize=b,c.style.padding="0px",c.style.margin="0px";var d=document.createElement("div");d.style.display="inline-block",d.style.width="1px",d.style.height="0px";var e=document.createElement("div");e.style.padding="0px",e.style.margin="0px",e.style.border="1px solid",e.appendChild(c),e.appendChild(d),document.body.appendChild(e);var f={};try{d.style.verticalAlign="baseline",f.ascent=O(d).top-O(c).top,d.style.verticalAlign="bottom",f.height=O(d).top-O(c).top,f.descent=f.height-f.ascent}finally{e.remove()}return f},N=function(a,b,c){var d=c.textOpt,i=d.h,j=d.w,k=i.height-i.descent/3,l=j.width,m=d.align,n=c.x+c.w/2,o=c.y+c.h/2,p=[n-l/2,o],q=[n+l/2,o],r=0;switch(b.toLowerCase()){case"line-through":r=0;break;case"underline":r=1;break;case"overline":r=-1}a.beginPath(),a.lineWidth=parseInt(d.size/12),a.strokeStyle=d.color||"#000",(m&e)===e&&(p[0]=c.x+c.w-l,q[0]=c.x+c.w),(m&g)===g&&(p[0]=c.x,q[0]=c.x+l),(m&h)===h&&(o+=(c.h-k)/2),(m&f)===f&&(o-=(c.h-k)/2),p[1]=o+r*k/2,q[1]=o+r*k/2;var s=d.pos;(s&e)===e&&(p[0]+=c.w,q[0]+=c.w),(s&g)===g&&(p[0]-=c.w,q[0]-=c.w),(s&h)===h&&(p[1]+=c.h,q[1]+=c.h),(s&f)===f&&(p[1]-=c.h,q[1]-=c.h),a.moveTo(p[0],p[1]),a.lineTo(q[0],q[1]),a.stroke()},O=function(a){for(var b=0,c=0;a&&!isNaN(a.offsetLeft)&&!isNaN(a.offsetTop);)b+=a.offsetLeft-a.scrollLeft,c+=a.offsetTop-a.scrollTop,a=a.offsetParent;return{top:c,left:b}};a.draw=function(a,b,c,d,e){a.save(),a.scale(c,c);var f=0;if(b.length)if(e)for(f=0;f<e.length;f++){var g=e[f];E(a,b[g],d!==g||b[g].conn?0:1)}else for(f=0;f<b.length;f++)E(a,b[f],d!==f||b[f].conn?0:1);else E(a,b);a.restore()};var P=function(a,b,c,d){a.save(),a.beginPath();for(var e=p*(d||1),f=b/e,g=0;f>g;g++)a.moveTo(g*e,0),a.lineTo(g*e,c);for(f=c/e,g=0;f>g;g++)a.moveTo(0,g*e),a.lineTo(b,g*e);a.strokeStyle="rgba(187,187,187,0.26)",a.stroke(),a.restore()},Q=function(b,c,d,e){b.save(),b.scale(d,d);var f=D(c),g=c.x,h=c.y,i=f[0],j=f[1],k=c.rotate||0;0!==k&&(b.translate(i,j),b.rotate(k),g-=i,h-=j);var l=a.extend({x:g,y:h},c),m=c.conn?"#0f0":null;y(g,h,c.w,c.h,function(a,d,f){var g=!0;if(null!=c.adjPoint){var h=Math.pow(2,f);g=(h&c.adjPoint)===h}if(g){var i=m;if(da(e))for(var j=0;j<e.length;j++){var k=e[j];if(k[1]===f){i="#f00";break}}x(b,a,d,i)}}),(null==c.adjPoint||256===(256&c.adjPoint))&&B(b,l),$(b,l),b.restore()},R=function(a,b,c,d,e){a.beginPath(),a.moveTo(b,c),a.lineTo(b+d,c+e),a.moveTo(b+d,c),a.lineTo(b,c+e),a.stroke()},S=function(a,b){a.save(),a.strokeStyle="#00f";for(var c=T(b),d=5,e=0;e<c.length;e++)R(a,c[e][0]-d/2,c[e][1]-d/2,d,d);a.restore()},T=function(b){var c=a.plugins[b.type];return c&&c.getConnectPts?c.getConnectPts.call(c,b):U(b)},U=function(a){var b=a.x+a.w/2,c=a.y+a.h/2;return[[b,a.y],[a.x+a.w,c],[b,a.y+a.h],[a.x,c]]},V=function(a,b){var c=T(a);return Y(a,c[X(c,Y(a,b,-1))])},W=function(a,b){var c=T(a);return X(c,Y(a,b,-1))},X=function(a,b){for(var c=0,d=0,e=0;e<a.length;e++){var f=s(b,a[e]);0===e?c=f:c>f&&(c=f,d=e)}return d},Y=function(b,c,d){var e=b.rotate||0;if(0!==e){var f=a.rotate(D(b),c,e,d||1);c[0]=f[0],c[1]=f[1]}return c},Z=function(a,b){var c=T(a)[b[3]];return Y(a,c)};a.defConnectPts=U;var $=function(b,c){if(c.ex){var d=function(d){var e=a.plugins[c.type];if(e&&e.drawExPoint)e.drawExPoint.call(e,b,c,d);else{var f=d.dx,g=d.dy;x(b,c.x+f,c.y+g,"#ffff00")}},e=c.ex;if(da(e))for(var f=0;f<e.length;f++){var g=e[f];d(g)}else d(e)}};a.reg=function(b){a.extend(a.plugins,b)};var _=function(a,b,c,d){return d=d||1,[(b[0]-a[0])*Math.cos(c)-d*(b[1]-a[1])*Math.sin(c)+a[0],d*(b[0]-a[0])*Math.sin(c)+(b[1]-a[1])*Math.cos(c)+a[1]]},aa=function(a,b,c,d){var e=(b[1]-a[1])/(b[0]-a[0]),f=(b[1]-c[1])/(b[0]-c[0]),g=(a[1]-c[1])/(a[0]-c[0]),h=(e*(d[0]-b[0])-(d[1]-b[1]))*(e*(c[0]-b[0])-(c[1]-b[1])),i=(f*(d[0]-b[0])-(d[1]-b[1]))*(f*(a[0]-b[0])-(a[1]-b[1])),j=(g*(d[0]-a[0])-(d[1]-a[1]))*(g*(b[0]-a[0])-(b[1]-a[1]));return h>0&&i>0&&j>0},ba=function(a,b,c,d,e){var f=[a,b],g=[a+c,b],h=[a,b+d],i=[a+c,b+d];return aa(f,g,h,e)||aa(g,h,i,e)},ca=function(a){for(var b=a.offsetLeft,c=a.offsetTop,d=a.offsetParent;null!==d;)b=parseInt(b)+parseInt(d.offsetLeft),c=parseInt(c)+parseInt(d.offsetTop),d=d.offsetParent;return new Array(b,c)};a.inTriangle=aa,a.inRect=ba;var da=function(a){return"[object Array]"===Object.prototype.toString.call(a)};a.rotate=_,a.isArray=da;var ea=["e-resize","ne-resize","n-resize","nw-resize","w-resize","sw-resize","s-resize","se-resize"],fa=[1,3,2,6,4,12,8,9],ga=function(a,b,c,d,e,f,g){if(e=null==e?-1:e,a.ex){var h=function(b,c,e){switch(d){case 1:b.dx+=c,b.dy+=e;break;case 0:b.dx=c,b.dy=e;break;case 2:if(0===a.w||0===a.h)return;b.dx=a.w/Math.abs(a.w)*Math.abs(b.dx*(1-f)),b.dy=a.h/Math.abs(a.h)*Math.abs(b.dy*(1-g))}},i=a.ex;if(da(a.ex)){for(var j=0;j<i.length;j++)if(-1===e||e===j){var k=i[j];if(h(k,b,c),e===j)break}}else h(i,b,c)}},ha=function(a,b,c){if(a.ex){var d=function(d){var e,f;return e=a.x+d.dx,f=a.y+d.dy,z(e,f,b,c)};if(da(a.ex))for(var e=0;e<a.ex.length;e++){var f=a.ex[e];if(d(f))return e}else if(d(a.ex))return 0}return-1},ia=function(a,b,c,d,e,f){1===(1&fa[c])&&(a.w=b.w+b.w*e,d||ga(a,b.w*e,0,1,-1,e,f)),2===(2&fa[c])&&(a.y=b.y+b.h*f,a.h=b.h-b.h*f,d&&ga(a,0,-1*b.h*f,1,-1,e,f)),4===(4&fa[c])&&(a.x=b.x+b.w*e,a.w=b.w-b.w*e,d?ga(a,-1*b.w*e,0,1,-1,e,f):ga(a,-1*b.w*e,0,2,-1,e,f)),8===(8&fa[c])&&(a.h=b.h+b.h*f)},ja=function(a,b){for(var c=[],d=0;d<b.length;d++){var e=b[d];if(-1===ma(c,e)){var f=la(a,e);-1!==f?c[c.length]=a.splice(f,1)[0]:c[c.length]=e}}return c.length>0&&(a[a.length]=c),a},ka=function(a,b){for(var c=a[b],d=[b,1],e=0,f=0;f<c.length;f++){var g=c[f];da(g)&&(d[d.length]=g,e++)}return Array.prototype.splice.apply(a,d),e},la=function(a,b){for(var c=0;c<a.length;c++){var d=a[c];if(-1!==ma(d,b))return c}return-1},ma=function(a,b){for(var c=0;c<a.length;c++){var d=a[c];if(da(d)){if(-1!==ma(d,b))return c}else if(d===b)return c}return-1},na=function(a,b){var c=null,d=0;c=da(b[d])?na(a,b[d]):a[b[d]],d=1;for(var e=oa(c),f=0;d<b.length;d++){c=da(b[d])?na(a,b[d]):a[b[d]];var g=oa(c);e[f]=Math.min(e[f],g[f++]),e[f]=Math.min(e[f],g[f++]),e[f]=Math.max(e[f],g[f++]),e[f]=Math.max(e[f],g[f++])}f=0;var h=e[f++],i=e[f++],j=e[f++],k=e[f++];return{x:h,y:i,w:j-h,h:k-i}},oa=function(a){var b=a.x,c=a.x+a.w,d=a.y,e=a.y+a.h,f=Math.min(b,c),g=Math.min(d,e),h=f+Math.abs(a.w),i=g+Math.abs(a.h);return[f,g,h,i]},pa=function(a){for(var b=[],c=0;c<a.length;c++){var d=a[c];da(d)?b=b.concat(pa(d)):b[b.length]=d}return b},qa=function(a,b){for(var c=[],d=a.concat(b),e=0;e<d.length;e++){var f=d[e];-1===sa(c,f)&&(c[c.length]=f)}return c},ra=function(a){var b=pa(a);return b.join("_")},sa=function(a,b){for(var c=0;c<a.length;c++){var d=a[c];if(d===b)return c}return-1},ta={allScale:1,selectedIndexs:[],groups:[],groupSprites:{},curIndex:-1,connectingSprites:[]},ua=function(a,b){var c=this;this.data=[],this.ctx=a.getContext("2d"),this.w=a.getAttribute("width"),this.h=a.getAttribute("height");var d=ca(a);return this.offsetLeft=d[0],this.offsetTop=d[1],this.options=v(b||{},ta),this.connModeFlag=!1,this.action=0,this.newSprite=null,this.downX=0,this.downY=0,this.moveX=0,this.moveY=0,this.upX=0,this.upY=0,this.mDownFlag=!1,this.downRotate=0,this.moveRotate=0,this.overInd=-1,this.scalex=0,this.scaley=0,this.exIndex=-1,this.exFreezed=!1,this.resizeInd=-1,this.assistSprites=[],this.cursor="default",this.multiSelect=!1,a.addEventListener("mousedown",function(a){c._onMousedown(a)}),a.addEventListener("mousemove",function(a){c._onMousemove(a)}),a.addEventListener("mouseup",function(a){c._onMouseup(a)}),c};ua.prototype={startRefresh:function(){var a=this;null!=this.interval&&clearInterval(this.interval),this.interval=setInterval(function(){a.update()},1e3/60)},stopRefresh:function(){clearInterval(this.interval),this.interval=null},newMode:function(a,b){this.newSprite=a,this._init(this.newSprite),this.action=b||n,this.startRefresh()},connectMode:function(){this.connModeFlag=!0,this.startRefresh()},_init:function(b){var c=a.plugins[b.type];null!=c&&c.init&&c.init.call(c,b)},add:function(a){if(da(a)){for(var b=0;b<a.length;b++)this._init(a[b]);a.length>0&&(this.data=this.data.concat(a))}else this._init(a),this.data[this.data.length]=a;return this},setData:function(a,b){this.reset(),this.options=v(b||{},ta),this.data=[],this.add(a)},remove:function(a){return this.splice(a,1),this},splice:function(){return this.data.splice(arguments)},reset:function(){this.action=0,this.resizeInd=-1,this.mDownFlag=!1,this.moveRotate=0,this.downRotate=0,this.exIndex=-1,this.scalex=0,this.scaley=0,this.exFreezed=!1,this.connModeFlag=!1,this.stopRefresh()},show:function(){var b=this.ctx;return this.options.background&&P(b,this.w,this.h),a.draw(b,this.data,1,-1,this.getOrderIndexs()),J(this.data,function(){a.draw(b,this.data,1,-1,this.getOrderIndexs())},this),this},getSprite:function(a){return this.data[a]},getCurIndex:function(){return this.options.curIndex},indexOf:function(b,c){for(var d=this.getOrderIndexs(),e=d.length-1;e>=0;e--){var f=d[e],g=this.data[f],h=b,i=c,j=g.rotate||0;if(0!==j){var k=a.rotate(a.center(g.x,g.y,g.w,g.h),[h,i],j,-1);h=k[0],i=k[1]}var l=a.plugins[g.type];if(l&&l.isOver){if(l.isOver.call(l,h,i,g))return f}else if(ba(g.x,g.y,g.w,g.h,[h,i]))return f}return-1},indexsOf:function(a,b,c,d){for(var e=[],f=Math.min(a,c),g=Math.max(a,c),h=Math.min(b,d),i=Math.max(b,d),j=0;j<this.data.length;j++){var k=this.data[j];k.x>=f&&k.x<=g&&k.y>=h&&k.y<=i&&k.x+k.w>=f&&k.x+k.w<=g&&k.y+k.h>=h&&k.y+k.h<=i&&(e[e.length]=j)}return e},getOrderIndexs:function(){var a=[],b=0;if(this.orderIndexs){if(this.orderIndexs.length!==this.data.length){for(b=0;b<this.data.length;b++){for(var c=b,d=0;d<this.orderIndexs.length;d++)b===this.orderIndexs[d]&&(c=this.orderIndexs[d]);a[b]=c}this.orderIndexs=a}}else{for(a=[],b=0;b<this.data.length;b++)a[b]=b;this.orderIndexs=a}return this.orderIndexs},getSelectedCount:function(){for(var a=this.options.selectedIndexs,b=this.options.groups,c=[],d=0,e=0;e<a.length;e++){var f=ma(b,a[e]);-1!==f?-1===c.join().indexOf(f+"")&&(c[c.length]=f,d++):d++}return d},getSelecteds:function(){for(var a=this.options.selectedIndexs,b=[],c=0;c<a.length;c++)b[b.length]=this.data[a[c]];return b},isSelected:function(a){for(var b=this.options.selectedIndexs,c=!1,d=0;d<b.length;d++)if(a===b[d]){c=!0;break}return c},removeSelected:function(){for(var a=this.options.selectedIndexs,b=[],c=[],d=0;d<this.data.length;d++)u(a,d)?b[b.length]=this.data[d]:c[c.length]=this.data[d];return b.length>0?this.reset():b=null,this.data=c,this.options.selectedIndexs=[],b},select:function(a){var b=this.options.selectedIndexs,c=function(a){u(b,a)||(b[b.length]=a)};if(da(a))for(var d=0;d<a.length;d++)c(a[d]);else c(a);return this},selectAll:function(){for(var a=0;a<this.data.length;a++)this.options.selectedIndexs[a]=a;return this},setMultiSelect:function(a){return this.multiSelect=a,this},_doMouseOver:function(b){var c=this,d=c.action,e=b.rotate||0,f=c.moveX,g=c.moveY,h=f,i=g,m=0;if(0!==e){var n=a.rotate(D(b),[h,i],e,-1);h=n[0],i=n[1],m=-1*Math.round(4*e/Math.PI)}if(c.exIndex=ha(b,h,i),-1!==c.exIndex)c.cursor="crosshair",d=l;else{var o=A(b,h,i);if(-1!==o){c.resizeInd=o,o+=m;var p=o%ea.length;0>p&&(p+=ea.length),c.cursor=ea[p],d=j}else{var q=null;(null==b.adjPoint||256===(256&b.adjPoint))&&(q=C(b)),null!=q&&z(q[0],q[1],h,i)&&(d=k,c.cursor="crosshair")}}c.action=d},_connSelectedCount:function(a){for(var b=0,c=0;c<a.length;c++)this.isSelected(a[c][2])&&b++;return b},_findConns:function(a){for(var b=this.options.connectingSprites,c=[],d=0;d<b.length;d++){var e=b[d];e[2]===a&&(c[c.length]=e)}return c},_doConns:function(a,b){for(var c=this._findConns(a),d=0;d<c.length;d++){var e=c[d];b.call(this,e,a)}},_findConnGrp:function(a){for(var b=this.options.connectingSprites,c=[],d=0;d<b.length;d++){var e=da(a)?a[0]:a;b[d][0]===e&&(c[c.length]=b[d])}return c},_clearConns:function(a,b){var c=this.options.connectingSprites;b=null==b?-1:b;for(var d=[],e=0;e<c.length;e++){var f=c[e],g=!1;g=-1!==b?f[0]===a&&f[1]===b:f[0]===a,g||(d[d.length]=f)}this.options.connectingSprites=d},_updateConn:function(a,b,c,d){var e,f,g=Z(a,c),h=this._findConnGrp(c),i=d||this.data[c[0]];3===c[1]?(e=g[0]-i.x,f=g[1]-i.y,b.x=i.x+e,b.y=i.y+f,h.length>1&&(b.w=i.w-e,b.h=i.h-f)):7===c[1]&&(e=g[0]-(i.x+i.w),f=g[1]-(i.y+i.h),1===h.length?(b.x=i.x+e,b.y=i.y+f):(b.w=i.w+e,b.h=i.h+f))},_dragEx:function(b,c,d){if(d.ex&&-1!==this.exIndex){var e,f,g=d.ex;da(g)&&(g=d.ex[this.exIndex]);var h=b,i=c,j=d.rotate||0;if(0!==j){var k=a.rotate(D(d),[h,i],j,-1);h=k[0],i=k[1]}e=h-d.x,f=i-d.y,ga(d,e,f,0,this.exIndex,this.scalex,this.scaley)}},moveBottom:function(a){var b=this.getOrderIndexs(),c=b[0];b[0]=a;for(var d=1;c!==a&&d<b.length;d++){var e=b[d];b[d]=c,c=e}return this},moveTop:function(a){var b=this.getOrderIndexs(),c=b.length,d=b[c-1];b[c-1]=a;for(var e=c-2;d!==a&&e>=0;e--){var f=b[e];b[e]=d,d=f}return this},moveDown:function(a){for(var b=this.getOrderIndexs(),c=b[0],d=1;c!==a&&d<b.length;d++){var e=b[d];e===a&&(b[d]=c,b[d-1]=a),c=e}return this},moveUp:function(a){var b=this.getOrderIndexs(),c=b.length,d=b[c-1];b[c-1]=a;for(var e=c-2;d!==a&&e>=0;e--){var f=b[e];f===a&&(b[e]=d,b[e+1]=a),d=f}return this},group:function(){var a=this.options.selectedIndexs,b=this.options.groups,c=this.options.groupSprites;if(a.length>1){console.log(a),ja(b,a);for(var d=0;d<b.length;d++){var e=b[d],f=ra(e),g=c[f];null==g&&(c[f]=na(this.data,e))}}return console.log(b),this},ungroup:function(){for(var a=this.options.selectedIndexs,b=this.options.groups,c=this.options.groupSprites,d=[],e=-1,f=0;f<a.length;f++)e=ma(b,a[f]),-1!==e&&-1===d.join().indexOf(e+"")&&(d[d.length]=e);d=d.sort();var g=0;for(f=0;f<d.length;f++){e=d[f]+g;var h=b[e],i=ra(h);delete c[i];var j=ka(b,e);0===j?g+=-1:j>1&&(g+=j-1)}return console.log(b),this},_doAlign:function(a,b,c){switch(b){case e:c.x=a.x+a.w-c.w;break;case f:c.y=a.y;break;case g:c.x=a.x;break;case h:c.y=a.y+a.h-c.h;break;case e|g:c.x=a.x+a.w/2-c.w/2;break;case f|h:c.y=a.y+a.h/2-c.h/2}return this},_doGrpAlign:function(a,b,c){var d=this.options.groups,e=this.options.groupSprites,f=d[c],g=ra(f),h=e[g],i=t(h);this._doAlign(a,b,h);for(var j=pa(f),k=0;k<j.length;k++){var l=j[k],m=this.data[l];m.x+=h.x-i.x,m.y+=h.y-i.y}},align:function(a){var b=this.options.selectedIndexs,c=this.options.groups,d=this.options.groupSprites,e=this.options.curIndex,f=null,g=ma(c,e);if(-1===g)f=this.data[e];else{var h=c[g],i=ra(h);f=d[i]}for(var j=[],k=0;k<b.length;k++){var l=b[k],m=ma(c,l);if(-1!==g&&g!==m)if(-1===m){var n=this.data[l];this._doAlign(f,a,n)}else-1===j.join().indexOf(m+"")&&(this._doGrpAlign(f,a,m),j[j.length]=m)}},zoom:function(a){return this.options.allScale=a,this.update(),this},getScale:function(){return this.options.allScale||1},_updateSprite:function(b,c,d,m){var n=this,o=n.options.allScale,p=n.options.selectedIndexs,q=n.options.groups,r=n.options.groupSprites,s=n.options.curIndex,t=n.downX,u=n.downY,v=n.moveX,w=n.moveY,x=n.scalex,y=n.scaley,z=n.assistSprites;if(b.conn&&p.length>1){var A=n._findConnGrp(c);if(1===n._connSelectedCount(A)&&c!==s)return}var B=null;0!==d&&(B=a.extend({style:2,dashedStyle:0,strokeSize:1},b),z[z.length]=B),(d&i)===i&&(B.x=b.x+v-t,B.y=b.y+w-u,n.exFreezed&&s===c&&ga(B,t-v,u-w,1,-1,x,y),a.draw(n.ctx,B,o));var C=-1,E=-1,F=null,G=null;if((d&k)===k&&(B.rotate=((b.rotate||0)+n.moveRotate)%(2*Math.PI),C=la(q,c),-1!==C?(G=q[C],E=ra(G),F=r[E],B.rc=D(F)):B.rc=D(b),a.draw(n.ctx,B,o)),(d&j)===j){if(n.data[s].conn&&s!==c)return;if(C=la(q,c),-1!==C){G=q[C],E=ra(G),F=r[E];var H=a.extend({},F);ia(H,F,m,n.exFreezed&&s===c,x,y),(fa[m]&e)===e&&(B.w=b.w*(1+x),B.x=(b.x-F.x)*(1+x)+F.x),(fa[m]&g)===g&&(B.w=b.w*(1-x),B.x=(b.x-F.x)*(1-x)+H.x),(fa[m]&f)===f&&(B.h=b.h*(1-y),B.y=(b.y-F.y)*(1-y)+H.y),(fa[m]&h)===h&&(B.h=b.h*(1+y),B.y=(b.y-F.y)*(1+y)+F.y)}else ia(B,b,m,n.exFreezed,x,y);if(B.rc=D(b),b.conn){var I=n.indexOf(v,w);if(s===c&&-1!==I&&I!==s&&-1!==c){var J=V(n.data[I],[v,w]);3===m?(B.x=J[0],B.y=J[1]):7===m&&(B.w=J[0]-B.x,B.h=J[1]-B.y)}}a.draw(n.ctx,B,o)}b.conn||null==B||n._doConns(c,function(b){var c=n._findConnGrp(b[0]);if(2!==n._connSelectedCount(c)){var d=n.data[b[0]],e=a.extend({style:2,dashedStyle:0,strokeSize:1},d);z[z.length]=e,n._updateConn(B,e,b),e.rc=D(d),a.draw(n.ctx,e,o)}}),(d&l)===l&&-1!==n.exIndex&&s===c&&(n._dragEx(v,w,B),a.draw(n.ctx,B,o))},_onMousedown:function(b){var c=this,d=c.options.disabled;if(!d){var e=c.options.allScale,f=c.options.selectedIndexs,g=c.options.groups,h=c.options.curIndex,i=c.action,j=c.newSprite,l=c.downX,o=c.downY,p=c.moveX,q=c.moveY;if(l=b.offsetX||b.layerX,o=b.offsetY||b.layerY,l/=e,o/=e,c.mDownFlag=!0,h=c.overInd,-1!==h){var r=c.data[h];c.isSelected(h)||(c.multiSelect?f[f.length]=h:(f=[],f[0]=h));var s=la(g,h);if(-1!==s&&(f=qa(f,pa(g[s]))),(i&k)===k){var t=D(r),u=l-t[0],v=o-t[1];c.downRotate=Math.atan2(v,u)}for(var w={curIndex:h,exInd:c.exIndex,data:c.data,selectedIndexs:f,resizeInd:c.resizeInd},x=null,y=0;y<f.length;y++){var z=f[y],A=c.data[z];x=a.plugins[A.type],x&&x.onActionStart&&(x.onActionStart.call(x,i,A,w),c.exIndex=w.exInd)}if(x=a.plugins[r.type],x&&x.exFreeze){var B=p,C=q,E=r.rotate||0;if(0!==E){var F=a.rotate(a.center(r.x,r.y,r.w,r.h),[B,C],E,-1);B=F[0],C=F[1]}c.exFreezed=x.exFreeze.call(x,B,C,r,i)}}else f=[],i===n&&j&&(j.x=l,j.y=o,j.w=1,j.h=1),0===i&&(i=m);c.options.selectedIndexs=f,c.options.curIndex=h,c.action=i,c.downX=l,c.downY=o,null==c.interval&&c.startRefresh()}},_onMousemove:function(b){var c=this,d=c.options.disabled;if(!d){var e=b.target||b.srcElement,f=c.options.allScale,g=c.options.selectedIndexs,h=c.options.groups,m=c.options.groupSprites,o=c.options.curIndex,p=c.action,q=c.newSprite,r=c.downX,s=c.downY,t=c.moveX,u=c.moveY,v=-1,w=null,x=null,y=-1;if(t=b.offsetX||b.layerX,u=b.offsetY||b.layerY,t/=f,u/=f,(p&n)!==n?c.mDownFlag||(c.overInd=c.indexOf(t,u)):c.overInd=-1,c.mDownFlag)if(-1===o)(p&n)===n&&q&&((p&i)===i?(q.x=t,q.y=u):(q.w=t-r,q.h=u-s));else if(v=la(h,o),w=null,-1===v?w=c.data[o]:(x=h[v],y=ra(x),w=m[y]),(p&k)===k){var z=D(w),A=t-z[0],B=u-z[1];c.moveRotate=Math.atan2(B,A)-c.downRotate}else if((p&j)===j){var C=t,E=u,F=r,G=s;if(w.rotate){var H=a.rotate(D(w),[C,E],w.rotate,-1),I=a.rotate(D(w),[F,G],w.rotate,-1);C=H[0],E=H[1],F=I[0],G=I[1]}0!==w.w&&(c.scalex=(C-F)/w.w),0!==w.h&&(c.scaley=(E-G)/w.h),c.connModeFlag=null!=w.conn?!!w.conn:!1}else(p&l)===l||(p&n)===n||(c.action=i);else{if(c.cursor="default",-1!==c.overInd&&(c.cursor="move"),(p&n)===n)q&&((p&i)===i?(q.x=t-q.w/2,q.y=u-q.h/2,c.cursor="move"):c.cursor="crosshair");else{c.action=0;for(var J=0;null!=g&&J<g.length;J++){var K=g[J];if(w=null,v=la(h,K),-1!==v&&(x=h[v],y=ra(x),w=m[y]),null==w&&(w=c.data[K]),c._doMouseOver(w),0!==c.action){c.overInd=K;break}}}e.style.cursor=c.cursor}c.moveX=t,c.moveY=u}},_onMouseup:function(b){var c=this,d=c.options.disabled;if(!d){var e=c.options.allScale,f=c.options.selectedIndexs,g=c.options.groups,h=c.options.groupSprites,l=c.options.curIndex,o=c.action,p=c.newSprite,q=c.scalex,r=c.scaley,s=c.resizeInd,u=c.downX,w=c.downY,x=c.upX,y=c.upY,z=c.assistSprites;x=b.offsetX||b.layerX,y=b.offsetY||b.layerY,x/=e,y/=e,c.stopRefresh();var A=0,B=-1,C=null;if(-1!==l){var D=null,E=[];for(A=0;c.mDownFlag&&A<f.length;A++){var F=f[A];if(D=c.data[F],B=la(g,F),-1!==B&&-1===E.join().indexOf(B+"")&&(E[E.length]=B),z.length>A&&a.extend(D,z[A],!0,["fillStyle","style","dashedStyle","strokeSize"]),D.rotate){var G=a.center(D);if(D.rc){var H=_(D.rc,G,D.rotate),I=H[0]-G[0],J=H[1]-G[1];D.x=D.x+I,D.y=D.y+J}}D.rc&&delete D.rc,D.conn||c._doConns(F,this._onSpConn)}for(A=0;A<E.length;A++){B=E[A];var K=g[B],L=ra(K),M=h[L];if(null!=M)if((o&i)===i)M.x=M.x+x-u,M.y=M.y+y-w;else if((o&k)===k)M.rotate=((M.rotate||0)+c.moveRotate)%(2*Math.PI);else if((o&j)===j){var N={};ia(N,M,c.resizeInd,!1,q,r),v(M,N,!0)}}for(A=0;c.mDownFlag&&A<f.length;A++)if(D=c.data[f[A]],D.conn){var O=c._findConnGrp(f[A]),P=c._connSelectedCount(O);if(2===P)for(var Q=0;Q<O.length;Q++)C=O[Q],c._updateConn(c.data[C[2]],D,C,t(D));else 0===P&&(o&i)===i&&c._clearConns(f[A])}D=c.data[l];var R=a.plugins[D.type];if(R&&R.onActionDone){var S={exInd:c.exIndex,data:c.data,selectedIndexs:f,resizeInd:s};R.onActionDone.call(R,o,D,S)}if(D.conn&&-1!==s){var T=c.indexOf(x,y);if(-1!==T){var U=-1,V=W(c.data[T],[x,y]),X=c.options.connectingSprites;for(A=0;A<X.length;A++)if(C=X[A],C[0]===l&&C[1]===s){U=A;break}-1===U?X[X.length]=[l,s,T,V]:(X[U][2]=T,X[U][3]=V)}else c._clearConns(l,s)}}else(o&m)===m&&(f=c.indexsOf(u,w,x,y));(o&n)===n&&p&&(l=c.data.length,c.add(p),f=[],f[f.length]=l),c.options.selectedIndexs=f,c.options.curIndex=l,c.upX=x,c.upY=y,c.reset(),c.update()}},_onSpConn:function(a,b){var c=this.data[b],d=this.data[a[0]];this.isSelected(a[0])||this._updateConn(c,d,a)},update:function(){var b=this,c=b.options.allScale,d=b.options.selectedIndexs,e=b.options.groups,f=b.options.groupSprites,g=b.action,h=b.newSprite,i=b.downX,l=b.downY,o=b.moveX,p=b.moveY,q=b.assistSprites;b.ctx.clearRect(0,0,b.w,b.h),this.options.background&&P(b.ctx,b.w,b.h,c);var r=-1;b.connModeFlag&&(r=b.indexOf(o,p)),a.draw(b.ctx,b.data,c,r,b.getOrderIndexs()),q.length=0;for(var s=[],t=-1,u=0;u<d.length;u++){var v=d[u];t=la(e,v);var w=b.data[v],x=[];if(w.conn&&(x=b._findConnGrp(v)),-1!==t?-1===s.join().indexOf(t+"")&&(s[s.length]=t):Q(b.ctx,w,c,x),!w.conn||g!==j&&g!==k||2!==b._connSelectedCount(x))(g&n)!==n&&b._updateSprite(w,v,g,b.resizeInd);else{var y=a.extend({style:2,dashedStyle:0,strokeSize:1},w);q[q.length]=y}}for(u=0;u<s.length;u++){t=s[u];var z=e[t],A=ra(z),B=f[A];null!=B&&Q(b.ctx,B,c)}(g&m)===m&&(o-i!==0||p-l!==0)&&a.dashedRect(b.ctx,i,l,o-i,p-l,a.dashes[0]),(g&n)===n&&h&&0!==h.x&&0!==h.y&&a.draw(b.ctx,h,c)}},a.instance=function(a,b){return new ua(a,b)}}(window.jh2d=window.jh2d||{}),function(a,b,c){var d=function(a,b,c){var d=c.w/2,e=c.h/2,f=a-c.x-d,g=b-c.y-e;return Math.pow(f/d,2)+Math.pow(g/e,2)<1},e=function(b,c,d,e,f,g,h,i){for(var j=0,k=64,l=1/Math.sqrt(Math.pow(g-c,2)+Math.pow(f-b,2));1>=j;){var m=a.bezier([b,c,d,e,f,g],j);if(Math.pow(i-m[1],2)+Math.pow(h-m[0],2)<k)return!0;j+=l}return!1},f=function(b,c,d,e,f,g,h,i,j,k){for(var l=0,m=64,n=1/Math.sqrt(Math.pow(i-c,2)+Math.pow(h-b,2));1>=l;){var o=a.bezier([b,c,d,e,f,g,h,i],l);if(Math.pow(k-o[1],2)+Math.pow(j-o[0],2)<m)return!0;l+=n}return!1},g=[{re:/#?([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})/,format:"hex",parse:function(a){return[parseInt(a[1],16),parseInt(a[2],16),parseInt(a[3],16),1]}},{re:/#?([a-fA-F0-9])([a-fA-F0-9])([a-fA-F0-9])/,format:"hex",parse:function(a){return[parseInt(a[1]+a[1],16),parseInt(a[2]+a[2],16),parseInt(a[3]+a[3],16),1]}}],h=function(a){for(var b=0;b<g.length;b++){var c=g[b],d=c.re.exec(a),e=d&&c.parse.apply(this,[d]);if(e)return e}return!1},i=function(a,b){var c=b||.8,d=h(a);if(d){var e=0;return j([d[e++]*c,d[e++]*c,d[e++]*c,1])}return a},j=function(a){var b=0;return"#"+(1<<24|a[b++]<<16|a[b++]<<8|a[b++]).toString(16).substr(1)},k=function(a,b,c,d){var e=c[0]-b[0],f=c[1]-b[1],g=0,h=0,i=-1;0!==e?(g=f/e,h=Math.atan(g)):h=Math.PI/2,0>g&&(i=1),c[1]<b[1]&&(i*=-1);var j=c[0],k=c[1];a.moveTo(j,k),a.lineTo(i*d*Math.cos(h-Math.PI/6)+j,i*d*Math.sin(h-Math.PI/6)+k),a.lineTo(i*d*Math.cos(h+Math.PI/6)+j,i*d*Math.sin(h+Math.PI/6)+k),a.closePath()},l=function(b,c,d){var e=[c.x,c.y],f=[c.x+c.w,c.y+c.h];if(d||b.moveTo(e[0],e[1]),c.ex){var g=e;if(a.isArray(c.ex))for(var h=0;h<c.ex.length;h++){var i=[c.ex[h].dx+c.x,c.ex[h].dy+c.y];a.dashedLine(b,g,i,d),g=i}else g=[c.ex.dx+c.x,c.ex.dy+c.y],a.dashedLine(b,e,g,d);a.dashedLine(b,g,f,d)}else a.dashedLine(b,e,f,d)},m=function(b,c){if(c.header){var d=10,e=[c.x,c.y],f=[c.x+c.w,c.y+c.h],g=null;if(c.ex){var h=e;if(a.isArray(c.ex)){if(c.ex.length>0){var i=0;1===(1&c.header)&&(i=c.ex.length-1,g=c.ex[i],h=[g.dx+c.x,g.dy+c.y],k(b,h,f,d)),2===(2&c.header)&&(i=0,g=c.ex[i],h=[g.dx+c.x,g.dy+c.y],k(b,h,e,d))}}else h=[c.ex.dx+c.x,c.ex.dy+c.y],1===(1&c.header)&&k(b,h,f,d),2===(2&c.header)&&k(b,h,e,d)}else 1===(1&c.header)&&k(b,e,f,d),2===(2&c.header)&&k(b,f,e,d)}},n=function(a,b,c){var d=c[1]-b[1],e=c[0]-b[0],f=Math.sqrt(Math.pow(d,2)+Math.pow(e,2));d=a[1]-b[1],e=a[0]-b[0];var g=Math.pow(d,2)+Math.pow(e,2);d=c[1]-a[1],e=c[0]-a[0];var h=Math.pow(d,2)+Math.pow(e,2),i=Math.sqrt(g)+Math.sqrt(h);return f>=i-2},o=function(b,c){var d=[c.x,c.y],e=[c.x+c.w,c.y+c.h],f=!1;if(c.ex){var g=d;if(a.isArray(c.ex))for(var h=0;h<c.ex.length;h++){var i=[c.ex[h].dx+c.x,c.ex[h].dy+c.y];if(f=0===h?n(b,d,i):n(b,g,i),g=i,f)return f}else if(g=[c.ex.dx+c.x,c.ex.dy+c.y],f=n(b,d,g))return f;f=n(b,g,e)}else f=n(b,d,e);return f},p=function(b,c,d){if(c.ex){var e=c.ex.dx,f=c.ex.dy,g=[c.x+e,c.y+f],h=[c.x+c.w,c.y],j=[c.x+c.w-e,c.y],k=[c.x,c.y+f],l=[c.x+e,c.y+c.h],m=[c.x,c.y+c.h],n=[c.x+c.w,c.y+c.h-f];b.moveTo(h[0],h[1]),a.dashedLine(b,h,n,d),a.dashedLine(b,n,l,d),a.dashedLine(b,l,g,d);var o=c.fillStyle||"#fff";b.fillStyle=i(o),b.closePath(),b.fill();var p=c.style;null==p&&(p=3),2===(2&p)&&b.stroke(),b.beginPath(),b.moveTo(g[0],g[1]),a.dashedLine(b,g,h,d),a.dashedLine(b,h,j,d),a.dashedLine(b,j,k,d),a.dashedLine(b,k,g,d),a.dashedLine(b,g,l,d),a.dashedLine(b,l,m,d),a.dashedLine(b,m,k,d)}},q=function(b,c,d){if(c.ex){var e=c.ex.dy,f=[c.x,c.y+e/2],g=[c.x+c.w,c.y+e/2],h=[c.x+c.w,c.y+c.h-e/2],i=[c.x,c.y+c.h-e/2];a.dashedOval(b,{x:c.x,y:c.y,w:c.w,h:e},d),a.dashedLine(b,f,i,d),a.dashedOval(b,{x:c.x,y:c.y+c.h-e,w:c.w,h:e},d,[0,0,1,1]),b.moveTo(h[0],h[1]),a.dashedLine(b,h,g,d)}},r=function(b,c,d){var e,f,g=[c.x,c.y],h=[-1,0,1,0],i=[0,-1,0,1],j=c.w<0?-1:1,k=c.h<0?-1:1,l=-1,m=null;c.ex&&(m=[c.x+c.ex.dx,c.y+c.ex.dy],t(c,m,function(b,d,g){e=b,f=d,l=g,(l&(a.NORTH|a.SOUTH))===l&&c.h<0&&(l=(a.NORTH|a.SOUTH)^g),l===a.SOUTH&&(e=d,f=b),(l&(a.EAST|a.WEST))===l&&c.w<0&&(l=(a.WEST|a.EAST)^g),l===a.WEST&&(e=d,f=b)}));for(var n=[a.NORTH,a.EAST,a.SOUTH,a.WEST],o=0;4>o;o++){var p,q,r=[g[0]-c.w*h[o],g[1]-c.h*i[o]];if(c.corner){var s=[];s=[g[0]+c.corner*i[o]*j,g[1]-c.corner*h[o]*k],s=s.concat(g),p=[g[0]-c.corner*h[o]*j,g[1]-c.corner*i[o]*k],s=s.concat(p),0===o&&b.moveTo(s[0],s[1]),a.dashedBezier(b,s,d),q=[r[0]+c.corner*h[o]*j,r[1]+c.corner*i[o]*k]}else p=g,q=r;l===n[o]?(a.dashedLine(b,p,e,d),
a.dashedLine(b,e,m,d),a.dashedLine(b,m,f,d),a.dashedLine(b,f,q,d)):a.dashedLine(b,p,q,d),g=r}b.closePath()},s=function(b,c,d){var e=[c.x,c.y+c.h],f=[c.x+c.w,c.y+c.h],g=[c.x+c.ex.dx,c.y+c.ex.dy];b.moveTo(e[0],e[1]),a.dashedLine(b,e,f,d),a.dashedLine(b,f,g,d),a.dashedLine(b,g,e,d)},t=function(b,c,d,e){var f=a.direction(b.x,b.y,b.w,b.h,c),g=[0,0],h=[0,0],i=function(a){var b=a/6,c=b+a/4,d=5*a/12;return[b,c,d]},j=null,k=f;switch(f===a.EAST||f===a.WEST?(j=i(b.h),g[1]=b.y+j[0],h[1]=b.y+j[1],(b.h>0&&c[1]>b.y+b.h/2||b.h<0&&c[1]<b.y+b.h/2)&&(g[1]+=j[2],h[1]+=j[2]),b.w<0&&(k=(a.WEST|a.EAST)^f)):(j=i(b.w),g[0]=b.x+j[0],h[0]=b.x+j[1],(b.w>0&&c[0]>b.x+b.w/2||b.w<0&&c[0]<b.x+b.w/2)&&(g[0]+=j[2],h[0]+=j[2]),b.h<0&&(k=(a.NORTH|a.SOUTH)^f)),k){case a.EAST:g[0]=b.x+b.w,h[0]=b.x+b.w;break;case a.NORTH:g[1]=b.y,h[1]=b.y;break;case a.WEST:g[0]=b.x,h[0]=b.x;break;case a.SOUTH:g[1]=b.y+b.h,h[1]=b.y+b.h}return d.call(e||this,g,h,f)},u=.6,v=.8,w=function(b,c,d,e,f,g){var h=[c,d],i=[c+e,d],j=[c+e,d+f*u],k=[c,d+f*v],l=x(c,d,e,f);b.moveTo(k[0],k[1]),a.dashedBezier(b,k.concat(l).concat(j),g),a.dashedLine(b,j,i,g),a.dashedLine(b,i,h,g),a.dashedLine(b,h,k,g)},x=function(a,b,c,d){return[a+c/4,b+d*(2-v),a+c/2,b+d*u]},y=function(b,c,d,e,f){var g=a.inRect(b,c,d,e,f),h=f[0],i=f[1];if(g&&i>c+e*u){var j=(h-b)/d,k=x(b,c,d,e),l=[b,c+e*v],m=[b+d,c+e*u],n=a.bezier(l.concat(k).concat(m),j);g=e>=0?i<=n[1]:i>=n[1]}return g},z=function(b,c,d,e,f,g){for(var h=.8*e,i=.8*f,j=d+f*v,k=c,l=0;3>l;l++){var m=c+l*e*.1,n=d+f*(.2-.1*l);b.moveTo(m,j),a.dashedLine(b,[m,j],[m,n],g),a.dashedLine(b,[m,n],[m+h,n],g),a.dashedLine(b,[m+h,n],[m+h,n+i*u],g);var o=[m+h,n+i*u],p=[k,n+i*u];if(0===l){var q=x(m,n,h,i);b.moveTo(k,j),a.dashedBezier(b,[k,j].concat(q).concat(o),g)}else a.dashedLine(b,o,p,g);j=n,k=m+h}},A=function(b,c,d,e,f){var g=a.inRect(b,c,d,e,f);if(g)for(var h=.8*d,i=.8*e,j=0;3>j;j++){var k=b+j*d*.1,l=c+e*(.2-.1*j);if(g=0===j?y(k,l,h,i,f):a.inRect(k,l,h,i*u,f))break}return g},B=function(b,c,d,e,f,g,h,i){var j=c+e/2,k=d+f/2,l=h[0],m=h[1],n=null;return g=g||1,1===(1&g)||2===(2&g)?(a.dashedLine(b,[l,m],[l,d],i),a.dashedLine(b,[l,d],[c,k],i),a.dashedLine(b,[c,k],[l,d+f],i),n=[l,2*k-m],a.dashedLine(b,[l,d+f],n,i),n):4===(4&g)||8===(8&g)?(a.dashedLine(b,[l,m],[c,m],i),a.dashedLine(b,[c,m],[j,d],i),a.dashedLine(b,[j,d],[c+e,m],i),n=[2*j-l,m],a.dashedLine(b,[c+e,m],n,i),n):void 0},C=function(b,c,d,e,f,g,h,i){var j=c+e/2,k=d+f/2,l=c+h[0],m=d+h[1];g=g||1;var n=null,o=null;1===(1&g)||4===(4&g)?(n=[l,m],o=B(b,c,d,e,f,g,[l,m],i)):2===(2&g)?(n=[c,m],o=[c,2*k-m],a.dashedLine(b,n,o,i)):8===(8&g)&&(n=[l,d],o=[2*j-l,d],a.dashedLine(b,n,o,i)),2===(2&g)||8===(8&g)?(a.dashedLine(b,o,[2*j-l,2*k-m],i),b.save(),b.translate(j,k),b.rotate(-Math.PI),o=B(b,c-j,d-k,e,f,g,[l-j,m-k],i),a.dashedLine(b,o,[j-n[0],k-n[1]],i),b.restore()):1===(1&g)?(a.dashedLine(b,o,[c+e,2*k-m],i),a.dashedLine(b,[c+e,2*k-m],[c+e,m],i),a.dashedLine(b,[c+e,m],[l,m],i)):4===(4&g)&&(a.dashedLine(b,o,[2*j-l,d+f],i),a.dashedLine(b,[2*j-l,d+f],[l,d+f],i),a.dashedLine(b,[l,d+f],[l,m],i)),b.closePath()},D=function(b,c,d,e,f,g,h){var i=b+d/2,j=c+e/2,k=b+g[0],l=c+g[1],m=!1,n=!1,o=null,p=null;return 1===(1&f)&&(m=a.inTriangle([k,c],[b,j],[k,c+e],h),o=[k,l],p=[b+d,2*j-l]),4===(4&f)&&(m=a.inTriangle([b,l],[i,c],[b+d,l],h),o=[k,l],p=[2*i-k,c+e]),2===(2&f)&&(n=a.inTriangle([2*i-k,c],[2*i-b,j],[2*i-k,c+e],h),p=[2*i-k,2*j-l],null==o&&(o=[b,l])),8===(8&f)&&(n=a.inTriangle([b,2*j-l],[i,c+e],[b+d,2*j-l],h),p=[2*i-k,2*j-l],null==o&&(o=[k,c])),m||n||a.inRect(o[0],o[1],p[0]-o[0],p[1]-o[1],h)},E=function(a,b,c,d,e,f){var g=a+c/2,h=b+d/2,i=a+f[0],j=b+f[1],k=[];return 1===(1&e)&&(k[k.length]=[i,b],k[k.length]=[i,b+d]),4===(4&e)&&(k[k.length]=[a+c,j],k[k.length]=[a,j]),2===(2&e)&&(k[k.length]=[2*g-i,b],k[k.length]=[2*g-i,b+d]),8===(8&e)&&(k[k.length]=[a,2*h-j],k[k.length]=[a+c,2*h-j]),(1===(1&e)||2===(2&e))&&(k[k.length]=[g,j],k[k.length]=[g,2*h-j],k[k.length]=[a,h],k[k.length]=[2*g-a,h]),(4===(4&e)||8===(8&e))&&(k[k.length]=[i,h],k[k.length]=[2*g-i,h],k[k.length]=[g,b],k[k.length]=[g,b+d]),k},F=function(b,c,d,e){var f=.5522848,g=5*c.w/6,h=2*c.w/3,j=g/2*f,k=c.ex[0],l=c.ex[1],m=c.ex[2],n=c.h*(e?1:0),o=c.h*(e?0:1),p=[c.x+2*(k.dx-g)-m.dx+h,c.y+n],q=[c.x+k.dx,c.y+n],r=[p[0]+(q[0]-p[0])/2,c.y+o],s=[c.x,c.y+n],t=[c.x+2*g-k.dx+m.dx-h,c.y+n],u=[s[0]+(t[0]-s[0])/2,c.y+o];b.moveTo(p[0],p[1]),a.dashedBezier(b,p.concat([r[0]-j,c.y+o]).concat(r),d),a.dashedLine(b,r,u,d),a.dashedBezier(b,u.concat([u[0]-j,c.y+o]).concat(s),d);var v=c.fillStyle||"#fff";b.fillStyle=i(v),b.closePath(),b.fill();var w=c.style;null==w&&(w=3),2===(2&w)&&b.stroke(),b.beginPath(),b.moveTo(r[0],r[1]);var x=r.concat([r[0]+j,c.y+o]).concat(q),y=a.bezier(x,Math.abs((o-l.dy)/c.h)),z=r.concat([r[0]+(y[0]-r[0])/2,c.y+o]).concat(y);a.dashedBezier(b,z,d);var A=t.concat([u[0]+j,c.y+o]).concat(u),B=a.bezier(A,Math.abs((n-l.dy)/c.h)),C=B.concat([u[0]+(B[0]-u[0])/2,c.y+o]).concat(u),D=c.w-k.dx,E=t[0]+(q[0]-t[0])/2,F=[y[0]+D,y[1]],G=[E,c.y+n],H=[B[0]-D,B[1]];a.dashedLine(b,z.slice(z.length-2),F,d),a.dashedLine(b,F,G,d),a.dashedLine(b,G,H,d),a.dashedLine(b,H,C.slice(0,2),d),a.dashedBezier(b,C,d)},G=function(b,c,d,e){var f=.5522848,g=5*c.h/6,h=2*c.h/3,j=g/2*f,k=c.ex[0],l=c.ex[1],m=c.ex[2],n=c.w*(e?1:0),o=c.w*(e?0:1),p=[c.x+n,c.y+2*(k.dy-g)-m.dy+h],q=[c.x+n,c.y+k.dy],r=[c.x+o,p[1]+(q[1]-p[1])/2],s=[c.x+n,c.y],t=[c.x+n,c.y+2*g-k.dy+m.dy-h],u=[c.x+o,s[1]+(t[1]-s[1])/2];b.moveTo(p[0],p[1]),a.dashedBezier(b,p.concat([c.x+o,r[1]-j]).concat(r),d),a.dashedLine(b,r,u,d),a.dashedBezier(b,u.concat([c.x+o,u[1]-j]).concat(s),d);var v=c.fillStyle||"#fff";b.fillStyle=i(v),b.closePath(),b.fill();var w=c.style;null==w&&(w=3),2===(2&w)&&b.stroke(),b.beginPath(),b.moveTo(r[0],r[1]);var x=r.concat([c.x+o,r[1]+j]).concat(q),y=a.bezier(x,Math.abs((o-l.dx)/c.w)),z=r.concat([c.x+o,r[1]+(y[1]-r[1])/2]).concat(y);a.dashedBezier(b,z,d);var A=t.concat([c.x+o,u[1]+j]).concat(u),B=a.bezier(A,Math.abs((n-l.dx)/c.w)),C=B.concat([c.x+o,u[1]+(B[1]-u[1])/2]).concat(u),D=c.h-k.dy,E=t[1]+(q[1]-t[1])/2,F=[y[0],y[1]+D],G=[c.x+n,E],H=[B[0],B[1]-D];a.dashedLine(b,z.slice(z.length-2),F,d),a.dashedLine(b,F,G,d),a.dashedLine(b,G,H,d),a.dashedLine(b,H,C.slice(0,2),d),a.dashedBezier(b,C,d)};a.reg({oval:{renderer:function(b,c,d){a.dashedOval(b,c,d)},isOver:function(a,b,c){return d(a,b,c)}},ovalx:{init:function(a){a.ex||(a.ex={dx:.1*a.w,dy:a.h+.3*a.h})},renderer:function(b,c,d){a.dashedOval(b,c,d)},isOver:function(a,b,c){return d(a,b,c)||!this.exFreeze(a,b,c)},exFreeze:function(b,c,d){var e=[d.x+d.ex.dx,d.y+d.ex.dy];return a.doOvalEx(d,e,function(d,f){return!a.inTriangle(d,f,e,[b,c])})}},line:{init:function(a){a.ex||(a.ex=[{dx:a.w/2,dy:a.h/2}],a.adjPoint=136,a.style=2)},renderer:function(a,b,c){l(a,b,c),m(a,b)},isOver:function(a,b,c){return o([a,b],c)},drawExPoint:function(a,b,c){a.save();var d=7,e=b.x+c.dx,f=b.y+c.dy;a.fillStyle="#000",a.strokeStyle="#fff",a.beginPath(),a.lineWidth=2,c.main?(a.fillRect(e-d/2,f-d/2,d,d),a.strokeRect(e-d/2,f-d/2,d,d)):(d=3,a.arc(e,f,d,0,2*Math.PI,!1)),a.closePath(),a.fill(),a.stroke(),a.restore()},exFreeze:function(b,c,d,e){return e===a.ACT_RESIZE},onActionStart:function(b,c,d){var e=[];if(b===a.ACT_EX_MOVE&&d.exInd>=0){var f=c.ex[d.exInd],g=d.exInd-1,h=d.exInd+1;null!=f&&f.main&&(g>0&&(e=e.concat(c.ex.slice(0,g))),e.push(f),h+1<c.ex.length&&(e=e.concat(c.ex.slice(h+1,c.ex.length))),f.main=!1,c.ex=e,d.exInd=g)}else{for(var i=0;i<c.ex.length;i++)c.ex[i].main&&(e[e.length]=c.ex[i]);c.ex=e}},onActionDone:function(b,c,d){var e=[];if(b===a.ACT_EX_MOVE&&d.exInd>=0){var f=c.ex[d.exInd];if(null==f)return;var g=d.exInd-1,h=d.exInd+1,i=null,j=null;if(f.main)return g=d.exInd-2,h=d.exInd+2,i=0>g?[0,0]:[c.ex[g].dx,c.ex[g].dy],j=h>=c.ex.length?[c.w,c.h]:[c.ex[h].dx,c.ex[h].dy],c.ex[g+1]={dx:f.dx-(f.dx-i[0])/2,dy:f.dy-(f.dy-i[1])/2},void(c.ex[h-1]={dx:f.dx+(j[0]-f.dx)/2,dy:f.dy+(j[1]-f.dy)/2});f.main=!0,0>g?i=[0,0]:(i=[c.ex[g].dx,c.ex[g].dy],e=e.concat(c.ex.slice(0,d.exInd))),e.push({dx:f.dx-(f.dx-i[0])/2,dy:f.dy-(f.dy-i[1])/2}),e.push(f),h>=c.ex.length?(j=[c.w,c.h],e.push({dx:f.dx+(j[0]-f.dx)/2,dy:f.dy+(j[1]-f.dy)/2})):(j=[c.ex[h].dx,c.ex[h].dy],e.push({dx:f.dx+(j[0]-f.dx)/2,dy:f.dy+(j[1]-f.dy)/2}),e=e.concat(c.ex.slice(h,c.ex.length))),c.ex=e}else{var k={dx:0,dy:0},l=0,m=0;if(a.isArray(c.ex))for(var n=0;n<c.ex.length;n++)c.ex[n].main&&(l=(c.ex[n].dx-k.dx)/2,m=(c.ex[n].dy-k.dy)/2,e[e.length]={dx:c.ex[n].dx-l,dy:c.ex[n].dy-m},e[e.length]=c.ex[n],k=c.ex[n]);l=(c.w-k.dx)/2,m=(c.h-k.dy)/2,e[e.length]={dx:c.w-l,dy:c.h-m},c.ex=e}}},linex:{init:function(a){a.ex||(a.ex={dx:3*a.w/4,dy:a.h/4},a.style=2)},renderer:function(b,c,d){c.ex?(b.moveTo(c.x,c.y),a.dashedBezier(b,[c.x,c.y,c.x+c.ex.dx,c.y+c.ex.dy,c.x+c.w,c.y+c.h],d)):a.dashedLine(b,[c.x,c.y],[c.x+c.w,c.y+c.h],d),m(b,c)},isOver:function(a,b,c){return e(c.x,c.y,c.x+c.ex.dx,c.y+c.ex.dy,c.x+c.w,c.y+c.h,a,b)}},linexx:{init:function(a){a.ex||(a.ex=[{dx:a.w,dy:0},{dx:0,dy:a.h}],a.style=2)},renderer:function(b,c,d){c.ex?(b.moveTo(c.x,c.y),a.dashedBezier(b,[c.x,c.y,c.x+c.ex[0].dx,c.y+c.ex[0].dy,c.x+c.ex[1].dx,c.y+c.ex[1].dy,c.x+c.w,c.y+c.h],d)):a.dashedLine(b,[c.x,c.y],[c.x+c.w,c.y+c.h],d),m(b,c)},isOver:function(a,b,c){return f(c.x,c.y,c.x+c.ex[0].dx,c.y+c.ex[0].dy,c.x+c.ex[1].dx,c.y+c.ex[1].dy,c.x+c.w,c.y+c.h,a,b)}},rect:{renderer:function(a,b,c){r(a,b,c)}},rectx:{init:function(a){a.ex||(a.ex={dx:.1*a.w,dy:a.h+.3*a.h})},renderer:function(a,b,c){r(a,b,c)},isOver:function(b,c,d){return a.inRect(d.x,d.y,d.w,d.h,[b,c])||this.isExOver(b,c,d)},isExOver:function(b,c,d){var e=[d.x+d.ex.dx,d.y+d.ex.dy];return t(d,e,function(d,f){return a.inTriangle(d,f,e,[b,c])})}},doc:{renderer:function(a,b,c){w(a,b.x,b.y,b.w,b.h,c)},isOver:function(a,b,c){return y(c.x,c.y,c.w,c.h,[a,b])}},docs:{renderer:function(a,b,c){z(a,b.x,b.y,b.w,b.h,c)},isOver:function(a,b,c){return A(c.x,c.y,c.w,c.h,[a,b])}},arrow:{init:function(a){a.ex||(a.ex={dx:a.w/5,dy:a.h/5}),a.arrow=a.arrow||3},renderer:function(a,b,c){C(a,b.x,b.y,b.w,b.h,b.arrow,[b.ex.dx,b.ex.dy],c)},isOver:function(a,b,c){return D(c.x,c.y,c.w,c.h,c.arrow,[c.ex.dx,c.ex.dy],[a,b])},getConnectPts:function(a){return E(a.x,a.y,a.w,a.h,a.arrow,[a.ex.dx,a.ex.dy])}},larrow:{init:function(a){a.ex||(a.ex={dx:a.w/5,dy:a.h/5})},renderer:function(a,b,c){var d=0,e=0;d=b.ex.dx,e=b.ex.dy,C(a,b.x,b.y,b.w,b.h,1,[d,e],c)},isOver:function(a,b,c){return D(c.x,c.y,c.w,c.h,1,[c.ex.dx,c.ex.dy],[a,b])},getConnectPts:function(a){return E(a.x,a.y,a.w,a.h,1,[a.ex.dx,a.ex.dy])}},rarrow:{init:function(a){a.ex||(a.ex={dx:a.w-a.w/5,dy:a.h/5})},renderer:function(a,b,c){C(a,b.x,b.y,b.w,b.h,2,[b.w-b.ex.dx,b.ex.dy],c)},isOver:function(a,b,c){return D(c.x,c.y,c.w,c.h,2,[c.w-c.ex.dx,c.ex.dy],[a,b])},getConnectPts:function(a){return E(a.x,a.y,a.w,a.h,2,[a.w-a.ex.dx,a.ex.dy])}},lrarrow:{init:function(a){a.ex||(a.ex={dx:a.w/5,dy:a.h/5})},renderer:function(a,b,c){C(a,b.x,b.y,b.w,b.h,3,[b.ex.dx,b.ex.dy],c)},isOver:function(a,b,c){return D(c.x,c.y,c.w,c.h,3,[c.ex.dx,c.ex.dy],[a,b])},getConnectPts:function(a){return E(a.x,a.y,a.w,a.h,3,[a.ex.dx,a.ex.dy])}},uarrow:{init:function(a){a.ex||(a.ex={dx:a.w/5,dy:a.h/5})},renderer:function(a,b,c){C(a,b.x,b.y,b.w,b.h,4,[b.ex.dx,b.ex.dy],c)},isOver:function(a,b,c){return D(c.x,c.y,c.w,c.h,4,[c.ex.dx,c.ex.dy],[a,b])},getConnectPts:function(a){return E(a.x,a.y,a.w,a.h,4,[a.ex.dx,a.ex.dy])}},darrow:{init:function(a){a.ex||(a.ex={dx:a.w/5,dy:a.h-a.h/5})},renderer:function(a,b,c){C(a,b.x,b.y,b.w,b.h,8,[b.ex.dx,b.h-b.ex.dy],c)},isOver:function(a,b,c){return D(c.x,c.y,c.w,c.h,8,[c.ex.dx,c.h-c.ex.dy],[a,b])},getConnectPts:function(a){return E(a.x,a.y,a.w,a.h,8,[a.ex.dx,a.h-a.ex.dy])}},udarrow:{init:function(a){a.ex||(a.ex={dx:a.w/5,dy:a.h/5})},renderer:function(a,b,c){C(a,b.x,b.y,b.w,b.h,12,[b.ex.dx,b.ex.dy],c)},isOver:function(a,b,c){return D(c.x,c.y,c.w,c.h,12,[c.ex.dx,c.ex.dy],[a,b])},getConnectPts:function(a){return E(a.x,a.y,a.w,a.h,12,[a.ex.dx,a.ex.dy])}},triangle:{init:function(a){a.ex||(a.ex={dx:a.w/2,dy:0})},renderer:function(a,b,c){s(a,b,c)},isOver:function(b,c,d){var e=[d.x,d.y+d.h],f=[d.x+d.w,d.y+d.h],g=[d.x+d.ex.dx,d.y+d.ex.dy];return a.inTriangle(e,f,g,[b,c])}},cube:{init:function(a){a.ex||(a.ex={dx:3*a.w/4,dy:1*a.h/4})},renderer:function(a,b,c){p(a,b,c)}},stick:{init:function(a){a.ex||(a.ex={dx:a.w/2,dy:a.h/2})},renderer:function(a,b,c){q(a,b,c)}},downArcArrow:{init:function(a){a.ex||(a.ex=[{dx:11*a.w/12,dy:-10},{dx:a.w+10,dy:a.h/5},{dx:2*a.w/3,dy:-10}])},renderer:function(a,b,c){F(a,b,c)}},upArcArrow:{init:function(a){a.ex||(a.ex=[{dx:11*a.w/12,dy:a.h+10},{dx:a.w+10,dy:4*a.h/5},{dx:2*a.w/3,dy:a.h+10}])},renderer:function(a,b,c){F(a,b,c,!0)}},rightArcArrow:{init:function(a){a.ex||(a.ex=[{dy:11*a.h/12,dx:-10},{dy:a.h+10,dx:a.w/5},{dy:2*a.h/3,dx:-10}])},renderer:function(a,b,c){G(a,b,c)}},leftArcArrow:{init:function(a){a.ex||(a.ex=[{dy:11*a.h/12,dx:a.w+10},{dy:a.h+10,dx:4*a.w/5},{dy:2*a.h/3,dx:a.w+10}])},renderer:function(a,b,c){G(a,b,c,!0)}}})}(window.jh2d=window.jh2d||{}),function(a,b,c){a.dashedLine=function(a,b,c,d){if(d){var e=this.delta(b,c),f=Math.sqrt(e[0]*e[0]+e[1]*e[1]),g=0,h=0;for(a.moveTo(b[0],b[1]);;){if(h+=d[g%d.length],h>=f)break;var i=e[0]/f*h,j=e[1]/f*h;g%2===0?a.lineTo(b[0]+i,b[1]+j):a.moveTo(b[0]+i,b[1]+j),g++}g%2===0?a.lineTo(c[0],c[1]):a.moveTo(c[0],c[1])}else a.lineTo(c[0],c[1])},a.dashedRect=function(b,c,d,e,f,g){g?(a.dashedLine(b,[c,d],[c+e,d],g),a.dashedLine(b,[c+e,d],[c+e,d+f],g),a.dashedLine(b,[c+e,d+f],[c,d+f],g),a.dashedLine(b,[c,d+f],[c,d],g),b.stroke()):b.strokeRect(c,d,e,f)}}(window.jh2d=window.jh2d||{}),function(a,b,c){var d=function(a,b){return[b[0]-a[0],b[1]-a[1]]},e=function(a,b){var c=d(a,b);return Math.sqrt(c[0]*c[0]+c[1]*c[1])},f=function(a,b){var c=2;a.length>=8&&(c=3);var d,e,f=0,g=a[f++],h=a[f++],i=a[f++],j=a[f++],k=a[f++],l=a[f++];3===c&&(d=a[f++],e=a[f++]);var m=[];return 3===c?(m[m.length]=Math.pow(1-b,3)*g+3*b*Math.pow(1-b,2)*i+3*Math.pow(b,2)*(1-b)*k+Math.pow(b,3)*d,m[m.length]=Math.pow(1-b,3)*h+3*b*Math.pow(1-b,2)*j+3*Math.pow(b,2)*(1-b)*l+Math.pow(b,3)*e):(m[m.length]=Math.pow(1-b,2)*g+2*b*(1-b)*i+Math.pow(b,2)*k,m[m.length]=Math.pow(1-b,2)*h+2*b*(1-b)*j+Math.pow(b,2)*l),m},g=function(a,b){for(var c=.001,d=[],g=f(a,0),h=g,i=0,j=0,k=[],l=c;1>=l;l+=c){g=f(a,l);var m=e(h,g);m<b[i]/10||(j+=m,h=g,j>=b[i]&&(i%2===0&&d.push(k),i=(i+1)%b.length,k=[],j=0),i%2===0&&k.push(g[0],g[1]))}return k.length>0&&d.push(k),d},h=function(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.length>0&&a.moveTo(d[0],d[1]);for(var e=1;e<d.length/2;e++)a.lineTo(d[2*e],d[2*e+1])}};a.bezier=f,a.dashedBezier=function(a,b,c){if(c){var d=g(b,c);h(a,d)}else{var e=2;6===b.length&&a.quadraticCurveTo(b[e++],b[e++],b[e++],b[e++]),b.length>=8&&a.bezierCurveTo(b[e++],b[e++],b[e++],b[e++],b[e++],b[e++])}}}(window.jh2d=window.jh2d||{}),function(a,b,c){var d=function(a,b,c,d){var e=.5522848,f=c/2*e,g=d/2*e,h=a+c,i=b+d,j=a+c/2,k=b+d/2;return[a,k,a,k-g,j-f,b,j,b,j+f,b,h,k-g,h,k,h,k+g,j+f,i,j,i,j-f,i,a,k+g,a,k]},e=function(a,b){var c=6*b;return a.slice(c,c+8)},f=function(a,b,c){var d=c.w/2,e=c.h/2,f=a-c.x-d,g=b-c.y-e;return Math.pow(f/d,2)+Math.pow(g/e,2)<=1},g=function(b,c,d,e){var f=b.x,g=b.y,h=b.w,i=b.h,j=a.direction(f,g,h,i,c),k=Math.min(h,i),l=[],m=[],n=h/2,o=i/2,p=1;return j===a.NORTH||j===a.SOUTH?(p=h===k?4:6,l[0]=f+n-h/p,l[1]=g+o,m[0]=f+n+h/p,m[1]=g+o):(p=i===k?4:6,l[0]=f+n,l[1]=g+o-i/p,m[0]=f+n,m[1]=g+o+i/p),d.call(e||this,l,m,j)};a.inOval=f,a.doOvalEx=g,a.calcOvalGap=function(b,c,f,h){var i=[],j=[],k=b.w/2,l=0;g(b,c,function(a,c,d){i=a,j=c,l=d,b.w<0&&(l===this.EAST||l===this.WEST)&&(l^=this.EAST|this.WEST),b.h<0&&(l===this.NORTH||l===this.SOUTH)&&(l^=this.NORTH|this.SOUTH)},this);var m=[(c[1]-i[1])/(c[0]-i[0]),(c[1]-j[1])/(c[0]-j[0])],n=d(b.x,b.y,b.w,b.h),o=[];switch(l){case this.EAST:o=[e(n,1),e(n,2)];break;case this.NORTH:o=[e(n,0),e(n,1)];break;case this.WEST:o=[e(n,3),e(n,0)],m=m.reverse();break;case this.SOUTH:o=[e(n,2),e(n,3)],m=m.reverse()}for(var p=0,q=Math.abs(1/k),r=[],s=0;s<o.length;s++)for(var t=o[s],u=0,v=0;1>=v;v+=q){var w=a.bezier(t,v),x=m[p]*(w[0]-c[0])+c[1],y=w[1]-x>0?1:2;if(x===w[1]||0!==u&&u!==y){if(r[r.length]=w,1===p)break;p++,u=0}else u=y}f.call(h||this,r,n,l)},a.dashedOval=function(b,c,g,h){var i=c.ex,j=!1;if(i&&!f(c.x+c.ex.dx,c.y+c.ex.dy,c)){var k=a.center(c.x,c.y,c.w,c.h),l=[c.x+c.ex.dx,c.y+c.ex.dy];a.calcOvalGap(c,l,function(d,f,h){if(j=2!==d.length,!j){var i,m,n=0;switch(h){case this.SOUTH:n=0,c.w>0?(i=d[0][0]>k[0],m=d[1][0]>k[0]):(i=d[0][0]<k[0],m=d[1][0]<k[0]);break;case this.NORTH:n=2,c.w>0?(i=d[0][0]<k[0],m=d[1][0]<k[0]):(i=d[0][0]>k[0],m=d[1][0]>k[0]);break;case this.WEST:n=1,c.h>0?(i=d[0][1]>k[1],m=d[1][1]>k[1]):(i=d[0][1]<k[1],m=d[1][1]<k[1]);break;case this.EAST:n=3,c.h>0?(i=d[0][1]<k[1],m=d[1][1]<k[1]):(i=d[0][1]>k[1],m=d[1][1]>k[1])}var o=e(f,n++);g||b.moveTo(o[0],o[1]),a.dashedBezier(b,o,g),a.dashedBezier(b,e(f,n++%4),g),i?(o=e(f,n%4),o=o.slice(0,4).concat(d[0]),a.dashedBezier(b,o,g),a.dashedLine(b,d[0],l,g),a.dashedLine(b,l,d[1],g),m||n++):(a.dashedBezier(b,e(f,n++%4),g),o=e(f,n%4),o=o.slice(0,4).concat(d[0]),a.dashedBezier(b,o,g),a.dashedLine(b,d[0],l,g),a.dashedLine(b,l,d[1],g)),m?(o=e(f,n++%4),o=d[1].concat(o.slice(4)),a.dashedBezier(b,o,g),a.dashedBezier(b,e(f,n%4),g)):(o=e(f,n%4),o=d[1].concat(o.slice(2)),a.dashedBezier(b,o,g))}})}else h=h||[1,1,1,1];if(h){var m=d(c.x,c.y,c.w,c.h);b.moveTo(m[0],m[1]);for(var n=0;n<h.length;n++){var o=e(m,n);h[n]?a.dashedBezier(b,o,g):b.moveTo(o[o.length-2],o[o.length-1])}return m}}}(window.jh2d=window.jh2d||{});